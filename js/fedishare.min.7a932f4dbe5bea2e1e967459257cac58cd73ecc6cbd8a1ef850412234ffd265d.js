function updateState(){let a=document.getElementById("instance").value.trim()!="";document.getElementById("submit").disabled=!a}function getSoftwareName(a){for(let b of document.querySelectorAll("#fediverse-domains > option"))if(b.value==a)return Promise.resolve(b.getAttribute("data-project"));return fetch(`https://${a}/.well-known/nodeinfo`).then(a=>a.json()).then(a=>{if(a&&Array.isArray(a.links))for(let b of a.links)if(b.rel=="http://nodeinfo.diaspora.software/ns/schema/2.0"&&typeof b.href=="string")return fetch(b.href);throw new Exception(".well-known/nodeinfo file does not contain a nodeinfo link")}).then(a=>a.json()).then(a=>{if(a&&a.software&&typeof a.software.name=="string")return a.software.name;throw new Exception("nodeinfo link does not contain a software name")}).catch(a=>(console.error(a),"mastodon"))}document.addEventListener("DOMContentLoaded",()=>{let b=new URLSearchParams(location.hash.slice(1));document.getElementById("title").value=b.get("title"),document.getElementById("url").value=b.get("url");let a=b.get("description");a.length>250&&(a=a.slice(0,249)+"â€¦"),document.getElementById("description").value=a,"mastodonInstance"in localStorage&&(document.getElementById("instance").value=localStorage.mastodonInstance,document.getElementById("rememberInstance").checked=!0),document.getElementById("shareForm").addEventListener("submit",b=>{if(b.preventDefault(),b.target.disabled)return;let a=document.getElementById("instance").value.trim();if(a=a.replace(/^\w+:[\/\\]*/,""),a=a.replace(/[\/\\].*/,""),document.getElementById("instance").value=a,a=="")return;document.getElementById("rememberInstance").checked?localStorage.mastodonInstance=a:delete localStorage.mastodonInstance;let c=document.getElementById("title").value.trim(),d=document.getElementById("description").value.trim(),e=document.getElementById("url").value.trim(),f=c+"\n"+d+"\n"+e;getSoftwareName(a).then(h=>{let g=JSON.parse(document.body.getAttribute("data-projects")),b=g.hasOwnProperty(h)?g[h]:g.mastodon;b=b.replace("{title}",encodeURIComponent(c)),b=b.replace("{description}",encodeURIComponent(d)),b=b.replace("{url}",encodeURIComponent(e)),b=b.replace("{text}",encodeURIComponent(f)),location.href=`https://${a}/${b}`})}),document.getElementById("instance").addEventListener("input",updateState),updateState()})