<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>汇编基础 - Justice的小站</title>
<meta name=renderer content="webkit">
<meta name=referrer content="no-referrer">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="Justice">
<meta name=description content="汇编基础 基础知识 1.1 机器语言 机器语言是机器指令的集合。 机器指令是一系列二进制数字，计算机将之转换为一系列高低电平脉冲信号来驱动硬件工作的。 1.2 汇">
<meta name=keywords content="tech,it,blog">
<meta name=generator content="Hugo 0.88.1">
<link rel=canonical href=https://justice.bj.cn/post/14.language/asm/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/sass/jane.min.34a0cf3583dc0fd6b4e3fe24a36c076984feee75ebc2792cff33928ccdcfc628.css integrity="sha256-NKDPNYPcD9a04/4ko2wHaYT+7nXrwnks/zOSjM3Pxig=" media=screen crossorigin=anonymous>
<meta property="og:title" content="汇编基础">
<meta property="og:description" content="汇编基础 基础知识 1.1 机器语言 机器语言是机器指令的集合。 机器指令是一系列二进制数字，计算机将之转换为一系列高低电平脉冲信号来驱动硬件工作的。 1.2 汇">
<meta property="og:type" content="article">
<meta property="og:url" content="https://justice.bj.cn/post/14.language/asm/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2024-01-05T22:16:21+08:00">
<meta property="article:modified_time" content="2024-01-05T22:16:21+08:00"><meta property="og:site_name" content="Justice的小站">
<meta itemprop=name content="汇编基础">
<meta itemprop=description content="汇编基础 基础知识 1.1 机器语言 机器语言是机器指令的集合。 机器指令是一系列二进制数字，计算机将之转换为一系列高低电平脉冲信号来驱动硬件工作的。 1.2 汇"><meta itemprop=datePublished content="2024-01-05T22:16:21+08:00">
<meta itemprop=dateModified content="2024-01-05T22:16:21+08:00">
<meta itemprop=wordCount content="40076">
<meta itemprop=keywords content="language,asm,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="汇编基础">
<meta name=twitter:description content="汇编基础 基础知识 1.1 机器语言 机器语言是机器指令的集合。 机器指令是一系列二进制数字，计算机将之转换为一系列高低电平脉冲信号来驱动硬件工作的。 1.2 汇"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>Justice's Blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/>主页</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/post/>点滴</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/tags/>标签</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/categories/>分类</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=http://passer-by.com/pacman/ rel=noopener target=_blank>
更多
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6 21.568 21.632 54.144 54.208 54.144 54.208C534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0 30.72.0 55.04-24.512 55.04-54.848C512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408v-49.28C896 481.792 871.424 457.152 841.152 457.152z"/></svg>
</i>
</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<div class=modal-dialog>
<div class=modal-content>
<div id=fastSearch>
<input id=searchInput tabindex=0>
<ul id=searchResults>
</ul>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/ class=logo>
Justice's Blog
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/>主页</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/post/>点滴</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/tags/>标签</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/categories/>分类</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=http://passer-by.com/pacman/ rel=noopener target=_blank>
更多
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6 21.568 21.632 54.144 54.208 54.144 54.208C534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0 30.72.0 55.04-24.512 55.04-54.848C512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408v-49.28C896 481.792 871.424 457.152 841.152 457.152z"/></svg>
</i>
</a>
</li>
<li class=menu-item>
<a id=search-btn class="menu-item-link menu-item-search" href=#>
<i class=iconfont><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="18" height="18" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M973.81454219 973.81454219a91.78207815 91.78207815.0 01-129.80999631.0L682.0297247 811.83972101a425.48527711 425.48527711.0 01-230.35931791 68.16531768 428.3346319 428.3346319.0 11428.3346319-428.3346319A425.48527711 425.48527711.0 01811.83972101 682.0297247l162.02961656 161.97482118a91.83687354 91.83687354.0 01-.05479538 129.80999631zm-522.1441354-828.1209266a305.97679241 305.97679241.0 100 611.95358361 305.97679241 305.97679241.0 000-611.95358361z"/></svg>
</i>
</a>
</li>
</ul>
</nav>
</header>
<div id=mobile-panel>
<main id=main class="main bg-llight">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>汇编基础</h1>
<div class=post-meta>
<time datetime=2024-01-05 class=post-time>
2024-01-05 22:16:21
</time>
<div class=post-category>
<a href=https://justice.bj.cn/categories/language/> language </a>
<a href=https://justice.bj.cn/categories/asm/> asm </a>
</div>
<span id=busuanzi_container_page_pv>
| 阅读 <span id=busuanzi_value_page_pv></span>
</span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#基础知识>基础知识</a></li>
<li><a href=#11-机器语言>1.1 机器语言</a></li>
<li><a href=#12-汇编语言的产生>1.2 汇编语言的产生</a></li>
<li><a href=#13-汇编语言的组成>1.3 汇编语言的组成</a></li>
<li><a href=#14-存储器>1.4 存储器</a></li>
<li><a href=#15-指令和数据>1.5 指令和数据</a></li>
<li><a href=#16-存储单元>1.6 存储单元</a></li>
<li><a href=#17-cpu对存储器的读写>1.7 CPU对存储器的读写</a></li>
<li><a href=#18-地址总线>1.8 地址总线</a></li>
<li><a href=#19-数据总线>1.9 数据总线</a></li>
<li><a href=#110-控制总线>1.10 控制总线</a></li>
<li><a href=#小结>小结</a></li>
<li><a href=#检测点-11>检测点 1.1</a></li>
<li><a href=#111-内存地址空间概述>1.11 内存地址空间(概述)</a></li>
<li><a href=#112-主板>1.12 主板</a></li>
<li><a href=#113-接口卡>1.13 接口卡</a></li>
<li><a href=#114-各类存储器>1.14 各类存储器</a></li>
<li><a href=#115-内存地址空间>1.15 内存地址空间</a></li>
<li><a href=#寄存器cpu的工作原理>寄存器(CPU的工作原理)</a>
<ul>
<li><a href=#通用寄存器>通用寄存器</a></li>
<li><a href=#字在寄存器中的存储>字在寄存器中的存储</a></li>
<li><a href=#几条汇编指令>几条汇编指令</a></li>
</ul>
</li>
<li><a href=#24-物理地址>2.4 物理地址</a></li>
<li><a href=#25-16位结构的cpu>2.5 16位结构的CPU</a></li>
<li><a href=#26-8086-cpu给出物理地址的方法>2.6 8086 CPU给出物理地址的方法</a></li>
<li><a href=#27-段地址16偏移地址物理地址>2.7 段地址*16+偏移地址=物理地址</a></li>
<li><a href=#28-段的概念>2.8 段的概念</a></li>
<li><a href=#检测点-22>检测点 2.2</a></li>
<li><a href=#29-段寄存器>2.9 段寄存器</a></li>
<li><a href=#210-cs和ip>2.10 CS和IP</a></li>
<li><a href=#211-修改csip的指令>2.11 修改CS、IP的指令</a></li>
<li><a href=#212-代码段>2.12 代码段</a></li>
<li><a href=#检测点-23>检测点 2.3</a></li>
<li><a href=#使用debug>使用Debug</a></li>
</ul>
<ul>
<li><a href=#31-内存中字的存储>3.1 内存中字的存储</a></li>
<li><a href=#32-ds和address>3.2 DS和[address]</a></li>
<li><a href=#33-字型的传送>3.3 字型的传送</a></li>
<li><a href=#34-movaddsub指令>3.4 mov、add、sub指令</a></li>
<li><a href=#35-数据段>3.5 数据段</a></li>
<li><a href=#检测点-31>检测点 3.1</a></li>
<li><a href=#36-栈>3.6 栈</a></li>
<li><a href=#37-8086-cpu提供的栈机制>3.7 8086 CPU提供的栈机制</a></li>
<li><a href=#38-栈顶越界的问题>3.8 栈顶越界的问题</a></li>
<li><a href=#39-pushpop指令>3.9 push、pop指令</a></li>
<li><a href=#310-栈段>3.10 栈段</a></li>
<li><a href=#检测点-32>检测点 3.2</a></li>
</ul>
<ul>
<li><a href=#引言>引言</a></li>
<li><a href=#41-一个源程序从写出到执行的过程>4.1 一个源程序从写出到执行的过程</a></li>
<li><a href=#42-源程序>4.2 源程序</a></li>
<li><a href=#43-编辑源程序>4.3 编辑源程序</a></li>
<li><a href=#44-编译>4.4 编译</a></li>
<li><a href=#45-连接>4.5 连接</a></li>
<li><a href=#46-简化编译和连接>4.6 简化编译和连接</a></li>
<li><a href=#47-exe的执行>4.7 exe的执行</a></li>
<li><a href=#48-可执行文件中的程序转入内存并运行的原理>4.8 可执行文件中的程序转入内存并运行的原理</a></li>
<li><a href=#49-程序执行过程的跟踪>4.9 程序执行过程的跟踪</a></li>
</ul>
<ul>
<li><a href=#引言-1>引言</a></li>
<li><a href=#51-bx>5.1 [BX]</a></li>
<li><a href=#52-loop指令>5.2 loop指令</a></li>
<li><a href=#53-在debug中跟踪用loop指令实现的循环程序>5.3 在Debug中跟踪用loop指令实现的循环程序</a></li>
<li><a href=#54-debug和汇编编译器masm对指令的不同处理>5.4 Debug和汇编编译器Masm对指令的不同处理</a></li>
<li><a href=#55-loop和bx的联合应用>5.5 loop和[BX]的联合应用</a></li>
<li><a href=#56-段前缀>5.6 段前缀</a></li>
<li><a href=#57-一段安全的空间>5.7 一段安全的空间</a></li>
<li><a href=#58-段前缀的使用>5.8 段前缀的使用</a></li>
</ul>
<ul>
<li><a href=#61在代码段中使用数据>6.1在代码段中使用数据</a></li>
<li><a href=#62-在代码段中使用栈>6.2 在代码段中使用栈</a></li>
<li><a href=#63-将数据代码栈放入不同的段>6.3 将数据、代码、栈放入不同的段</a></li>
<li><a href=#检测点-61>检测点 6.1</a></li>
<li><a href=#实验五>实验五</a></li>
</ul>
<ul>
<li><a href=#71-and和or指令>7.1 and和or指令</a></li>
<li><a href=#72-关于ascii码>7.2 关于ASCII码</a></li>
<li><a href=#73-以字符形式给出数据>7.3 以字符形式给出数据</a></li>
<li><a href=#74-大小写转换的问题>7.4 大小写转换的问题</a></li>
<li><a href=#75-bxidata>7.5 [bx+idata]</a></li>
<li><a href=#76-用bxidata的方式进行数组的处理>7.6 用[bx+idata]的方式进行数组的处理</a></li>
<li><a href=#77-si和di>7.7 SI和DI</a></li>
<li><a href=#78-bxsi和bxdi>7.8 [bx+si]和[bx+di]</a></li>
<li><a href=#79-bxsiidata和bxdiidata>7.9 [bx+si+idata]和[bx+di+idata]</a></li>
<li><a href=#710-不同的寻址方式的灵活应用>7.10 不同的寻址方式的灵活应用</a></li>
</ul>
<ul>
<li><a href=#引言-2>引言</a></li>
<li><a href=#81-bxsidibp>8.1 bx、si、di、bp</a></li>
<li><a href=#82-机器指令处理的数据所在的位置>8.2 机器指令处理的数据所在的位置</a></li>
<li><a href=#83-汇编语言中数据位置的表达>8.3 汇编语言中数据位置的表达</a></li>
<li><a href=#84-寻址方式总小结>8.4 寻址方式总小结</a></li>
<li><a href=#85-指令要处理的数据有多长>8.5 指令要处理的数据有多长</a></li>
<li><a href=#86-寻址方式的综合应用>8.6 寻址方式的综合应用</a></li>
<li><a href=#87-div指令>8.7 div指令</a></li>
<li><a href=#88-伪指令dd>8.8 伪指令dd</a></li>
<li><a href=#89-伪指令dup>8.9 伪指令dup</a></li>
<li><a href=#实验七-寻址方式在结构化数据访问中的应用>实验七 寻址方式在结构化数据访问中的应用</a></li>
<li><a href=#转移指令的原理>转移指令的原理</a></li>
<li><a href=#引言-3>引言</a></li>
<li><a href=#91-操作符offset>9.1 操作符offset</a></li>
<li><a href=#92-jmp指令>9.2 jmp指令</a></li>
<li><a href=#93-依据位移进行转移的jmp指令>9.3 依据位移进行转移的jmp指令</a></li>
<li><a href=#94-转移的目的地址在指令中的jmp指令>9.4 转移的目的地址在指令中的jmp指令</a></li>
<li><a href=#附注3-汇编编译器masmexe对jmp的相关处理>附注3 汇编编译器(masm.exe)对jmp的相关处理</a></li>
<li><a href=#95-转移地址在寄存器中的jmp指令>9.5 转移地址在寄存器中的jmp指令</a></li>
<li><a href=#96-转移地址在内存中的jmp指令>9.6 转移地址在内存中的jmp指令</a></li>
<li><a href=#检测点-91>检测点 9.1</a></li>
<li><a href=#97-jcxz指令>9.7 jcxz指令</a></li>
<li><a href=#检测点-92>检测点 9.2</a></li>
<li><a href=#98-loop指令>9.8 loop指令</a></li>
<li><a href=#检测点-93>检测点 9.3</a></li>
<li><a href=#99-根据位移进行转移的意义>9.9 根据位移进行转移的意义</a></li>
<li><a href=#910-编译器对转移位移超界的检测>9.10 编译器对转移位移超界的检测</a></li>
</ul>
<ul>
<li><a href=#引言-4>引言</a></li>
<li><a href=#101-ret和retf指令>10.1 ret和retf指令</a></li>
<li><a href=#检测点-101>检测点 10.1</a></li>
<li><a href=#102-call指令>10.2 call指令</a></li>
<li><a href=#103-依据位移进行转移的call指令>10.3 依据位移进行转移的call指令</a></li>
<li><a href=#检测点-102>检测点 10.2</a></li>
<li><a href=#104-转移的目的地址在指令中的call指令>10.4 转移的目的地址在指令中的call指令</a></li>
<li><a href=#检测点-103>检测点 10.3</a></li>
<li><a href=#105-转移地址在寄存器中的call指令>10.5 转移地址在寄存器中的call指令</a></li>
<li><a href=#检测点-104>检测点 10.4</a></li>
<li><a href=#106-转移地址在内存中的call指令>10.6 转移地址在内存中的call指令</a></li>
<li><a href=#检测点-105>检测点 10.5</a></li>
<li><a href=#107-call和ret的配合使用>10.7 call和ret的配合使用</a></li>
<li><a href=#108-mull指令>10.8 mull指令</a></li>
<li><a href=#109-模块化程序设计>10.9 模块化程序设计</a></li>
<li><a href=#1010-参数和结果传递的问题>10.10 参数和结果传递的问题</a></li>
<li><a href=#1011-批量数据的传递>10.11 批量数据的传递</a></li>
<li><a href=#1012-寄存器冲突的问题>10.12 寄存器冲突的问题</a></li>
</ul>
<ul>
<li><a href=#引言-5>引言</a></li>
<li><a href=#111-zfzero-flag标志>11.1 ZF(zero flag)标志</a></li>
<li><a href=#112-pf标志>11.2 PF标志</a></li>
<li><a href=#113-sfsign-flag标志>11.3 SF(sign flag)标志</a></li>
<li><a href=#检测点-111>检测点 11.1</a></li>
<li><a href=#114-cfcarry-flag标志>11.4 CF(carry flag)标志</a></li>
<li><a href=#115-ofoverflow-flag标志>11.5 OF(overflow flag)标志</a></li>
<li><a href=#检测点-112>检测点 11.2</a></li>
<li><a href=#116-adc指令>11.6 adc指令</a></li>
<li><a href=#117-sbb指令>11.7 sbb指令</a></li>
<li><a href=#118-cmp指令>11.8 cmp指令</a></li>
<li><a href=#119-检测比较结果的条件转移指令>11.9 检测比较结果的条件转移指令</a></li>
<li><a href=#课堂练习>课堂练习</a></li>
<li><a href=#检测点-113>检测点 11.3</a></li>
<li><a href=#1110-dfdirection-flag标志和串传送指令>11.10 DF(direction flag)标志和串传送指令</a></li>
<li><a href=#1111-pushf和popf>11.11 pushf和popf</a></li>
<li><a href=#检测点-114>检测点 11.4</a></li>
<li><a href=#1112-标志寄存器在debug中的表示>11.12 标志寄存器在Debug中的表示</a></li>
</ul>
<ul>
<li><a href=#引言-6>引言</a></li>
<li><a href=#121-内中断的产生>12.1 内中断的产生</a></li>
<li><a href=#122-中断处理程序>12.2 中断处理程序</a></li>
<li><a href=#123-中断向量表>12.3 中断向量表</a></li>
<li><a href=#124-中断过程>12.4 中断过程</a></li>
<li><a href=#125-中断处理程序和iret指令>12.5 中断处理程序和iret指令</a></li>
<li><a href=#126-除法错误中断的处理>12.6 除法错误中断的处理</a></li>
<li><a href=#127-编程处理0号中断>12.7 编程处理0号中断</a></li>
<li><a href=#128-单步中断>12.8 单步中断</a></li>
<li><a href=#129-响应中断的特殊情况>12.9 响应中断的特殊情况</a></li>
</ul>
<ul>
<li><a href=#引言-7>引言</a></li>
<li><a href=#131-int-指令>13.1 int 指令</a></li>
<li><a href=#132-编写供应用程序调用的中断例程>13.2 编写供应用程序调用的中断例程</a></li>
<li><a href=#133-对intiret和栈的深入理解>13.3 对int、iret和栈的深入理解</a></li>
<li><a href=#137-dos中断例程应用>13.7 dos中断例程应用</a></li>
</ul>
<ul>
<li><a href=#引言-8>引言</a></li>
<li><a href=#141-端口的读写>14.1 端口的读写</a></li>
<li><a href=#142-cmos-ram芯片>14.2 CMOS RAM芯片</a></li>
<li><a href=#143-shl和shr指令>14.3 shl和shr指令</a></li>
<li><a href=#144-cmosram中存储的时间信息>14.4 CMOS　RAM中存储的时间信息</a></li>
</ul>
<ul>
<li><a href=#151接口芯片和端口>15.1接口芯片和端口</a></li>
<li><a href=#152外中断信息>15.2外中断信息</a></li>
<li><a href=#153pc机及键盘的处理过程>15.3PC机及键盘的处理过程</a></li>
<li><a href=#154编写int-9中断>15.4编写int 9中断</a></li>
<li><a href=#155安装新的int-9中断例程>15.5安装新的int 9中断例程</a></li>
</ul>
<ul>
<li><a href=#161-描述单元长度的标号>16.1 描述单元长度的标号</a></li>
<li><a href=#检测点-161>检测点 16.1</a></li>
<li><a href=#162-在其他段中使用数据标号>16.2 在其他段中使用数据标号</a></li>
<li><a href=#163-直接定址表>16.3 直接定址表</a></li>
<li><a href=#164-程序入口地址的直接定址表>16.4 程序入口地址的直接定址表</a></li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<h1 id=汇编基础>汇编基础</h1>
<h2 id=基础知识>基础知识</h2>
<h2 id=11-机器语言>1.1 机器语言</h2>
<ul>
<li>机器语言是机器指令的集合。</li>
<li>机器指令是一系列二进制数字，计算机将之转换为一系列高低电平脉冲信号来驱动硬件工作的。</li>
</ul>
<h2 id=12-汇编语言的产生>1.2 汇编语言的产生</h2>
<ul>
<li>由于机器语言指令都是由01组成,难以编写,记忆和维护程序.所以汇编语言为了解决这一问题产生。</li>
<li>汇编语言的主体是汇编指令，汇编指令是机器指令的助记符。</li>
<li><strong>寄存器：</strong> CPU中存储数据的器件，一个CPU中有多个寄存器。</li>
</ul>
<h2 id=13-汇编语言的组成>1.3 汇编语言的组成</h2>
<ul>
<li><strong>1、汇编指令</strong>(机器码的助记符，有对应的机器码)；</li>
<li><strong>2、伪指令</strong>(由编译器执行)和<strong>其他符号</strong>(由编译器识别)。</li>
</ul>
<h2 id=14-存储器>1.4 存储器</h2>
<ul>
<li>CPU工作需要指令和数据，指令和数据存储在存储器中。</li>
</ul>
<h2 id=15-指令和数据>1.5 指令和数据</h2>
<ul>
<li>在内存或者磁盘中存储的都是为二进制信息，<strong>指令和数据由我们设定(走的总线)</strong>。</li>
</ul>
<h2 id=16-存储单元>1.6 存储单元</h2>
<ul>
<li>存储器被划分为若干个存储单元，每个存储单元从0开始顺序编号。</li>
<li>B、KB、MB、GB、TB等单位。</li>
</ul>
<h2 id=17-cpu对存储器的读写>1.7 CPU对存储器的读写</h2>
<ul>
<li>
<p><strong>CPU要对数据进行读写，必须和外部器件进行以下三类信息的交互：</strong></p>
<ul>
<li><strong>1、存储单元的地址</strong>(地址信息)；</li>
<li><strong>2、器件的选择、读或写命令</strong>(控制信息)；</li>
<li><strong>3、读或写的数据</strong>(数据信息) 。</li>
</ul>
</li>
<li>
<p>总线是连接CPU和其他芯片的导线，逻辑上分为<strong>地址总线</strong>、<strong>数据总线</strong>、<strong>控制总线</strong>。</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-53052317c79589f5?imageMogr2/auto-orient/strip%7CimageView2/2/w/1069/format/webp alt></p>
<p>逻辑上总线的分类</p>
</li>
<li>
<p>CPU从内存单元中读写数据的过程：</p>
<ul>
<li>1、CPU通过地址线将地址信息发出；</li>
<li>2、CPU通过控制线发出内存读命令，选中存储器芯片，并通知它将要从中读或写数据；</li>
<li>3、存储器将相应的地址单元中的数据通过数据线送入CPU或CPU通过数据线将数据送入相应的内存单元。</li>
</ul>
</li>
</ul>
<h2 id=18-地址总线>1.8 地址总线</h2>
<ul>
<li>CPU是通过地址总线指定存储单元，地址总线传送的能力决定了CPU对存储单元的寻址能力。(一般32位CPU，寻址能力为2^32=4G)</li>
</ul>
<h2 id=19-数据总线>1.9 数据总线</h2>
<ul>
<li>CPU通过数据总线来与内存等器件进行数据传送，数据总线的宽度决定了CPU和外界的数据传送速度。</li>
</ul>
<h2 id=110-控制总线>1.10 控制总线</h2>
<ul>
<li>控制总线是一些不同控制的集合，CPU通过控制总线对外部器件的控制。控制总线的宽度决定了CPU对外部器件的控制能力。</li>
</ul>
<h2 id=小结>小结</h2>
<ul>
<li>1、汇编指令时机器指令的助记符，与机器指令一一对应。</li>
<li>2、每一种CPU都有自己的汇编指令集。</li>
<li>3、CPU可以直接使用的信息在存储器中存放。</li>
<li>4、在存储器中指令和数据都是二进制信息。</li>
<li>5、存储单元从0开始顺序编号。</li>
<li>6、一个存储单元可以存储8个bit。</li>
<li>7、B、KB、MB、GB等单位之间的转换。</li>
<li>8、CPU管脚和总线相连。总线的宽度表示CPU不同方面的性能：
<ul>
<li>地址总线的宽度决定了CPU的寻址能力；</li>
<li>数据总线的宽度决定了CPU与其他器件进行一次数据传送的量；</li>
<li>控制总线宽度决定了CPU对系统中其他器件的控制。</li>
</ul>
</li>
</ul>
<h2 id=检测点-11>检测点 1.1</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-49b9c21cffa7dddd?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点1.1</p>
<h2 id=111-内存地址空间概述>1.11 内存地址空间(概述)</h2>
<ul>
<li>CPU可寻的内存单元构成这个CPU的内存地址空间。例如一个CPU的地址总线宽度为10，那么可以寻址的1024个内存单元构成了这个CPU的内存空间。</li>
</ul>
<h2 id=112-主板>1.12 主板</h2>
<ul>
<li>主板主板，主要的电路板 :laughing:</li>
</ul>
<h2 id=113-接口卡>1.13 接口卡</h2>
<ul>
<li>CPU通过接口卡间接控制外部设备。</li>
</ul>
<h2 id=114-各类存储器>1.14 各类存储器</h2>
<ul>
<li>
<p>随机存储器RAM(主板上的RAM、拓展插槽上的RAM和接口卡上的RAM)和只读存储器器ROM(装有BIOS的ROM)。</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-e732472a2884d7ce?imageMogr2/auto-orient/strip%7CimageView2/2/w/1092/format/webp alt></p>
<p>PC集中各类存储器的逻辑连接</p>
</li>
</ul>
<h2 id=115-内存地址空间>1.15 内存地址空间</h2>
<ul>
<li>
<p><strong>各类存储器在物理上是独立的，但是：</strong></p>
<ul>
<li><strong>1、都和CPU的总线相连；</strong></li>
<li><strong>2、 CPU对他们进行读或写的时候都通过控制线发出的内存读写命令。</strong></li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-3bd8fe8536434790?imageMogr2/auto-orient/strip%7CimageView2/2/w/1086/format/webp alt></p>
<p>将各类存储器看作一个逻辑存储器</p>
</li>
<li>
<p>不同的计算机系统的内存地址空间分配情况是不同的。</p>
</li>
</ul>
<hr>
<h2 id=寄存器cpu的工作原理>寄存器(CPU的工作原理)</h2>
<ul>
<li>CPU由运算器、控制器、寄存器 等器件组成，靠内部总线相连。</li>
<li>内部总线实现CPU内部各器件之间的联系；外部总线实现CPU和主板上其他器件的联系。</li>
<li>在CPU中：
<ul>
<li>运算器进行信息处理；</li>
<li>寄存器进行信息存储；</li>
<li>控制器控制各种器件进行工作；</li>
<li>内部总线连接各种器件在它们之间进行数据的传送。</li>
</ul>
</li>
</ul>
<h3 id=通用寄存器>通用寄存器</h3>
<ul>
<li>8086有14个寄存器：
<ul>
<li><strong>AX、BX、CX、DX、SI、DI、SP、BP、IP、CS、SS、CS、ES、PSW</strong>。</li>
</ul>
</li>
<li>AX、BX、CX、DX通常用来存放一般性数据，被称为通用寄存器。</li>
<li>16位寄存器所能存储的数据最大值为216-1 。</li>
<li>为保证兼容性，8086 CPU的通用寄存器可以分为两个独立的8位寄存器使用。<strong>例：</strong> AX可分为AH和AL。</li>
</ul>
<h3 id=字在寄存器中的存储>字在寄存器中的存储</h3>
<ul>
<li>
<p>8086 CPU所有的寄存器是16位，可以存放2个字节(一个字)。</p>
</li>
<li>
<p>一字节由8 bit 组成，可以存在8位寄存器中。</p>
</li>
<li>
<p>字(word)是两字节，16位。</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-ead3e9daffcbe850?imageMogr2/auto-orient/strip%7CimageView2/2/w/716/format/webp alt></p>
<p>一个字由两个字节组成</p>
</li>
</ul>
<h3 id=几条汇编指令>几条汇编指令</h3>
<ul>
<li>
<p>汇编指令对大小写不敏感</p>
<p>汇编指令举例</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>汇编指令</th>
<th>控制CPU完成的操作</th>
<th>用高级语言的语法描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>mov ax，18</td>
<td>将8送入AX</td>
<td>AX=18</td>
</tr>
<tr>
<td>mov ah，78</td>
<td>将78送入AH</td>
<td>AH=78</td>
</tr>
<tr>
<td>add ax，8</td>
<td>将寄存器AX中的数值加上8结果存入AX中</td>
<td>AX=AX+8</td>
</tr>
<tr>
<td>mov ax，bx</td>
<td>将寄存器BX中的数据送入寄存器AX</td>
<td>AX=BX</td>
</tr>
<tr>
<td>add ax，bx</td>
<td>将AX，BX中的内容相加结果存入AX中</td>
<td>AX=AX+BX</td>
</tr>
</tbody>
</table>
<h2 id=24-物理地址>2.4 物理地址</h2>
<ul>
<li>所有的内存单元构成一个一维的线性存储空间。</li>
<li>CPU访问内存单元时要给出内存单元的唯一地址就是物理地址。</li>
</ul>
<h2 id=25-16位结构的cpu>2.5 16位结构的CPU</h2>
<ul>
<li>1、运算器一次最多可以处理16位数据。</li>
<li>2、 寄存器的最大宽度为16位。</li>
<li>3、寄存器和运算器之间的通路是16位。</li>
</ul>
<h2 id=26-8086-cpu给出物理地址的方法>2.6 8086 CPU给出物理地址的方法</h2>
<ul>
<li>8086有20位的地址总线，可以传送20位地址，寻址能力为1M；但8086内部为16位结构，只能传送16位的地址。</li>
<li><strong>8086CPU采用一种在内部用两个16位地址合成的方法来形成一个20位的物理地址。</strong></li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-9824e3b568988f7e?imageMogr2/auto-orient/strip%7CimageView2/2/w/1132/format/webp alt></p>
<p>8086CPU相关部件的逻辑结构</p>
<ul>
<li>8086CPU读写内存的步骤：
<ul>
<li>1、CPU中的相关部件提供段子和偏移地址这两个16位的地址；</li>
<li>2、段地址和偏移地址通过内部总线送入到一个称为地址加法器的部件；</li>
<li>3、地址加法器将两个16位地址合并成一个20位的地址；</li>
<li>4、地址加法器通过内部总线将20位物理地址送送入输入输出地址；</li>
<li>5、输入输出控制电路将20位物理地址送上地址总线；</li>
<li>6、20位物理地址被地址总线传送到存储器。</li>
</ul>
</li>
<li>地址加法器工作原理：<font color=red>物理地址=段地址*16+偏移地址</font>。</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-4b4bb1b2b669a6eb?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>地址加法器的过程</p>
<ul>
<li>段地址*16就是数据左移4位(二进制)</li>
</ul>
<table>
<thead>
<tr>
<th>移位位数</th>
<th>二进制</th>
<th>十六进制</th>
<th>十进制</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>10B</td>
<td>2H</td>
<td>2</td>
</tr>
<tr>
<td>1</td>
<td>100B</td>
<td>4H</td>
<td>4</td>
</tr>
<tr>
<td>2</td>
<td>1000B</td>
<td>8H</td>
<td>8</td>
</tr>
<tr>
<td>3</td>
<td>10000B</td>
<td>10H</td>
<td>16</td>
</tr>
<tr>
<td>4</td>
<td>100000B</td>
<td>20H</td>
<td>32</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>一个数据的二进制形式左移N位，相当于该数据乘以2的N次方。一个数据X进制形式左移N位，相当乘以NX。</strong></li>
</ul>
<h2 id=27-段地址16偏移地址物理地址>2.7 段地址*16+偏移地址=物理地址</h2>
<ul>
<li><strong>CPU可以通过不同的段地址和偏移地址形成一个相同的物理地址。</strong></li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-560c96803af9fea7?imageMogr2/auto-orient/strip%7CimageView2/2/w/752/format/webp alt></p>
<p>CPU可以通过不同的段地址和偏移地址形成相同的物理地址</p>
<blockquote>
<p>段地址*16是移位</p>
</blockquote>
<h2 id=28-段的概念>2.8 段的概念</h2>
<ul>
<li>
<p>人为定义的，将若干地址连续的内存单元看作一个段。用段地址*16定位段的起始地址(基址)，用偏移地址定位段中的内存单元。</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-6597616350aa5f22?imageMogr2/auto-orient/strip%7CimageView2/2/w/1193/format/webp alt></p>
<p>段的概念</p>
</li>
<li>
<p><strong>一个段的起始地址是16的倍数。偏移地址为16位，寻址能力为64K，所以段的最大长度也是64K。</strong></p>
</li>
</ul>
<h2 id=检测点-22>检测点 2.2</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-e8aacd40f8697825?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点2.2</p>
<h2 id=29-段寄存器>2.9 段寄存器</h2>
<ul>
<li>8086 CPU有4个段寄存器:<strong>CS(代码段)、DS(数据段)、SS(堆栈段)、ES(附加段)</strong>，这4个段提供给8086CPU内存单元的段地址。</li>
</ul>
<h2 id=210-cs和ip>2.10 CS和IP</h2>
<ul>
<li>
<p><strong>CS(代码段寄存器)</strong> 和<strong>IP(指令指针寄存器)</strong> 是8086CPU中最关键的寄存器，它们指示了CPU当前要读取指令的地址。在任意时刻CPU将CS:IP指向的内容当作指令执行。</p>
</li>
<li>
<p>8086CPU工作过程的简要概述：</p>
<ul>
<li>
<p>1、从CS:IP指向内存单元读取指令，读取的指令进入指令缓冲器；</p>
<blockquote>
<p>8086PC机刚开始启动时，CPU从内存FFFF0h单元中读取指令执行，FFFF0h单元中的指令时8086PC机开机后执行的第一条指令。</p>
</blockquote>
</li>
<li>
<p>2、 IP=IP+所读取指令的长度，从而正确的指向下一条指令；</p>
</li>
<li>
<p>3、执行指令。转到步骤1，周而复始。</p>
</li>
</ul>
</li>
</ul>
<h2 id=211-修改csip的指令>2.11 修改CS、IP的指令</h2>
<ul>
<li><strong>mov指令(传送指令)</strong> 可以改变8086CPU大部分寄存器的值，但不能用于设置CS、IP的值。</li>
<li><strong>jmp指令(转移指令)</strong> 可以用来同时修改CS和IP的值，格式为</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>jmp</span> <span class=err>段地址</span><span class=p>:</span><span class=err>偏移地址</span><span class=c>;同时修改CS和IP
</span><span class=c></span><span class=no>jmp</span> <span class=err>某一合法寄存器</span><span class=c>;则是仅修改IP
</span></code></pre></td></tr></table>
</div>
</div><h2 id=212-代码段>2.12 代码段</h2>
<ul>
<li>对于8086PC机，在编程时可以将长度为N(N小于等于64KB)的一组代码存在一组地址连续、起始地址为16的倍数的内存单元中，这段内存是用来存放代码的，从而定义了一个代码段。</li>
<li>利用CS:IP来指向内存单元从而让CPU执行其中的内容。</li>
</ul>
<h2 id=检测点-23>检测点 2.3</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-711ba804eb6c1227?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点2.3</p>
<h2 id=使用debug>使用Debug</h2>
<blockquote>
<p><font color=red>windows xp系统自带debug，请使用xp以上系统的读者执行自行下载debug.exe和dosbox，使用方法笔者不再赘述，在dosbox中可以使用debug。</font></p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-18b59a388c90a05b?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>debug in dosbox</p>
</blockquote>
<ul>
<li><strong>可以使用汇编金手指查阅指令。</strong></li>
<li><strong>R</strong>命令查看、改变CPU寄存器的内容；</li>
<li><strong>D</strong>命令查看内存中的内容；</li>
<li><strong>E</strong>命令改写内存中的内容；</li>
<li><strong>U</strong>命令将内存中的机器指令翻译成汇编指令；</li>
<li><strong>T</strong>命令执行一条机器指令；</li>
<li><strong>G</strong>命令跳转到偏移地址；</li>
<li><strong>P</strong>命令结束循环或者是int 21H时是退出程序；</li>
<li><strong>A</strong>命令是以汇编指令的格式在内存中写入一条机器指令。</li>
</ul>
<hr>
<h1 id=三寄存器内存访问>三、寄存器(内存访问)</h1>
<h2 id=31-内存中字的存储>3.1 内存中字的存储</h2>
<ul>
<li>字是两个字节，要用两个地址连续的内存来存放，字的低位字节存在低地址中，高位字节存放在高地址单元中。</li>
</ul>
<h2 id=32-ds和address>3.2 DS和[address]</h2>
<ul>
<li>DS通常存放要访问的数据的段地址。</li>
<li><strong>8086 CPU由于硬件的设计不支持将数据直接送入段寄存器的操作。</strong></li>
</ul>
<blockquote>
<p>数据 -> 通用寄存器 -> 段寄存器</p>
</blockquote>
<ul>
<li><input disabled type=checkbox> 里边的数据代表偏移地址值</li>
<li><strong>mov指令：</strong>
<ul>
<li>将数据直接送入寄存器；</li>
<li>将一个寄存器或内存单元中的内容送入另一个寄存器；</li>
</ul>
</li>
<li>mov指令格式:</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mov</span> <span class=err>寄存器名</span><span class=p>,</span><span class=err>内存单元</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=33-字型的传送>3.3 字型的传送</h2>
<ul>
<li>高地址单元和高8位寄存器，低地址单元和低8位寄存器相对应。</li>
</ul>
<h2 id=34-movaddsub指令>3.4 mov、add、sub指令</h2>
<ul>
<li>有两个操作对象，jmp只有一个操作对象。</li>
<li><strong>使用汇编金手指查阅指令</strong></li>
<li><strong>mov指令的几种形式</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mov</span> <span class=err>寄存器</span><span class=p>,</span><span class=err>数据</span><span class=c>;mov ax,8
</span><span class=c></span><span class=no>mov</span> <span class=err>寄存器</span><span class=p>,</span><span class=err>寄存器</span><span class=c>;mov ax,bx
</span><span class=c></span><span class=no>mov</span> <span class=err>寄存器</span><span class=p>,</span><span class=err>内存单元</span><span class=c>;mov ax,[0]
</span><span class=c></span><span class=no>mov</span> <span class=err>内存单元</span><span class=p>,</span><span class=err>寄存器</span><span class=c>;mov [0],ax
</span><span class=c></span><span class=no>mov</span> <span class=err>段寄存器</span><span class=p>,</span><span class=err>寄存器</span><span class=c>;mov ds,ax
</span><span class=c></span><span class=no>mov</span> <span class=err>寄存器</span><span class=p>,</span><span class=err>段寄存器</span><span class=c>;mov ax,ds
</span><span class=c></span>     <span class=err>……</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>add指令的几种形式</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>add</span> <span class=err>通用寄存器</span><span class=p>,</span><span class=err>数据</span>
<span class=nf>add</span> <span class=err>通用寄存器</span><span class=p>,</span><span class=err>通用寄存器</span>
<span class=nf>add</span> <span class=err>通用寄存器</span><span class=p>,</span><span class=err>内存单元</span>
<span class=nf>add</span> <span class=err>内存单元</span><span class=p>,</span><span class=err>寄存器</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>sub指令的几种形式</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>sub</span> <span class=err>通用寄存器</span><span class=p>,</span><span class=err>数据</span>
<span class=nf>sub</span> <span class=err>通用寄存器</span><span class=p>,</span><span class=err>通用寄存器</span>
<span class=nf>sub</span> <span class=err>通用寄存器</span><span class=p>,</span><span class=err>内存单元</span>
<span class=nf>sub</span> <span class=err>内存单元</span><span class=p>,</span><span class=err>通用寄存器</span>  
</code></pre></td></tr></table>
</div>
</div><h2 id=35-数据段>3.5 数据段</h2>
<ul>
<li>对于8086PC机，在编程时可以将长度为N(N小于等于64KB)的一组代码存在一组地址连续、起始地址为16的倍数的内存单元中，这段内存是用来存放数据的，从而定义了一个数据段。</li>
<li>可以通过在DS中存放数据段的段地址，用相关的指令访问数据段中的具体单元来访问数据段中的数据。</li>
</ul>
<h2 id=检测点-31>检测点 3.1</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-e239cbea7e2391a7?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点3.1</p>
<h2 id=36-栈>3.6 栈</h2>
<ul>
<li>具有特殊的访问方式的存储空间，也是内存空间的一部分，数据<strong>先进后出。</strong></li>
<li>有两个基本操作:
<ul>
<li>入栈：将一个新的元素放到栈顶；</li>
<li>出栈：从栈顶取出一个元素。</li>
</ul>
</li>
<li>栈顶元素最后入栈最先出栈。</li>
</ul>
<h2 id=37-8086-cpu提供的栈机制>3.7 8086 CPU提供的栈机制</h2>
<ul>
<li>现今的CPU都有栈的设计，基于8086CPU编程可以将一段内存当作栈来使用。</li>
<li>8086CPU的<strong>入栈(PUSH)<strong>和</strong>POP(出栈)</strong>，以字为单位。
<ul>
<li>push ax 将寄存器ax中的数据送入栈</li>
<li>pop ax 从栈顶取出数据送入ax</li>
</ul>
</li>
<li><strong>段寄存器SS存放栈顶的段地址，寄存器SP存放栈顶的偏移地址。任意时刻SS:SP指向栈顶元素。push时SP先自减法后写内存，pop先读内存sp后自加。</strong></li>
<li>pop之后数据还是存在内存中，push时覆盖。</li>
</ul>
<blockquote>
<p><font color=red>CS和IP存放当前指令的段地址和偏移地址。</font></p>
</blockquote>
<h2 id=38-栈顶越界的问题>3.8 栈顶越界的问题</h2>
<ul>
<li><strong>栈是空的，则SP指向栈底+1的内存。</strong></li>
<li>8086 CPU只纪录栈顶，栈空间由自己控制。栈顶越界问题导致溢出漏洞。</li>
<li>8086CPU只考虑当前的情况：
<ul>
<li>当前栈顶在何处；</li>
<li>当前要执行的指令时哪一条。</li>
</ul>
</li>
</ul>
<h2 id=39-pushpop指令>3.9 push、pop指令</h2>
<ul>
<li>可以直接对段寄存器使用。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;push和pop格式
</span><span class=c></span><span class=nf>push</span> <span class=err>寄存器</span>
<span class=nf>pop</span> <span class=err>寄存器</span>
<span class=nf>push</span> <span class=err>段寄存器</span>
<span class=nf>pop</span> <span class=err>段寄存器</span>
<span class=nf>push</span> <span class=err>内存单元</span>
<span class=nf>pop</span> <span class=err>内存单元</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>通用寄存器命名是x结尾的，段寄存器是以s结尾。</strong></li>
<li>CPU在执行指令时，数据的段地址是从DS中获得，代码是在CS中获得，栈地址是从SS获得。</li>
</ul>
<h2 id=310-栈段>3.10 栈段</h2>
<ul>
<li>对于8086PC机，在编程时可以将长度为N(N小于等于64KB)的一组代码存在一组地址连续、起始地址为16的倍数的内存单元中，这段内存是当作栈来用，从而定义了一个栈段。</li>
<li><strong>寄存器清零可用sub ax,ax或者直接赋值0，</strong><font color=red>常见的也有使用xor</font>。</li>
<li>当栈空间定义为最大时，栈为空时SP=0。</li>
</ul>
<h2 id=检测点-32>检测点 3.2</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-09698a94092b3921?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点3.2</p>
<hr>
<h1 id=四第一个程序>四、第一个程序</h1>
<h2 id=引言>引言</h2>
<p>编写完成的汇编语言程序，用编译器编译成可执行文件并在操作系统中运行。</p>
<h2 id=41-一个源程序从写出到执行的过程>4.1 一个源程序从写出到执行的过程</h2>
<ul>
<li>
<p>编写</p>
<ul>
<li>用编辑器(Sublime Text、Nodepad++、UltraEdit)编写，文件后缀为.asm。</li>
</ul>
</li>
<li>
<p>编译链接</p>
<ul>
<li>使用MASM.EXE编译生产obj(目标文件)。masm也请读者自行搜索下载。</li>
<li>LINKE.EXE对目标文件进行连接生产可在操作系统中直接运行的可执行文件。</li>
</ul>
<blockquote>
<p>可执行文件包含程序(机器码)、数据(源程序中定义的数据)和相关的描述信息。</p>
</blockquote>
</li>
<li>
<p>执行</p>
<ul>
<li>操作系统中依照可执行文件中的描述信息将可执行文件中的机器码和数据加载入内存并进行相关的初始化，然后CPU执行。</li>
</ul>
</li>
</ul>
<h2 id=42-源程序>4.2 源程序</h2>
<ul>
<li>汇编指令：有对应的机器码的指令，编译为机器码被CPU执行</li>
<li>伪指令：没有对应的机器码，不被CPU所执行，由编译器执行来进行相关的编译工作。
<ul>
<li>segment和ends是用来定义一个段的，是成对使用的伪指令，再写可被编译器编译的汇编程序是必须要用的。</li>
</ul>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span> <span class=c>;假设代码段的名称为codesg
</span><span class=c></span><span class=no>codesg</span> <span class=no>segment</span> <span class=c>;定义一个codesg段
</span><span class=c></span><span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0123</span><span class=no>H</span>
<span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0456</span><span class=no>H</span>
<span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=no>bx</span>
<span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=no>ax</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
<span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span> <span class=c>;codesg段结束
</span><span class=c></span><span class=no>end</span> <span class=c>;是个伪指令，程序的结束标记
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>assume用来加上某一段寄存器和程序中的某一用segment……ends定义的段相关联。通过assume说明这种关联，在需要的情况下编译程序可以将段寄存器和某一个具体的段相联系。</p>
</blockquote>
<ul>
<li>
<p>一个汇编程序是由多个段组成。一个有意义的汇编程序中至少要用一个段来存放代码。</p>
</li>
<li>
<p>程序与源程序</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-8ab4e87dd9bbde24?imageMogr2/auto-orient/strip%7CimageView2/2/w/1064/format/webp alt></p>
<p>程序与源程序</p>
</li>
<li>
<p>标号:指代地址</p>
</li>
<li>
<p>程序的结构</p>
</li>
<li>
<p>小练习：</p>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>;编程运算2^3
assume cs:abc ;段与寄存器关联

abc segment ;定义一个段，名称为abc
mov ax,2;写入汇编指令
add ax,ax
add ax,ax

abd ends      
end ;程序结束处
</code></pre></td></tr></table>
</div>
</div><ul>
<li>程序的返回:一个程序结束后将CPU的控制权交还给使它得以运行的程序的过程。应该在程序的末尾添加返回的程序段。</li>
</ul>
<blockquote>
<p>codesg：放在segment前面，作为一个段的名称，这个段的名称最终将被编译、连接程序，称为一个段的段地址 。</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span>
<span class=nf>int</span> <span class=mi>21</span><span class=no>H</span> <span class=c>;第21号中断
</span><span class=c>;这两条指令说实现的功能就是程序返回。
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>语法错误和逻辑错误</li>
</ul>
<h2 id=43-编辑源程序>4.3 编辑源程序</h2>
<ul>
<li>使用编辑器编辑，扩展名为.asm</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>ABC</span>
    <span class=nf>ABC</span> <span class=no>segment</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2</span>
        <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=no>ax</span>
        <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=no>ax</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span>
        <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>ABC</span> <span class=no>ends</span>
    <span class=nf>end</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=44-编译>4.4 编译</h2>
<ul>
<li>
<p>masn和 1.asm在同一目录中，dos下使用masm 1.asm命令即可生产1.obj文件。</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-f8fcce1ff248f598?imageMogr2/auto-orient/strip%7CimageView2/2/w/734/format/webp alt></p>
<p>源程序文件和masm文件在同一目录下</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-b748f628ebd542f0?imageMogr2/auto-orient/strip%7CimageView2/2/w/638/format/webp alt></p>
<p>编译源程序</p>
</li>
</ul>
<h2 id=45-连接>4.5 连接</h2>
<ul>
<li>
<p>link 1.obj，生成exe文件，摁enter忽略编译程序提示输入的信息。</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-14277059d9a747c8?imageMogr2/auto-orient/strip%7CimageView2/2/w/684/format/webp alt></p>
<p>连接程序</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-bed4f2755e48ef24?imageMogr2/auto-orient/strip%7CimageView2/2/w/398/format/webp alt></p>
<p>连接生成exe</p>
</li>
<li>
<p>当源程序很大时，可以将它分成多个源程序文件编译，每个源程序编译成目标文件后再用连接程序将他们连接到一起，生成一个可执行文件。或者程序中调用了某个库文件中的子程序，需要将这个库文件和该目标文件连接到一起，生成一个可执行文件。或者一个源程序编译后得到存有机器码的目标文件，目标文件中的有些内容还不能直接生成可执行文件，连接程序将此内容处理为最终的可执行文件信息。</p>
</li>
</ul>
<h2 id=46-简化编译和连接>4.6 简化编译和连接</h2>
<ul>
<li>使用ml命令，ml 1.asm</li>
</ul>
<h2 id=47-exe的执行>4.7 exe的执行</h2>
<ul>
<li>为兼容16位的程序，使用dosbox运行。</li>
</ul>
<h2 id=48-可执行文件中的程序转入内存并运行的原理>4.8 可执行文件中的程序转入内存并运行的原理</h2>
<ul>
<li>
<p>在dos中可执行文件中的程序p1若要运行吗必须有一个正在运行的程序p2将p1从可执行文件中加载如内存，将CPU的控制权交给它，p1才能得以运行；当p1运行完毕后，应该将CPU的控制权交还给使它de&rsquo;yi 运行的程序p2。</p>
</li>
<li>
<p>汇编程序从写出到执行的过程：编程 -> 编译 -> 连接 -> 加载 -> 内存中的程序 -> 运行</p>
</li>
<li>
<p>在dos系统中.exe文件中的加载过程</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-9c1fe0ce667bd8fa?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>exe文件中程序的加载过程</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-8791de91608948fb?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>psp的内容</p>
</li>
</ul>
<h2 id=49-程序执行过程的跟踪>4.9 程序执行过程的跟踪</h2>
<ul>
<li>使用debug(xp以上的系统在dosbox中使用)来跟踪一个程序的运行过程。</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-5c58ee6940b92d46?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>使用debug来跟踪程序运行</p>
<hr>
<h1 id=五bx和loop指令>五、[BX]和loop指令</h1>
<h2 id=引言-1>引言</h2>
<ul>
<li>约定符号()来表示一个寄存器或者一个内存单元中的内容。<strong>例如</strong>(ax)=0010H表示ax中的内容为0010H；(21000H)=0010H，表示2000:1000处的内容为0010H。</li>
<li>约定符号idata表示常量。</li>
</ul>
<h2 id=51-bx>5.1 [BX]</h2>
<ul>
<li><strong>inc指令是自增1的意思</strong></li>
<li>和[0]有些类似，[0]表示内存单元，它的偏移地址是0。[bx]也是表示一个内存单元，它的内存偏移地址在bx中。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span>
<span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>用以下两种信息描述一个内存单元：
<ul>
<li>1、内存单元的地址；</li>
<li>2、内训单元的长度(类型)。</li>
</ul>
</li>
</ul>
<blockquote>
<p>我们用[0]表示一个内训单元时，0表示单元的偏移地址，段地址默认在DS中，单元的长度(类型)可以由具体指令中的其他的操作对象(比如说寄存器)指出。</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=mi>0</span><span class=p>]</span><span class=c>;0对应的字单元，主要单位要看操作对象(寄存器)
</span><span class=c></span><span class=no>mov</span> <span class=no>al</span><span class=p>,[</span><span class=mi>0</span><span class=p>]</span><span class=c>;字节
</span></code></pre></td></tr></table>
</div>
</div><h2 id=52-loop指令>5.2 loop指令</h2>
<ul>
<li>指令的格式是loop 标号。CUP执行loop指令时要进两步操作：
<ul>
<li><strong>CX中存放循环的次数，执行时CX中的内容自减1。相当于C的do while</strong></li>
<li><strong>判断CX中的值，不为0则转至标号处执行程序，为0则向下执行。</strong></li>
</ul>
</li>
<li>通常loop指令来实现循坏功能CX中存放循环的次数。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
       <span class=nf>code</span> <span class=no>segment</span>
       <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2</span>
       <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=no>ax</span>

       <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span>
       <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;计算2^3
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
<span class=nf>code</span> <span class=no>segment</span>
     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2</span>
     <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=no>ax</span>
     <span class=nf>add</span><span class=p>,</span><span class=no>ax</span><span class=p>,</span><span class=no>ax</span>

     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span>
     <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;计算2^12
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
<span class=nf>code</span> <span class=no>segment</span>
<span class=nl>start:</span>  <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2</span>
        <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>11</span>
      <span class=nl>p:</span><span class=nf>add</span><span class=p>,</span><span class=no>ax</span><span class=p>,</span><span class=no>ax</span>       
        <span class=no>loop</span> <span class=no>p</span><span class=c>;p是标号
</span><span class=c></span>
       <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span><span class=c>;masm默认数字是十进制
</span><span class=c></span>       <span class=no>int</span> <span class=mi>21</span><span class=no>H</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;编程计算123*236，结果放在ax中
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
<span class=nf>code</span> <span class=no>segment</span>
<span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
      <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>236</span>
   <span class=nl>an:</span><span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=mi>123</span>
     <span class=nf>loop</span> <span class=no>an</span>
      <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span>
      <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
<span class=nf>code</span> <span class=no>segment</span>
<span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
      <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>123</span>
  <span class=nl>pa:</span><span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=mi>236</span>
      <span class=nf>loop</span> <span class=no>pa</span>

      <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span>
      <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>

<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=53-在debug中跟踪用loop指令实现的循环程序>5.3 在Debug中跟踪用loop指令实现的循环程序</h2>
<ul>
<li><strong>注意：在汇编源程序中数据不能以字母开头，有字母的在前面加0处理。</strong></li>
<li>t命令单步执行、G命令和P命令。</li>
<li><strong>使用汇编金手指查阅指令。</strong></li>
</ul>
<h2 id=54-debug和汇编编译器masm对指令的不同处理>5.4 Debug和汇编编译器Masm对指令的不同处理</h2>
<ul>
<li>
<p><strong>Degug中mov ax,[0]，表示将ds:0处的数据存入al中。ah=0，因为一个内存单元是8位的，ax是16位的，同位存储。而编译器[0]会被当作0处理</strong></p>
</li>
<li>
<p>将内存2000:0、2000:1、2000:2、2000:3单元中的数据(字节)送入阿al、bl、cl、dl中。</p>
<ul>
<li>debug中：</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-8230644591c4ec15?imageMogr2/auto-orient/strip%7CimageView2/2/w/643/format/webp alt></p>
<p>debug 1</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-ee9dc6b8a6d84aa7?imageMogr2/auto-orient/strip%7CimageView2/2/w/643/format/webp alt></p>
<p>debug 3</p>
<ul>
<li>在MASM中：</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-c7ec6af22c58c409?imageMogr2/auto-orient/strip%7CimageView2/2/w/644/format/webp alt></p>
<p>1masmtest</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-409db2af5cec6107?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>masmtest2</p>
<ul>
<li><strong>要在编译器中实现用偏移地址[]中的内容传送先bx来代替，mov 偏移地址,bx 再 mov al,[bx]。如要直接使用<input disabled type=checkbox> 则要加上段地址ds:[偏移地址]</strong></li>
</ul>
</li>
<li>
<p>在MASM中：</p>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=mi>0</span><span class=p>]</span> <span class=c>;将al赋值0
</span><span class=c></span><span class=no>mov</span> <span class=no>al</span><span class=p>,</span><span class=no>ds</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=c>;将al赋值段地址为ds，偏移地址为0的内存单元中的内容
</span><span class=c></span><span class=no>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span> <span class=c>;默认段地址为ds，将al赋值偏移地址为bx
</span><span class=c></span><span class=no>mov</span> <span class=no>al</span><span class=p>,</span><span class=no>ds</span><span class=p>:[</span><span class=no>bx</span><span class=p>]</span> <span class=c>;将al赋值段地址为ds，偏移地址为bx
</span></code></pre></td></tr></table>
</div>
</div><h2 id=55-loop和bx的联合应用>5.5 loop和[BX]的联合应用</h2>
<ul>
<li>可以用循环来解决处理地址连续的内存单元中的数据的问题，用变量来给出内存单元的地址。</li>
</ul>
<h2 id=56-段前缀>5.6 段前缀</h2>
<ul>
<li>出现在访问内存单元的指令中用显式地指明内存单元的段地址的ds、cs、ss、es称为段前缀。<strong>没有显式地给出内存单元的段地址则默认在ds中。</strong></li>
</ul>
<h2 id=57-一段安全的空间>5.7 一段安全的空间</h2>
<blockquote>
<p>在8086模式中，随意向一段内存空间写入数据是危险的，因为这段空间中可能存放着重要的系统数据或代码。</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
<span class=nf>code</span> <span class=no>segment</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>26</span><span class=no>H</span><span class=p>],</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span>
    <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>但笔者在练习的时候出现dosbox下debug卡死</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-48c43e1beb6c28e3?imageMogr2/auto-orient/strip%7CimageView2/2/w/643/format/webp alt></p>
<p>dangeroustest</p>
</li>
<li>
<p>dos下0:200H0:2FFH的256个字节的空间是安全的，dos和其他合法程序一般都不会使用这段空间。内存0000:00000000:03FF大小为1kb的空间是系统存放中断处理程序入口地址的中断向量表。一般情况下0:200H~0:2FFH的256个字节的空间所对应的中断向量表都是空的，操作系统和其他应用程序都不占用。</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-01c01c58fe55a1f4?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>dos安全空间</p>
</li>
</ul>
<h2 id=58-段前缀的使用>5.8 段前缀的使用</h2>
<ul>
<li>将内存ffff:0~ffff:b段单元中的数据拷贝到0:200 ~ 0:20b单元中</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
<span class=nf>code</span> <span class=no>segment</span>
          <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span> <span class=c>;(bx)=0，偏移地址从0开始
</span><span class=c></span>          <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>12</span> <span class=c>;(cx)=12，循环12次
</span><span class=c></span>      <span class=no>s</span><span class=p>:</span>  <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>offffh</span>
          <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span> <span class=c>;(ds)=0ffffh
</span><span class=c></span>          <span class=no>mov</span> <span class=no>dl</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span> <span class=c>;(ds)=((ds)*16+(bx))，将ffff:bx中的数据送入dl
</span><span class=c></span>          <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0020</span><span class=no>h</span>
          <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span> <span class=c>;(ds)=0020h
</span><span class=c></span>          <span class=no>mov</span> <span class=p>[</span><span class=no>bx</span><span class=p>],</span><span class=no>dl</span> <span class=c>;((ds)*16+(bx))=dl，将数据送入0020:bx
</span><span class=c></span>          <span class=no>inc</span> <span class=no>bx</span> <span class=c>;(bx)=(bx)+1
</span><span class=c></span>          <span class=no>loop</span> <span class=no>s</span>

          <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
          <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>两个内存单元相差64KB则不再同一个段里，需要设置ds的值两次，效率不高。</li>
<li>使用 es(附加段)</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;优化后的代码，优化了两次设置ds
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
<span class=nf>code</span> <span class=no>segment</span>
           <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>offffh</span>
           <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span> <span class=c>;(ds)=0ffffh
</span><span class=c></span>           <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0020</span><span class=no>h</span>
           <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span> <span class=c>;(es)=0020H
</span><span class=c></span>           <span class=no>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span> <span class=c>;(bx)=0，此时ds:bx指向ffff:0，es:bx指向0020:0
</span><span class=c></span>           <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>12</span> <span class=c>;(cx)=12，循环12次
</span><span class=c></span>       <span class=no>s</span><span class=p>:</span>  <span class=no>mov</span> <span class=no>dl</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span> <span class=c>;(ds)=((ds)*16+(bx))，将ffff:bx中的数据送入dl
</span><span class=c></span>           <span class=no>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>bx</span><span class=p>],</span><span class=no>dl</span> <span class=c>;((es)*16+(bx))=dl，将数据送入0020:bx
</span><span class=c></span>           <span class=no>inc</span> <span class=no>bx</span> <span class=c>;(bx)=(bx)+1
</span><span class=c></span>           <span class=no>loop</span> <span class=no>s</span>

           <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
           <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h1 id=六包含多个段的程序>六、包含多个段的程序</h1>
<h2 id=61在代码段中使用数据>6.1在代码段中使用数据</h2>
<ul>
<li>编程计算0123H、0456H，0abxH、0defH、0fesH、0cbaH、0987H这8个数据的和，结果存放在ax中：</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span>
<span class=nf>codesg</span> <span class=no>segment</span>
        <span class=nf>dw</span> <span class=mi>0123</span><span class=no>H</span><span class=p>,</span><span class=mi>0564</span><span class=no>H</span><span class=p>,</span><span class=mi>0789</span><span class=no>H</span><span class=p>,</span><span class=mi>0</span><span class=no>abcH</span><span class=p>,</span><span class=mi>0</span><span class=no>defH</span><span class=p>,</span><span class=mi>0</span><span class=no>fedH</span><span class=p>,</span><span class=mi>0</span><span class=no>cbaH</span><span class=p>,</span><span class=mi>0987</span><span class=no>H</span>
        <span class=c>;dw，define word，定义字型数据，db定义字节型数据
</span><span class=c></span>        <span class=c>;由于数据在代码段中，所以段地址是CS
</span><span class=c></span>        <span class=c>;dw定义的数据在最开始的地方，所以偏移地址是0开始
</span><span class=c></span>    <span class=nl>start:</span><span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span> <span class=c>;第一条指令
</span><span class=c></span>        <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>8</span>
    <span class=nl>s:</span>      <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=no>cs</span><span class=p>:[</span><span class=no>bx</span><span class=p>]</span>
        <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>2</span>
        <span class=nf>loop</span> <span class=no>s</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span>
        <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span> <span class=c>;入口找end
</span></code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-06aeb88b9f7d8104?imageMogr2/auto-orient/strip%7CimageView2/2/w/879/format/webp alt></p>
<p>定义字型数据</p>
<ul>
<li><strong>end的作用除了通知编译器结束之外还有告诉编译器程序的入口在什么地方。</strong></li>
<li>可执行文件中的程序执行过程</li>
</ul>
<h2 id=62-在代码段中使用栈>6.2 在代码段中使用栈</h2>
<ul>
<li>利用栈编程将定义的数据逆序(联想栈的特性)存放：dw 0123H,0564H,0789H,0abcH,0defH,0fedH,0cbaH,0987H</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span>
<span class=nf>codesg</span> <span class=no>segment</span>
        <span class=nf>dw</span> <span class=mi>0123</span><span class=no>H</span><span class=p>,</span><span class=mi>0564</span><span class=no>H</span><span class=p>,</span><span class=mi>0789</span><span class=no>H</span><span class=p>,</span><span class=mi>0</span><span class=no>abcH</span><span class=p>,</span><span class=mi>0</span><span class=no>defH</span><span class=p>,</span><span class=mi>0</span><span class=no>fedH</span><span class=p>,</span><span class=mi>0</span><span class=no>cbaH</span><span class=p>,</span><span class=mi>0987</span><span class=no>H</span><span class=c>;地址0~15
</span><span class=c></span>        <span class=no>dw</span> <span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=c>;定义8个字型空数据，后面当作栈来使用，地址是16~31
</span><span class=c></span>
    <span class=nl>start:</span>  
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>cs</span>
            <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>32</span><span class=c>;设置栈底ss:sp指向cs:32，十进制的32
</span><span class=c></span>            <span class=no>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>8</span>
           <span class=nl>s:</span><span class=nf>push</span> <span class=no>cs</span><span class=p>:[</span><span class=no>bx</span><span class=p>]</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>2</span>
            <span class=nf>loop</span> <span class=no>s</span><span class=c>; 以上代码段0~15个单元中的8个字型数据一次入栈
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>8</span>
          <span class=nl>s0:</span><span class=nf>pop</span> <span class=no>cs</span><span class=p>:[</span><span class=no>bx</span><span class=p>]</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>2</span>
            <span class=nf>loop</span> <span class=no>s0</span><span class=c>;依次出栈8个执行数据到代码段0~15单元中
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span><span class=c>;指明程序入口在start处
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>如果对此程序的栈有疑惑，跳转到 3.6 栈和3.10 栈段</li>
</ul>
<h2 id=63-将数据代码栈放入不同的段>6.3 将数据、代码、栈放入不同的段</h2>
<ul>
<li>在8086CPU中数据、栈和代码存储空间不能大于64KB。<strong>可以用像定义代码段一样的方法来定义多个段并在其中定义需要的数据，或者通过定义数据来取得栈空间。</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>data</span><span class=p>,</span><span class=no>ss</span><span class=p>:</span><span class=no>stack</span><span class=c>;在源程序中为三个段进行有意义的名称
</span><span class=c></span><span class=no>data</span> <span class=no>segment</span>
        <span class=nf>dw</span> <span class=mi>0123</span><span class=no>H</span><span class=p>,</span><span class=mi>0564</span><span class=no>H</span><span class=p>,</span><span class=mi>0789</span><span class=no>H</span><span class=p>,</span><span class=mi>0</span><span class=no>abcH</span><span class=p>,</span><span class=mi>0</span><span class=no>defH</span><span class=p>,</span><span class=mi>0</span><span class=no>fedH</span><span class=p>,</span><span class=mi>0</span><span class=no>cbaH</span><span class=p>,</span><span class=mi>0987</span><span class=no>H</span>
<span class=nf>data</span> <span class=no>ends</span>

<span class=nf>stack</span> <span class=no>segment</span>
        <span class=nf>dw</span> <span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=c>;定义8个字型空数据，后面当作栈来使用
</span><span class=c></span><span class=no>stack</span> <span class=no>ends</span>

<span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>      
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stack</span>
            <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>16</span><span class=c>;设置栈底ss:sp指向stack:16，
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span><span class=c>;ds指向data段
</span><span class=c></span>            <span class=no>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;ds:bx指向data段中的第一个单元
</span><span class=c></span>           <span class=no>s</span><span class=p>:</span><span class=no>push</span> <span class=no>cs</span><span class=p>:[</span><span class=no>bx</span><span class=p>]</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>2</span>
            <span class=nf>loop</span> <span class=no>s</span><span class=c>; 以上代码段0~16个单元中的8个字型数据一次入栈
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>8</span>
          <span class=nl>s0:</span><span class=nf>pop</span> <span class=no>cs</span><span class=p>:[</span><span class=no>bx</span><span class=p>]</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>2</span>
            <span class=nf>loop</span> <span class=no>s0</span><span class=c>;依次出栈8个执行数据到代码段0~16单元中
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span><span class=c>;指明程序入口在start处
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>程序中指令决定了断中的内容是作为数据处理还是作为指令执行还是作为栈空间使用。</li>
</ul>
<h2 id=检测点-61>检测点 6.1</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-d3131de04dfab5c0?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点6.1</p>
<h2 id=实验五>实验五</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>data</span><span class=p>,</span><span class=no>ss</span><span class=p>:</span><span class=no>stack</span>
<span class=nf>data</span> <span class=no>segment</span>
        <span class=nf>dw</span> <span class=mi>0123</span><span class=no>H</span><span class=p>,</span><span class=mi>0564</span><span class=no>H</span><span class=p>,</span><span class=mi>0789</span><span class=no>H</span><span class=p>,</span><span class=mi>0</span><span class=no>abcH</span><span class=p>,</span><span class=mi>0</span><span class=no>defH</span><span class=p>,</span><span class=mi>0</span><span class=no>fedH</span><span class=p>,</span><span class=mi>0</span><span class=no>cbaH</span><span class=p>,</span><span class=mi>0987</span><span class=no>H</span>
<span class=nf>data</span> <span class=no>ends</span>

<span class=nf>stack</span> <span class=no>segment</span>
        <span class=nf>dw</span> <span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span>
<span class=nf>stack</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
    <span class=nl>start:</span>  <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stack</span>
            <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>16</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>push</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>
            <span class=nf>push</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>2</span><span class=p>]</span>
            <span class=nf>pop</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>2</span><span class=p>]</span>
            <span class=nf>pop</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h1 id=七更灵活的定位内存地址的方法>七、更灵活的定位内存地址的方法</h1>
<h2 id=71-and和or指令>7.1 and和or指令</h2>
<ul>
<li>
<p>and指令：逻辑与指令，按位进行与运算。</p>
<blockquote>
<p>and两个同时为真的结果才为真。</p>
</blockquote>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>01100011</span><span class=no>B</span>
<span class=nf>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>00111011</span><span class=no>B</span>
<span class=c>;执行后 al=00100011B
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>可用and指令将操作对象的相应位设为0，其他位不变</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>10111111</span><span class=no>B</span><span class=c>;将al第六位设为0
</span><span class=c></span><span class=no>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>01111111</span><span class=no>B</span><span class=c>;将al第七位设为0
</span><span class=c></span><span class=no>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>11111110</span><span class=no>B</span><span class=c>;将al第0位设为0
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>or指令：逻辑或指令，按位进行或运算。</li>
<li>
<blockquote>
<p>or两个同时为假的结果才为假</p>
</blockquote>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>01100011</span><span class=no>B</span>
<span class=nf>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>00111011</span><span class=no>B</span>
<span class=c>;执行后 al=01111011B
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>可用or指令将操作对象的相应位设为1，其他位不变</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>01000000</span><span class=no>B</span><span class=c>;将al第六位设为1
</span><span class=c></span><span class=no>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>10000000</span><span class=no>B</span><span class=c>;将al第七位设为1
</span><span class=c></span><span class=no>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>00000001</span><span class=no>B</span><span class=c>;将al第0位设为1
</span></code></pre></td></tr></table>
</div>
</div><h2 id=72-关于ascii码>7.2 关于ASCII码</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-138632216e5c2fc0?imageMogr2/auto-orient/strip%7CimageView2/2/w/660/format/webp alt></p>
<p>ASCII码表</p>
<ul>
<li>将字符的ascii码写入显存屏幕就显示出相关的字符。</li>
</ul>
<h2 id=73-以字符形式给出数据>7.3 以字符形式给出数据</h2>
<ul>
<li>用‘’的方式指明数据是以字符的形式给出的。<strong>例如&rsquo;A'</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>data</span>

<span class=nf>data</span> <span class=no>segment</span>
        <span class=nf>db</span> <span class=err>&#39;</span><span class=no>unIx</span><span class=err>&#39;</span>
        <span class=nf>db</span> <span class=err>&#39;</span><span class=no>foRK</span><span class=err>&#39;</span>
<span class=nf>data</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>  <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=err>&#39;</span><span class=no>a</span><span class=err>&#39;</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=err>&#39;</span><span class=no>b</span><span class=err>&#39;</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-f7a7a0d141472ce7?imageMogr2/auto-orient/strip%7CimageView2/2/w/846/format/webp alt></p>
<p>73 ascii</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-d93063afda2a95fe?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>以字符形式给出数据</p>
<h2 id=74-大小写转换的问题>7.4 大小写转换的问题</h2>
<ul>
<li><strong>大写字母比小写字母ASCII大32(20H)。</strong></li>
</ul>
<table>
<thead>
<tr>
<th>大写</th>
<th>二进制</th>
<th>小写</th>
<th>二进制</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>01000001</td>
<td>a</td>
<td>01100001</td>
</tr>
<tr>
<td>B</td>
<td>01000010</td>
<td>b</td>
<td>01100010</td>
</tr>
<tr>
<td>C</td>
<td>01000011</td>
<td>c</td>
<td>01100011</td>
</tr>
<tr>
<td>D</td>
<td>01000100</td>
<td>d</td>
<td>01100100</td>
</tr>
</tbody>
</table>
<ul>
<li>从第0位开始计算，大写字母ASCII码第五位为0，小写字母ASCII码第五位为1。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;大小写转换
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>datasg</span>
<span class=nf>datasg</span> <span class=no>segment</span>
<span class=nf>db</span><span class=err>&#39;</span><span class=no>BaSiC</span><span class=err>&#39;</span>
<span class=nf>db</span><span class=err>&#39;</span><span class=no>iNfOfMaTiOn</span><span class=err>&#39;</span>
<span class=nf>datasg</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
    <span class=nl>start:</span>  <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>datasg</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span><span class=c>;设置ds执行datasg段
</span><span class=c></span>            <span class=no>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;设置(bx)=0，ds:bx指向&#39;BaSiC&#39;的第一个字母
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>5</span><span class=c>;设置循环次数，因为BaSiC有5个字母
</span><span class=c></span>              <span class=no>s</span><span class=p>:</span><span class=no>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span><span class=c>;将ASCII码从ds:bx所指向的单元中取出
</span><span class=c></span>            <span class=no>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>11011111</span><span class=no>B</span><span class=c>;口岸al中ASCII码的第5个位置变为0，变为大写字母
</span><span class=c></span>            <span class=no>mov</span> <span class=p>[</span><span class=no>bx</span><span class=p>],</span><span class=no>al</span><span class=c>;转变后将ASCII码写回单元
</span><span class=c></span>            <span class=no>inc</span> <span class=no>bx</span><span class=c>;(bx)加1，ds:bx指向下一个字母
</span><span class=c></span>            <span class=no>loop</span> <span class=no>x</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>5</span><span class=c>;设置(bx)=5，ds:bx指向&#39;iNfOfMaTiOn&#39;的第一个字母
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>11</span>
             <span class=nl>s0:</span><span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span>
            <span class=nf>or</span> <span class=no>al</span><span class=p>,</span><span class=mi>00100000</span><span class=no>B</span>
            <span class=nf>mov</span> <span class=p>[</span><span class=no>bx</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>inc</span> <span class=no>bx</span>
            <span class=nf>loop</span> <span class=no>s0</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=75-bxidata>7.5 [bx+idata]</h2>
<ul>
<li>[bx+idata]表示的是一个内存单元，它的偏移地址为bx+idata</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;[bx+idata]可以写成以下格式
</span><span class=c></span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=mi>200</span><span class=err>+</span><span class=no>bx</span><span class=p>]</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>200</span><span class=p>[</span><span class=no>bx</span><span class=p>]</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=p>].</span><span class=mi>200</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;使用debug查看内存
</span><span class=c></span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2000</span><span class=no>H</span>
<span class=nf>mov</span> <span class=no>ds</span><span class=p>:</span><span class=no>ax</span>
<span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>1000</span><span class=no>H</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span>
<span class=nf>mov</span> <span class=no>cx</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>1</span><span class=p>]</span>
<span class=nf>add</span> <span class=no>cx</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>2</span><span class=p>]</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=76-用bxidata的方式进行数组的处理>7.6 用[bx+idata]的方式进行数组的处理</h2>
<ul>
<li>用[bx+idata]的方式进行数组处理</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;改进大小写转换程序
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>datasg</span>
<span class=nf>datasg</span> <span class=no>segment</span>
<span class=nf>db</span><span class=err>&#39;</span><span class=no>BaSiC</span><span class=err>&#39;</span>
<span class=nf>db</span><span class=err>&#39;</span><span class=no>iNfOfMaTiOn</span><span class=err>&#39;</span>
<span class=nf>datasg</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
    <span class=nl>start:</span>  <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>datasg</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span><span class=c>;设置ds执行datasg段
</span><span class=c></span>            <span class=no>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;设置(bx)=0，ds:bx指向&#39;BaSiC&#39;的第一个字母
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>5</span><span class=c>;设置循环次数，因为BaSiC有5个字母
</span><span class=c></span>          <span class=no>s</span><span class=p>:</span><span class=no>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>0</span><span class=p>]</span><span class=c>;将ASCII码从ds:bx所指向的单元中取出
</span><span class=c></span>            <span class=no>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>11011111</span><span class=no>B</span><span class=c>;口岸al中ASCII码的第5个位置变为0，变为大写字母
</span><span class=c></span>            <span class=no>mov</span> <span class=p>[</span><span class=no>bx</span><span class=p>],</span><span class=no>al</span><span class=c>;转变后将ASCII码写回单元
</span><span class=c></span>            <span class=no>mov</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=mi>5</span><span class=p>]</span><span class=c>;定位第二个字符串的字符
</span><span class=c></span>            <span class=no>or</span> <span class=no>al</span><span class=p>,</span><span class=mi>00100000</span><span class=no>B</span>
            <span class=nf>mov</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=mi>5</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>inc</span> <span class=no>bx</span>
            <span class=nf>loop</span> <span class=no>s</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00H</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>C语言的形式</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c>    <span class=n>include</span><span class=o>&lt;</span><span class=n>stdio</span><span class=p>.</span><span class=n>h</span><span class=o>&gt;</span>

    <span class=kt>char</span> <span class=n>a</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span><span class=o>=</span><span class=s>&#34;BaSiC&#34;</span><span class=p>;</span>
    <span class=kt>char</span> <span class=n>b</span><span class=p>[</span><span class=mi>11</span><span class=p>]</span><span class=o>=</span><span class=s>&#34;iNfOfMaTiOn&#34;</span><span class=p>;</span>
    <span class=n>main</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
        <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
        <span class=k>do</span>
        <span class=p>{</span>
            <span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&amp;</span><span class=mh>0xDF</span><span class=p>;</span>
            <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>|</span><span class=mh>0x20</span><span class=p>;</span>
            <span class=n>i</span><span class=o>++</span><span class=p>;</span>
        <span class=p>}</span><span class=k>while</span><span class=p>(</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>5</span><span class=p>);</span>
    <span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=77-si和di>7.7 SI和DI</h2>
<ul>
<li><strong>SI和DI在8086CPU中和bx功能相近，充当BX的扩充，但是不能分成两个8位寄存器来使用。[SI]段地址默认也是在DS中。</strong></li>
<li>下面的指令实现了相同的功能</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span>

<span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>si</span><span class=p>]</span>

<span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>0</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>di</span><span class=p>]</span>
<span class=c>;-------------
</span><span class=c>;下面的三组指令也实现了另一个组相同的功能
</span><span class=c>;-------------
</span><span class=c></span><span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>123</span><span class=p>]</span>

<span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>si</span><span class=err>+</span><span class=mi>123</span><span class=p>]</span>

<span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>0</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>di</span><span class=err>+</span><span class=mi>123</span><span class=p>]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>一般ds:si指向要复制的原始空间，ds:di指向复制的目的空间。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;用DI和SI实现复制到它后面的数据区中
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>datasg</span>
<span class=nf>datasg</span> <span class=no>segment</span>
<span class=nf>db</span><span class=err>&#39;</span><span class=no>welcome</span> <span class=no>to</span> <span class=no>asm</span><span class=p>!</span><span class=err>&#39;</span>
<span class=nf>db</span><span class=err>&#39;</span><span class=no>................</span><span class=err>&#39;</span>
<span class=nf>datasg</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
    <span class=nf>start</span>  <span class=p>:</span><span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>datasg</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>16</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>8</span>
          <span class=nl>s:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>si</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=p>[</span><span class=no>di</span><span class=p>],</span><span class=no>ax</span>
            <span class=nf>add</span> <span class=no>si</span><span class=p>,</span><span class=mi>2</span>
            <span class=nf>add</span> <span class=no>di</span><span class=p>,</span><span class=mi>2</span>
            <span class=nf>loop</span> <span class=no>s</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>
<span class=c>;------
</span><span class=c>;用数组的思维[bx(si或di)+idata]的方式优化程序
</span><span class=c>;------
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>datasg</span>
<span class=nf>datasg</span> <span class=no>segment</span>
<span class=nf>db</span><span class=err>&#39;</span><span class=no>welcome</span> <span class=no>to</span> <span class=no>asm</span><span class=p>!</span><span class=err>&#39;</span>
<span class=nf>db</span><span class=err>&#39;</span><span class=no>................</span><span class=err>&#39;</span>
<span class=nf>datasg</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
    <span class=nf>start</span>  <span class=p>:</span><span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>datasg</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>8</span>
          <span class=nl>s:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>si</span><span class=p>]</span><span class=c>;第一个字符串的的第一个元素
</span><span class=c></span>            <span class=no>mov</span> <span class=p>[</span><span class=no>si</span><span class=err>+</span><span class=mi>16</span><span class=p>],</span><span class=no>ax</span><span class=c>;目标字符串的第二个元素
</span><span class=c></span>            <span class=no>add</span> <span class=no>si</span><span class=p>,</span><span class=mi>2</span>
            <span class=nf>loop</span> <span class=no>s</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=78-bxsi和bxdi>7.8 [bx+si]和[bx+di]</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2000</span><span class=no>h</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>1000</span><span class=no>h</span>
    <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>]</span>
    <span class=nf>inc</span> <span class=no>si</span>
    <span class=nf>mov</span> <span class=no>cx</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>]</span>
    <span class=nf>inc</span> <span class=no>si</span>
    <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=no>si</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>di</span><span class=p>]</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=79-bxsiidata和bxdiidata>7.9 [bx+si+idata]和[bx+di+idata]</h2>
<ul>
<li>常数后要加.<strong>例如</strong>[bx+si].idata或者[bx].idata[si]</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2000</span><span class=no>h</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>1000</span><span class=no>h</span>
    <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>2</span><span class=err>+</span><span class=no>si</span><span class=p>]</span>
    <span class=nf>inc</span> <span class=no>si</span>
    <span class=nf>mov</span> <span class=no>cx</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=err>+</span><span class=mi>2</span><span class=p>]</span>
    <span class=nf>inc</span> <span class=no>si</span>
    <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=no>si</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>di</span><span class=err>+</span><span class=mi>2</span><span class=p>]</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=710-不同的寻址方式的灵活应用>7.10 不同的寻址方式的灵活应用</h2>
<ul>
<li>编程将数据段中每一个单词的头一个字母改为大写字母。</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-a4b13c9597741ed0?imageMogr2/auto-orient/strip%7CimageView2/2/w/1010/format/webp alt></p>
<p>数据段中的数据存储结构_2</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>datasg</span>
<span class=nf>datasg</span> <span class=no>segment</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=mi>1</span><span class=p>.</span> <span class=no>file</span>          <span class=err>&#39;</span><span class=c>;长度刚好都是16个字节
</span><span class=c></span>    <span class=no>db</span><span class=err>&#39;</span><span class=mi>2</span><span class=p>.</span> <span class=no>edit</span>          <span class=err>&#39;</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=mi>3</span><span class=p>.</span> <span class=no>search</span>        <span class=err>&#39;</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=mi>4</span><span class=p>.</span> <span class=no>view</span>          <span class=err>&#39;</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=mi>5</span><span class=p>.</span> <span class=no>options</span>       <span class=err>&#39;</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=mi>6</span><span class=p>.</span> <span class=no>help</span>          <span class=err>&#39;</span>
<span class=nf>datasg</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
      <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>datasg</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>6</span>
          <span class=nl>s:</span>    
            <span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>3</span><span class=p>]</span>
            <span class=nf>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>11011111</span><span class=no>B</span>
            <span class=nf>mov</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=mi>3</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>16</span>
            <span class=nf>loop</span> <span class=no>s</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>编程将数据段中每个单词改为大写字母</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-c318e4955e46fc3c?imageMogr2/auto-orient/strip%7CimageView2/2/w/1077/format/webp alt></p>
<p>数据段中的数据存储结构2</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;有bug，问题在于cx的使用，进行二重循环，只用一个循环计数器，造成在进行内层的时候覆盖了外层循环的循环计数值。
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>datasg</span>
<span class=nf>datasg</span> <span class=no>segment</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>ibm</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>dec</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>dos</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>vax</span>             <span class=err>&#39;</span>
<span class=nf>datasg</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
      <span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>datasg</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;用bx来定位行
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>4</span>
         <span class=nl>s0:</span><span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span><span class=c>;用si来定位列
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>3</span>
          <span class=nl>s:</span><span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>]</span>
            <span class=nf>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>11011111</span><span class=no>B</span>
            <span class=nf>mov</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>inc</span> <span class=no>si</span>
            <span class=nf>loop</span> <span class=no>s</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>16</span>
            <span class=nf>loop</span> <span class=no>s0</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>程序没有返回到cmd</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-7f0b7862c49bc46a?imageMogr2/auto-orient/strip%7CimageView2/2/w/884/format/webp alt></p>
<p>712bug</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-ee6b91b4b76cdcd3?imageMogr2/auto-orient/strip%7CimageView2/2/w/994/format/webp alt></p>
<p>712bug1</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-482870fe7368d7e7?imageMogr2/auto-orient/strip%7CimageView2/2/w/643/format/webp alt></p>
<p>712bug2</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>loop</span> <span class=no>s</span><span class=c>;三次循环后cx等于0了
</span><span class=c></span><span class=no>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>16</span>
<span class=nf>loop</span> <span class=no>s0</span><span class=c>;先是cx=cx-1再判断时候等于0，此时cx=FFFF不为0再循环，变成死循环了
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>因为loop是和cx一起使用的，不能多用个寄存器来解决loop循环次数的问题。解决的方法是在每次开始内层循环时用dx将外层循环cx的值保存起来，在执行外层循环的loop指令前再回复外层循环的cx的数值。</li>
<li>改进后程序</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>datasg</span>
    <span class=nf>datasg</span> <span class=no>segment</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>ibm</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>dec</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>dos</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>vax</span>             <span class=err>&#39;</span>
<span class=nf>datasg</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
      <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>datasg</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;用bx来定会行
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>4</span>
         <span class=nl>s0:</span>
            <span class=nf>mov</span> <span class=no>dx</span><span class=p>,</span><span class=no>cx</span><span class=c>;用dx寄存器来临时存放外层cx的值
</span><span class=c></span>            <span class=no>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span><span class=c>;用si来定位列
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>3</span>
          <span class=nl>s:</span>
            <span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>]</span>
            <span class=nf>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>11011111</span><span class=no>B</span>
            <span class=nf>mov</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>inc</span> <span class=no>si</span>
            <span class=nf>loop</span> <span class=no>s</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>16</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=no>dx</span><span class=c>;在进行外层循环的时候回复cx的值
</span><span class=c></span>            <span class=no>loop</span> <span class=no>s0</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在上面的程序中，8086 CPU si、cx、ax、bx这些寄存器经常要使用到；cs、ip、ds也不能用，因为cs:ip时刻指向当前指令，ds指向datasg段；那么可用的寄存器就只用dx、di、es、ss、sp、bp等寄存器了。<strong>内存可以解决经常性的数据暂存问题。为了使程序结构清晰便于阅读，应该使用栈</strong></li>
<li>再次被改进的程序</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>datasg</span>
    <span class=nf>datasg</span> <span class=no>segment</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>ibm</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>dec</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>dos</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>vax</span>             <span class=err>&#39;</span>
    <span class=nf>dw</span> <span class=mi>0</span><span class=c>;定义一个字用来保存cx的值
</span><span class=c></span><span class=no>datasg</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
      <span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>datasg</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;用bx来定位行
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>4</span>
         <span class=nl>s0:</span><span class=nf>mov</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>40</span><span class=no>h</span><span class=p>],</span><span class=no>cx</span><span class=c>;datasg:40h单元存放外层cx的值
</span><span class=c></span>            <span class=no>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span><span class=c>;用si来定位列
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>3</span>
          <span class=nl>s:</span><span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>]</span>
            <span class=nf>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>11011111</span><span class=no>B</span>
            <span class=nf>mov</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>inc</span> <span class=no>si</span>
            <span class=nf>loop</span> <span class=no>s</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>16</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=no>ds</span><span class=p>:[</span><span class=mi>40</span><span class=no>h</span><span class=p>]</span><span class=c>;在进行外层循环的时候回复cx的值
</span><span class=c></span>            <span class=no>loop</span> <span class=no>s0</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>再次使用栈改进程序</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>datasg</span><span class=p>,</span><span class=no>ss</span><span class=p>:</span><span class=no>stacksg</span>
<span class=nf>datasg</span> <span class=no>segment</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>ibm</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>dec</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>dos</span>             <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>vax</span>             <span class=err>&#39;</span>
<span class=nf>datasg</span> <span class=no>ends</span>

<span class=nf>stacksg</span> <span class=no>segment</span>
    <span class=nf>dw</span> <span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=c>;定义一个段，用作栈段，容量为16个字节
</span><span class=c></span><span class=no>stacksg</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
      <span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stacksg</span>
            <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>16</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>datasg</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;用bx来定位行
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>4</span>
         <span class=nl>s0:</span><span class=nf>push</span> <span class=no>cx</span><span class=c>;datasg:40h单元存放外层cx的值
</span><span class=c></span>            <span class=no>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span><span class=c>;用si来定位列
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>3</span>
          <span class=nl>s:</span><span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>]</span>
            <span class=nf>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>11011111</span><span class=no>B</span>
            <span class=nf>mov</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>inc</span> <span class=no>si</span>
            <span class=nf>loop</span> <span class=no>s</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>16</span>
            <span class=nf>pop</span> <span class=no>cx</span><span class=c>;在进行外层循环的时候回复cx的值
</span><span class=c></span>            <span class=no>loop</span> <span class=no>s0</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>编程将数据段中的每个单词的前四个字母改为大写字母</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-9c38139d376d6905?imageMogr2/auto-orient/strip%7CimageView2/2/w/1115/format/webp alt></p>
<p>数据段中的数据存储结构3</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>datasg</span><span class=p>,</span><span class=no>ss</span><span class=p>:</span><span class=no>stacksg</span>

<span class=nf>stacksg</span> <span class=no>segment</span>
<span class=nf>stacksg</span> <span class=no>ends</span>

<span class=nf>datasg</span> <span class=no>segment</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=mi>1</span><span class=p>.</span> <span class=no>display</span>      <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=mi>2</span><span class=p>.</span> <span class=no>brows</span>        <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=mi>3</span><span class=p>.</span> <span class=no>replace</span>      <span class=err>&#39;</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=mi>4</span><span class=p>.</span> <span class=no>modify</span>       <span class=err>&#39;</span>
<span class=nf>datasg</span> <span class=no>ends</span>
<span class=nf>codesg</span> <span class=no>segment</span>
      <span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stacksg</span>
            <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>16</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>datasg</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>4</span>
         <span class=nl>s0:</span><span class=nf>push</span> <span class=no>cx</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>4</span>
          <span class=nl>s:</span><span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=err>+</span><span class=mi>3</span><span class=p>]</span>
            <span class=nf>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>11011111</span><span class=no>B</span>
            <span class=nf>mov</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=err>+</span><span class=mi>3</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>inc</span> <span class=no>si</span>
            <span class=nf>loop</span> <span class=no>s</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>16</span>
            <span class=nf>pop</span> <span class=no>cx</span>
            <span class=nf>loop</span> <span class=no>s0</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h1 id=八数据处理的两个基本问题>八、数据处理的两个基本问题</h1>
<h2 id=引言-2>引言</h2>
<ul>
<li>本章是总结性的内容，数据处理的两个基本问题是
<ul>
<li>处理的数据在哪？</li>
<li>要处理的数据有多长？</li>
</ul>
</li>
<li>自定义得描述符：
<ul>
<li>reg寄存器
<ul>
<li>ax、bx、cx、dx、ah、al、bh、bl、ch、cl、dh、dl、sp、bp、si、di；</li>
</ul>
</li>
<li>sreg段寄存器
<ul>
<li>ds、ss、cs、es。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id=81-bxsidibp>8.1 bx、si、di、bp</h2>
<ul>
<li>在8086 CPU中只有bx、si、di、bp这四个寄存器用在<input disabled type=checkbox> 中进行内存单元寻址。<strong>在[]中，组合只能以这四种形式：bx和si、bx和di、bp和si、bp和di</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;以下指令是错误的
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>ax</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>cx</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>dx</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>ds</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>bp</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>si</span><span class=err>+</span><span class=no>di</span><span class=p>]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>正确的指令</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>si</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>di</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bp</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>di</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bp</span><span class=err>+</span><span class=no>si</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bp</span><span class=err>+</span><span class=no>di</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=err>+</span><span class=no>idata</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=no>di</span><span class=err>+</span><span class=no>idata</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bp</span><span class=err>+</span><span class=no>si</span><span class=err>+</span><span class=no>idata</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bp</span><span class=err>+</span><span class=no>di</span><span class=err>+</span><span class=no>idata</span><span class=p>]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>[bp]的段地址默认在ss中。</strong></li>
</ul>
<h2 id=82-机器指令处理的数据所在的位置>8.2 机器指令处理的数据所在的位置</h2>
<ul>
<li>绝大部分机器指令时进行数据处理的，大致可以分为3类：读、写、运算。指令在处理前可以在三个地方：CPU内部、内存、端口。</li>
</ul>
<table>
<thead>
<tr>
<th>机器码</th>
<th>汇编指令</th>
<th>指令执行前数据的位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>89C3</td>
<td>mov bx,[0]</td>
<td>内存，ds:0单元</td>
</tr>
<tr>
<td>89C3</td>
<td>mov bx,ax</td>
<td>CPU内部，ax寄存器</td>
</tr>
<tr>
<td>BB0100</td>
<td>mov bx,1</td>
<td>CPU内部，指令缓冲器</td>
</tr>
</tbody>
</table>
<h2 id=83-汇编语言中数据位置的表达>8.3 汇编语言中数据位置的表达</h2>
<ul>
<li>汇编语言中用三个概念来表达数据的位置。
<ul>
<li>1、立即数(idata)</li>
<li>2、寄存器</li>
<li>3、段地址(SA)和偏移地址(EA)</li>
</ul>
</li>
</ul>
<h2 id=84-寻址方式总小结>8.4 寻址方式总小结</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-9e48c0050ca927fb?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>寻址方式总结_1</p>
<h2 id=85-指令要处理的数据有多长>8.5 指令要处理的数据有多长</h2>
<ul>
<li>8086 CPU可以处理byte和word两种数据尺寸。</li>
<li><strong>通过寄存器指明要处理的数据尺寸；push指令只进行字操作，若没有寄存器名存在的情况下，用操作符word ptr或者byte ptr指明内存单元的长度。</strong> 例如</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>],</span><span class=mi>1</span>
    <span class=nf>inc</span> <span class=no>word</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>]</span>
    <span class=nf>inc</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>
    <span class=nf>add</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>],</span><span class=mi>2</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;假设内存2000:1000 FF FF FF FF FF FF ……
</span><span class=c></span>    <span class=c>;如果用以下指令
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2000</span><span class=no>H</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=mi>1000</span><span class=no>H</span><span class=p>],</span><span class=mi>1</span>
    <span class=c>;那么内存中的内容变为
</span><span class=c></span>    <span class=c>;2000:1000 01 FF FF FF FF FF ……
</span><span class=c></span>    <span class=err>如果是用以下指令</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2000</span><span class=no>H</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=p>[</span><span class=mi>1000</span><span class=no>H</span><span class=p>],</span><span class=mi>1</span>
    <span class=c>;那么内存中的内容变为
</span><span class=c></span>    <span class=c>;2000:1000 01 00 FF FF FF ……
</span></code></pre></td></tr></table>
</div>
</div><h2 id=86-寻址方式的综合应用>8.6 寻址方式的综合应用</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-af564d5dc3eeca77?imageMogr2/auto-orient/strip%7CimageView2/2/w/513/format/webp alt></p>
<p>86题目_1</p>
<ul>
<li>初步汇编代码</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>seg</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>60</span><span class=no>h</span><span class=c>;确定记录物理地址：ds:bx
</span><span class=c></span>    <span class=no>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=mi>0</span><span class=no>ch</span><span class=p>],</span><span class=mi>38</span><span class=c>;寄存器相对寻址     排名字段改为38
</span><span class=c></span>    <span class=no>add</span> <span class=no>word</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=mi>0</span><span class=no>eh</span><span class=p>],</span><span class=mi>70</span><span class=c>;收入字段增加70
</span><span class=c></span>
    <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span><span class=c>;用si来定位产品字符串中的字符
</span><span class=c></span>    <span class=no>mov</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=mi>10</span><span class=no>h</span><span class=err>+</span><span class=no>si</span><span class=p>],</span><span class=err>&#39;</span><span class=no>V</span><span class=err>&#39;</span><span class=c>;相对基址变址寻址
</span><span class=c></span>    <span class=no>inc</span> <span class=no>si</span>
    <span class=nf>mov</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=mi>10</span><span class=no>h</span><span class=err>+</span><span class=no>si</span><span class=p>],</span><span class=err>&#39;</span><span class=no>A</span><span class=err>&#39;</span>
    <span class=nf>inc</span> <span class=no>si</span>
    <span class=nf>mov</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=mi>10</span><span class=no>h</span><span class=err>+</span><span class=no>si</span><span class=p>],</span><span class=err>&#39;</span><span class=no>X</span><span class=err>&#39;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>c语言描述</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-c data-lang=c>    <span class=k>struct</span> <span class=n>company</span>  <span class=cm>/*定义一个公司记录的结构体*/</span>
    <span class=p>{</span>
        <span class=kt>char</span> <span class=n>cn</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span> <span class=cm>/*公司名称*/</span>
        <span class=kt>char</span> <span class=n>hn</span><span class=p>[</span><span class=mi>9</span><span class=p>];</span> <span class=cm>/*总裁姓名*/</span>
        <span class=kt>int</span> <span class=n>pm</span><span class=p>;</span>     <span class=cm>/*排名*/</span>
        <span class=kt>int</span> <span class=n>sr</span><span class=p>;</span>     <span class=cm>/*收入*/</span>
        <span class=kt>char</span> <span class=n>cp</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span> <span class=cm>/*著名产品*/</span>
    <span class=p>};</span>

    <span class=k>struct</span> <span class=n>compant</span> <span class=n>dec</span><span class=o>=</span><span class=p>{</span><span class=s>&#34;DEC&#34;</span><span class=p>,</span><span class=s>&#34;Ken Olsen&#34;</span><span class=p>,</span><span class=mi>137</span><span class=p>,</span><span class=mi>40</span><span class=p>,</span><span class=s>&#34;PDF&#34;</span><span class=p>};</span>
    <span class=cm>/*定义一个公司记录的变量，内存中将存有一条公司的记录*/</span>
    <span class=n>mian</span><span class=p>()</span>
    <span class=p>{</span>
        <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
        <span class=n>dec</span><span class=p>.</span><span class=n>pm</span><span class=o>=</span><span class=mi>38</span><span class=p>;</span>
        <span class=n>dec</span><span class=p>.</span><span class=n>sr</span><span class=o>=</span><span class=n>dec</span><span class=p>.</span><span class=n>sr</span><span class=o>+</span><span class=mi>70</span><span class=p>;</span>
        <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
        <span class=n>dec</span><span class=p>.</span><span class=n>cp</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;V&#39;</span><span class=p>;</span>
        <span class=n>i</span><span class=o>++</span><span class=p>;</span>
        <span class=n>dec</span><span class=p>.</span><span class=n>cp</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;A&#39;</span><span class=p>;</span>
        <span class=n>i</span><span class=o>++</span><span class=p>;</span>
        <span class=n>dec</span><span class=p>.</span><span class=n>cp</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;X&#39;</span><span class=p>;</span>
        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
    <span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>按照c语言的风格用汇编写</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>seg</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>60</span><span class=no>h</span><span class=c>;记录首地址送入bx
</span><span class=c></span>
    <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>].</span><span class=no>och</span><span class=p>,</span><span class=mi>38</span><span class=c>;排名字段改为38
</span><span class=c></span>    <span class=no>add</span> <span class=no>word</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>].</span><span class=mi>0</span><span class=no>eh</span><span class=p>,</span><span class=mi>70</span><span class=c>;收入字段增加70
</span><span class=c></span>
    <span class=c>;产品名字段改为字符串&#39;VAX&#39;
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>mov</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>].</span><span class=mi>10</span><span class=no>h</span><span class=p>[</span><span class=no>si</span><span class=p>],</span><span class=err>&#39;</span><span class=no>V</span><span class=err>&#39;</span>
    <span class=nf>inc</span> <span class=no>si</span>
    <span class=nf>mov</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>].</span><span class=mi>10</span><span class=no>h</span><span class=p>[</span><span class=no>si</span><span class=p>],</span><span class=err>&#39;</span><span class=no>A</span><span class=err>&#39;</span>
    <span class=nf>inc</span> <span class=no>si</span>
    <span class=nf>mov</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>].</span><span class=mi>10</span><span class=no>h</span><span class=p>[</span><span class=no>si</span><span class=p>],</span><span class=err>&#39;</span><span class=no>X</span><span class=err>&#39;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>多种寻址方式为结构化数据的处理提供了方便。</li>
<li><strong>一般用[bx+idata+si]的方式来访问结构体，用idata定位结构体中的某一数据项，用si定位数组项中的每个元素。</strong> 例如：[bx].idata、[bx].idata[si]。</li>
</ul>
<h2 id=87-div指令>8.7 div指令</h2>
<ul>
<li>div(divide)是除法指令，可用乘法模拟，格式为：</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>div</span> <span class=no>reg</span><span class=p>(</span><span class=err>寄存器</span><span class=p>)</span>
<span class=nf>div</span> <span class=err>内存单元。</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>除数：8位或16位，在寄存器或内存单元中；被除数：默认放在AX或DX和AX中。</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>        <span class=nf>div</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>
        <span class=nf>div</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=err>+</span><span class=no>idata</span><span class=p>]</span>
        <span class=c>;al放商，ah放余数
</span><span class=c></span>
        <span class=nf>div</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>
        <span class=nf>div</span> <span class=no>word</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=err>+</span><span class=no>idata</span><span class=p>]</span>
        <span class=c>;ax放商，dx放余数
</span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>除数</th>
<th>被除数</th>
</tr>
</thead>
<tbody>
<tr>
<td>8位</td>
<td>16为(AX)</td>
</tr>
<tr>
<td>16位</td>
<td>32位(DX高16位+AX低16位)</td>
</tr>
</tbody>
</table>
<ul>
<li>8位或16位看的是除数。</li>
</ul>
<table>
<thead>
<tr>
<th>运算</th>
<th>8位</th>
<th>16位</th>
</tr>
</thead>
<tbody>
<tr>
<td>商</td>
<td>AL</td>
<td>AX</td>
</tr>
<tr>
<td>余数</td>
<td>AH</td>
<td>DX</td>
</tr>
</tbody>
</table>
<ul>
<li>利用除法指令计算10001/100编程</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;被除数1001可用ax寄存器存放，除数100可用8位寄存器存放，要进行8位除法。
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1001</span>
    <span class=nf>mov</span> <span class=no>bl</span><span class=p>,</span><span class=mi>100</span>
    <span class=nf>div</span> <span class=no>bl</span>
    <span class=c>;执行后al的值等于0AH(10)，ah的值等于1(余数为1)。
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>利用除法指令计算100001/100编程</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;被除数100001大于2^16=65535(FFFF)，不能用ax来存放，要用dx和ax两个寄存器联合存放。除数小于255，可用一个8位寄存器存放，但是被除数是32位的，除数应为16位，所以要用一个16位寄存器来存放除数。
</span><span class=c></span>    <span class=c>;100001的十六进制为186A1H，100001的高16位(1)存放在dx，低16位(86AH)存放在ax中。
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>dx</span><span class=p>,</span><span class=mi>1</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>86</span><span class=no>A1H</span>
    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>100</span>
    <span class=nf>div</span> <span class=no>bx</span>
    <span class=c>;执行后ax内容等于03E8H(即1000)，dx的值等于1(余数)。
</span></code></pre></td></tr></table>
</div>
</div><h2 id=88-伪指令dd>8.8 伪指令dd</h2>
<ul>
<li>db定义字节型数据，dw定于字型数据，<strong>dd 定于 dword(double word双字型数据)</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>data</span> <span class=no>segment</span>
        <span class=nf>db</span> <span class=mi>1</span><span class=c>;第一个数据为01h，在data:0处，占1个字节
</span><span class=c></span>        <span class=no>dw</span> <span class=mi>1</span><span class=c>;第二个数据为0001h，在data:1处，占1个字
</span><span class=c></span>        <span class=no>dd</span> <span class=mi>1</span><span class=c>;第三个数据为00000001h，在data:3处，占2个字
</span><span class=c></span><span class=no>data</span> <span class=no>ends</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>利用除法指令计算 dd 100001H 除以 dw 100，商放在 dw 0中</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>data</span> <span class=no>segment</span>
    <span class=nf>dd</span> <span class=mi>100001</span><span class=no>H</span><span class=c>;低16位存储在ax中，高16位存储在dx中
</span><span class=c></span>    <span class=no>dw</span> <span class=mi>100</span>
    <span class=nf>dw</span> <span class=mi>0</span>
<span class=nf>data</span> <span class=no>ends</span>

    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span><span class=c>;低16位存储在ax中
</span><span class=c></span>    <span class=no>mov</span> <span class=no>dx</span><span class=p>,</span><span class=no>ds</span><span class=p>:[</span><span class=mi>2</span><span class=p>]</span><span class=c>;高16位存储在dx中
</span><span class=c></span>    <span class=no>div</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>4</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>6</span><span class=p>],</span><span class=no>ax</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=89-伪指令dup>8.9 伪指令dup</h2>
<ul>
<li>和db、dw、dd等数据定义伪指令配合使用，用来进行数据的重复。格式 db或者dw或者dd 重复的次数 dup (重复的数据)</li>
<li>例如：</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>db</span> <span class=mi>3</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
<span class=c>;定义了3个字节，它们的值都是0，等同于db 0,0,0。
</span><span class=c></span><span class=nf>db</span> <span class=mi>3</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span>
<span class=c>;定义了9个直接，它们是0、1、2、0、1、2、0、1、2，相当于db 0、1、2、0、1、2、0、1、2
</span><span class=c></span><span class=nf>db</span> <span class=mi>3</span> <span class=no>dup</span><span class=p>(</span><span class=err>&#39;</span><span class=no>abc</span><span class=err>&#39;</span><span class=p>,</span><span class=err>&#39;</span><span class=no>ABC</span><span class=err>&#39;</span><span class=p>)</span>
<span class=c>;定义了18个直接，它们是&#39;abcABCabcABCabcABC&#39;
</span></code></pre></td></tr></table>
</div>
</div><h2 id=实验七-寻址方式在结构化数据访问中的应用>实验七 寻址方式在结构化数据访问中的应用</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-141307bb9108dacb?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>实验7</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-34fb4b5b6b1f9590?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>实验7数据</p>
<ul>
<li>ds已经和data段联系了，数据段不够用时用扩展段ES</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;初始化阶段
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>table</span><span class=c>;data已经被占用
</span><span class=c></span>    <span class=no>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>

    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>21</span>

    <span class=c>;存放年份,每一个bx就是一个字节
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=p>],</span><span class=no>al</span>
    <span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>1</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>1</span><span class=p>],</span><span class=no>al</span>
    <span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>2</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=no>al</span>
    <span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>3</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>3</span><span class=p>],</span><span class=no>al</span>

    <span class=c>;存放公司的总收入
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>54</span><span class=no>H</span><span class=p>]</span><span class=c>;第一个年收入是dd数据类型，段地址为54H
</span><span class=c></span>    <span class=no>mov</span> <span class=no>dx</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>54</span><span class=no>H</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>5</span><span class=no>H</span><span class=p>],</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>7</span><span class=no>H</span><span class=p>],</span><span class=no>dx</span>

    <span class=c>;存放公司的人数
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>si</span><span class=err>+</span><span class=mi>0</span><span class=no>A8H</span><span class=p>]</span><span class=c>;第一个人数的数据段地址为0A8H
</span><span class=c></span>    <span class=no>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>0</span><span class=no>A8H</span><span class=p>],</span><span class=no>ax</span>

    <span class=c>;计算人均收入并存放
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>54</span><span class=no>H</span><span class=p>]</span>
    <span class=nf>mov</span> <span class=no>dx</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>56</span><span class=no>H</span><span class=p>]</span><span class=c>;这两句诗初始化被除数
</span><span class=c></span>    <span class=no>div</span> <span class=no>word</span> <span class=no>ptr</span><span class=p>,</span><span class=no>ds</span><span class=p>:[</span><span class=no>si</span><span class=err>+</span><span class=mi>0</span><span class=no>A8H</span><span class=p>]</span><span class=c>;除以人数
</span><span class=c></span>    <span class=no>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>0</span><span class=no>dH</span><span class=p>],</span><span class=no>ax</span><span class=c>;将商放入指定位置
</span><span class=c></span>
    <span class=c>;为下一次循环时存放数据做准备
</span><span class=c></span>    <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>4</span><span class=c>;bx确定年份和收入
</span><span class=c></span>    <span class=no>add</span> <span class=no>si</span><span class=p>,</span><span class=mi>2</span><span class=c>;si确定人数
</span><span class=c></span>    <span class=no>add</span> <span class=no>di</span><span class=p>,</span><span class=mi>16</span><span class=c>;di确定的是每行的列数
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>完整的程序</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>data</span><span class=p>,</span><span class=no>es</span><span class=p>:</span><span class=no>table</span>

<span class=nf>data</span> <span class=no>segment</span>
        <span class=nf>db</span> <span class=err>&#39;</span><span class=mi>1975</span><span class=err>&#39;</span><span class=p>,</span><span class=err>&#39;</span><span class=mi>1976</span><span class=err>&#39;</span> <span class=err>&#39;</span><span class=mi>1977</span><span class=err>&#39;</span> <span class=err>……</span>
        <span class=nf>dd</span> <span class=mi>16</span><span class=err>，</span><span class=mi>22</span><span class=err>，</span><span class=mi>382</span> <span class=err>……</span>
        <span class=nf>dw</span> <span class=mi>3</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>9</span> <span class=err>……</span>
        <span class=c>;数据在题目中
</span><span class=c></span><span class=nf>data</span> <span class=no>ends</span>

<span class=nf>table</span> <span class=no>segment</span>
        <span class=nf>db</span> <span class=mi>21</span> <span class=no>dup</span><span class=p>(</span><span class=err>&#39;</span><span class=no>year</span> <span class=no>summ</span> <span class=no>ne</span> <span class=err>??</span> <span class=err>&#39;</span><span class=p>)</span>
<span class=nf>table</span> <span class=no>ends</span>

      <span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>table</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>

            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>21</span>

          <span class=nl>s:</span><span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>1</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>1</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>2</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>3</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>3</span><span class=p>],</span><span class=no>al</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>54</span><span class=no>H</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=no>dx</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>56</span><span class=no>H</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>5</span><span class=no>H</span><span class=p>],</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>7</span><span class=no>H</span><span class=p>],</span><span class=no>dx</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>si</span><span class=err>+</span><span class=mi>0</span><span class=no>A8H</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>0</span><span class=no>AH</span><span class=p>],</span><span class=no>ax</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>bx</span><span class=err>+</span><span class=mi>54</span><span class=no>H</span><span class=p>]</span>
            <span class=nf>div</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=no>si</span><span class=err>+</span><span class=mi>0</span><span class=no>A8H</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=err>+</span><span class=mi>0</span><span class=no>dH</span><span class=p>],</span><span class=no>ax</span>

            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>4</span>
            <span class=nf>add</span> <span class=no>si</span><span class=p>,</span><span class=mi>2</span>
        <span class=nf>loop</span> <span class=no>s</span>
<span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
<span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id=转移指令的原理>转移指令的原理</h2>
<h2 id=引言-3>引言</h2>
<ul>
<li><strong>可以修改IP，或者同时修改CS和IP的指令统称为转移指令。</strong> 简单的来说可以控制CPU执行内存中某处代码的指令就是转移指令。</li>
<li>8086</li>
<li>CPU的转移行为有<strong>只修改的段内转移</strong>(如jmp ax) 和<strong>同时修改该CS和IP的段间转移</strong>(如jmp 1000:0)。其中段内转移分为<strong>短转移</strong>(IP的修改范围为-128~127)和<strong>近转移</strong> (IP的修改范围为-32768~32767)。</li>
<li>8086 CPU的转移指令分为以下几类：
<ul>
<li>无条件转移指令(如：jmp)</li>
<li>条件转移指令</li>
<li>循环指令(如：loop)</li>
<li>过程</li>
<li>中断</li>
</ul>
</li>
</ul>
<h2 id=91-操作符offset>9.1 操作符offset</h2>
<ul>
<li>offset是伪指令，由编译器处理，它的功能是取得标号的偏移地址。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span>
    <span class=nf>codesg</span> <span class=no>segment</span>

      <span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>offset</span> <span class=no>start</span><span class=c>;相当于 mov ax,偏移地址0，段地址是从0开始
</span><span class=c></span>          <span class=no>s</span><span class=p>:</span><span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>offset</span> <span class=no>s</span><span class=c>;相当于 mov ax,3，标记的是代码段中的第二条指令，第一条指令长度为3个字节，则s的偏移地址为3
</span><span class=c></span>
    <span class=nf>codesg</span> <span class=no>ends</span>
    <span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=92-jmp指令>9.2 jmp指令</h2>
<ul>
<li><strong>jmp为无条件转移，可以只修改IP，也可以同时修改CS和IP。</strong></li>
<li>jmp需要两种信息
<ul>
<li>1、转移的目的地址；</li>
<li>2、转移的距离(段间转移、段内转移、段内近转移)。</li>
</ul>
</li>
</ul>
<h2 id=93-依据位移进行转移的jmp指令>9.3 依据位移进行转移的jmp指令</h2>
<ul>
<li>段内短转移，<strong>jmp short 标号</strong> ，对IP的修改范围是-128~127，一个字节的空间，即向前转移最多128字节，向后最多127字节。short 表明指令进行的是短转移，标号指明了指令要转移的目的地，转移指令结束后<strong>CS:IP指向标号处的指令</strong>。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span>
    <span class=nf>codesg</span> <span class=no>segment</span>

      <span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
          <span class=nf>jmp</span> <span class=no>short</span> <span class=no>s</span>
          <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>
          <span class=nl>s:</span><span class=nf>inc</span> <span class=no>ax</span>

    <span class=nf>codesg</span> <span class=no>ends</span>
    <span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>一般汇编指令中的立即数(idata)会出现在对应的机器指令中。而jmp指令的机器指令并不包含目的地址，包含的是相对于当前IP的转移位移，CPU并不需要目的地址就可以实现对IP的修改。</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-6eb8927cab108247?imageMogr2/auto-orient/strip%7CimageView2/2/w/767/format/webp alt></p>
<p>92debug_1</p>
</li>
<li>
<p>CPU执行指令的过程 在 2.10 CS和IP</p>
</li>
<li>
<p>jmp short s 指令的读取和执行过程：</p>
<ul>
<li>1、CS:IP指向jmp short s 的机器码；</li>
<li>2、读取指令码进入指令缓冲器</li>
<li>3、 改变IP，(IP)=(IP)+所读取指令的长度，IP指向下一个指令；</li>
<li>4、CPU执行指令缓冲器中的指令；</li>
<li>5、执行后CS:IP继续指向下一个指令</li>
</ul>
</li>
<li>
<p><strong>jmp short 标号的功能为(IP)=(IP)+8位位移。</strong></p>
<ul>
<li>1、8位为=标号处的地址-jmp指令后的第一个字节的地址；</li>
<li>2、short 指明此处的位移为8位；</li>
<li>3、8位位移的范围为-128~127，用补码表示。</li>
<li>4、8位位移由编译程序在编译时算出的。</li>
</ul>
</li>
<li>
<p><strong>jmp near ptr 标号 指令实现段内近转移，功能为(IP)=(IP)+16位位移。</strong></p>
<ul>
<li>1、16位为=标号处的地址-jmp指令后的第一个字节的地址；</li>
<li>2、nearptr 指明此处的位移为16位；</li>
<li>3、16位位移的范围为-32769~32767，用补码表示。</li>
<li>4、16位位移由编译程序在编译时算出的。</li>
</ul>
</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-e6d760bd296c0a36?imageMogr2/auto-orient/strip%7CimageView2/2/w/1093/format/webp alt></p>
<p>转移位移的计算方法</p>
<h2 id=94-转移的目的地址在指令中的jmp指令>9.4 转移的目的地址在指令中的jmp指令</h2>
<ul>
<li><strong>jmp far ptr 段间转移，又称为远转移</strong></li>
<li>jmp far ptr 标号的功能：
<ul>
<li>(CS)=标号所在段的段地址；</li>
<li>(IP)=标号所在段总的偏移地址；</li>
<li>far ptr 指明了指令用标号的段地址和偏移地址修改CS和IP。</li>
</ul>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>          <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span>
          <span class=nf>codesg</span> <span class=no>segment</span>
            <span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
                <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
                <span class=nf>jmp</span> <span class=no>far</span> <span class=no>ptr</span> <span class=no>s</span>
                <span class=nf>db</span> <span class=mi>256</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
              <span class=nl>s:</span><span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>
                  <span class=nf>inc</span> <span class=no>ax</span>
          <span class=nf>codesg</span> <span class=no>ends</span>
          <span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>机器码中包含了转移的目的地址。</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-11dc198f29be97d8?imageMogr2/auto-orient/strip%7CimageView2/2/w/770/format/webp alt></p>
<p>94debug</p>
<h2 id=附注3-汇编编译器masmexe对jmp的相关处理>附注3 汇编编译器(masm.exe)对jmp的相关处理</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-6ea437f414f45563?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>这里写图片描述</p>
<h2 id=95-转移地址在寄存器中的jmp指令>9.5 转移地址在寄存器中的jmp指令</h2>
<ul>
<li>jmp 16位寄存器，功能是16位寄存器赋值给IP，实现段内的近(短)转移。</li>
<li>参考 2.11 修改CS、IP的指令</li>
</ul>
<h2 id=96-转移地址在内存中的jmp指令>9.6 转移地址在内存中的jmp指令</h2>
<ul>
<li>
<p>转移地址在内存中的jmp指令有两种格式：</p>
<ul>
<li><strong>1、jmp word ptr内存单元地址(16位只能实现段内转移)。</strong> 功能是从内存单元地址处开始存放一个字(转移的目的偏移地址)，内存单元地址可用寻址方式的格式给出。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0123</span><span class=no>H</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>],</span><span class=no>ax</span>
    <span class=nf>jmp</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>
    <span class=c>;相当于 jmp ax，执行后(IP)=0123h
</span><span class=c></span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0123</span><span class=no>H</span>
    <span class=nf>mov</span> <span class=p>[</span><span class=no>bx</span><span class=p>],</span><span class=no>ax</span>
    <span class=nf>jmp</span> <span class=no>word</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>]</span>
    <span class=c>;执行后(IP)=0123h
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>2、jmp dword ptr 内存单元地址(段间转移)。</strong> 功能：从内存单元地址处开始存放两个字型数据，高地址是转移的目的段地址，低地址处是转移的目的偏移地址。(CS)=(内存单元地址+2),(IP)=(内存单元地址)，内存单元地址可用寻址方式的任一格式给出。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0123</span><span class=no>H</span>
    <span class=nf>mov</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>],</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>2</span><span class=p>],</span><span class=mi>0</span>
    <span class=nf>jmp</span> <span class=no>dword</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>

    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0123</span><span class=no>H</span>
    <span class=nf>mov</span> <span class=p>[</span><span class=no>dx</span><span class=p>],</span><span class=no>ax</span>
    <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=mi>0</span>
    <span class=nf>jmp</span> <span class=no>dword</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>]</span>

    <span class=c>;执行后 (CS)=0,(IP)=0123H CS:IP指向0000:0123
</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id=检测点-91>检测点 9.1</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-ca902f4043f8894c?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点 9.1</p>
<h2 id=97-jcxz指令>9.7 jcxz指令</h2>
<ul>
<li><strong>指令格式为jcxz 标号，如果cx的值为0，则转移到标号处执行，不为0则向下执行。</strong>
<ul>
<li>当cx的值为0时，(IP)=(IP)+8位位移，8位位移=标号处的地址-jcxz指令后的第一个字节的地址。</li>
<li>8位位移的范围是-128~127，用补码表。</li>
<li>8位位移由编译器在编译时算出。</li>
</ul>
</li>
<li><strong>jcxz指令是有条件转移指令，所有的条件转移指令都是短指令，在对应的机器码中包含转移的位移而不包含目的地址，对IP的修改范围都为-128-127。</strong></li>
</ul>
<h2 id=检测点-92>检测点 9.2</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-956e0d3482f3fbb2?imageMogr2/auto-orient/strip%7CimageView2/2/w/1042/format/webp alt></p>
<p>检测点9.2_1</p>
<h2 id=98-loop指令>9.8 loop指令</h2>
<ul>
<li>**loop指令为循环指令，所有的循环指令都是短转移，在对应的机器码中包含转移的位移而不包含目的地址。**操作i：
<ul>
<li><strong>cx先自减1；</strong></li>
<li><strong>当cx的值不为0时，(IP)=(IP)+8位位移，8位位移=标号处的地址-loop指令后的第一个字节的地址。</strong></li>
<li>8位位移的范围是-128~127，用补码表。</li>
<li>8位位移由编译器在编译时算出。</li>
</ul>
</li>
</ul>
<h2 id=检测点-93>检测点 9.3</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-bfe3635e8b3f60f3?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点 9.3</p>
<h2 id=99-根据位移进行转移的意义>9.9 根据位移进行转移的意义</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>jmp</span> <span class=no>short</span> <span class=err>标号</span>
    <span class=nf>jmp</span> <span class=no>near</span> <span class=no>ptr</span> <span class=err>标号</span>
    <span class=nf>jcxz</span> <span class=err>标号</span>
    <span class=nf>loop</span> <span class=err>标号</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>它们对IP的修改时根据转移目的地址和转移起始地址自检的位移来进行的。在它们对应的机器码中不包含转移的目的地址，而包含的是目的地址的位移距离。方便了程序段在内存中的浮动分配，没有固定目的地址的限制，更灵活。</strong></li>
</ul>
<h2 id=910-编译器对转移位移超界的检测>9.10 编译器对转移位移超界的检测</h2>
<ul>
<li>根据位移进行转移的指令，它们的转移范围受到了转移位移的限制，如果在源程序中出现了转移范围超界的问题，在编译时编译器会报错。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>  <span class=nf>jmp</span> <span class=no>short</span> <span class=no>s</span>
          <span class=nf>db</span> <span class=mi>128</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
          <span class=nl>s:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>FFFFH</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-df672c24ab0ef975?imageMogr2/auto-orient/strip%7CimageView2/2/w/729/format/webp alt></p>
<p>910err</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-fd423526c0df25ba?imageMogr2/auto-orient/strip%7CimageView2/2/w/737/format/webp alt></p>
<p>910err2</p>
<h1 id=实验8>实验8</h1>
<ul>
<li>
<p>实验八可以正常退出</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-5aa8478221dda3aa?imageMogr2/auto-orient/strip%7CimageView2/2/w/842/format/webp alt></p>
<p>test8</p>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span>
<span class=nf>codesg</span> <span class=no>segment</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

      <span class=nl>start:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
          <span class=nl>s:</span><span class=nf>nop</span>
            <span class=nf>nop</span><span class=c>;nop占用两个字节，不执行任何操作
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=no>offset</span> <span class=no>s</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=no>offset</span> <span class=no>s2</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>cs</span><span class=p>:[</span><span class=no>si</span><span class=p>]</span><span class=c>;jmp short s1的机器码给了ax
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cs</span><span class=p>:[</span><span class=no>di</span><span class=p>],</span><span class=no>ax</span><span class=c>;覆盖到指令 s:nop nop那
</span><span class=c></span>
         <span class=nl>s0:</span><span class=nf>jmp</span> <span class=no>short</span> <span class=no>s</span><span class=c>;s那已经被jmp short s1机器码覆盖
</span><span class=c></span>         <span class=no>s1</span><span class=p>:</span><span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
         <span class=nl>s2:</span><span class=nf>jmp</span> <span class=no>short</span> <span class=no>s1</span><span class=c>;jmp -8h，向上跳到s1，s1又向上跳-10字节
</span><span class=c></span>            <span class=no>nop</span>
<span class=nf>codesg</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>   
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-cda0538dc883dda1?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>test8debug</p>
<h1 id=实验9>实验9</h1>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-c2282a11b29e1ebc?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>实验9</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>data</span><span class=p>,</span><span class=no>ss</span><span class=p>:</span><span class=no>stack</span>

<span class=nf>data</span> <span class=no>segment</span>
            <span class=nf>db</span><span class=err>&#39;</span><span class=no>welcome</span> <span class=no>to</span> <span class=no>masm</span><span class=p>!</span><span class=err>&#39;</span><span class=c>;定义要显示的字符串(共16字节)
</span><span class=c></span>            <span class=no>db</span> <span class=mi>02</span><span class=no>H</span><span class=p>,</span><span class=mi>24</span><span class=no>H</span><span class=p>,</span><span class=mi>71</span><span class=no>H</span><span class=c>;定义字符的属性
</span><span class=c></span><span class=no>data</span> <span class=no>ends</span>

<span class=nf>stack</span> <span class=no>segment</span>
            <span class=nf>dw</span> <span class=mi>8</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
<span class=nf>stack</span> <span class=no>ends</span>

<span class=nf>code</span> <span class=no>segment</span>

    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stack</span>
            <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>10</span><span class=no>H</span>

            <span class=nf>xor</span> <span class=no>bx</span><span class=p>,</span><span class=no>bx</span><span class=c>;bx清零，用来索引颜色
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>b872H</span><span class=c>;算出屏幕第12行中间的显存的段起始位置放入ax中
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>3</span><span class=c>;s3循环控制行数，要显示三个字符串外循环为3次
</span><span class=c></span>        <span class=no>s3</span><span class=p>:</span> <span class=no>push</span> <span class=no>cx</span><span class=c>;三个进栈操作为外循环s3保存相关寄存器的值
</span><span class=c></span>            <span class=no>push</span> <span class=no>ax</span><span class=c>;以防止它们的值在内循环中被破坏
</span><span class=c></span>            <span class=no>push</span> <span class=no>bx</span>

            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span><span class=c>;此时es为屏幕第12行中间的显存的段起始位置
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span><span class=c>;si用来索引代码列的字符
</span><span class=c></span>            <span class=no>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>0</span><span class=c>;di用来定位目标列
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>10</span><span class=no>H</span>
            <span class=c>;s1循环控制存放的字符，一个字符串中含有10H个字节内循环为10H次
</span><span class=c></span>        <span class=nl>s1:</span> <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=no>ds</span><span class=p>:[</span><span class=no>si</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>inc</span> <span class=no>si</span>
            <span class=nf>add</span> <span class=no>id</span><span class=p>,</span><span class=mi>2</span>
            <span class=nf>loop</span> <span class=no>s1</span><span class=c>;吃循环实现偶地址中存放字符
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>1</span><span class=c>;设置di的值为1，为在显存奇数地址中存放字符的颜色属性做准备
</span><span class=c></span>            <span class=no>pop</span> <span class=no>bx</span>
            <span class=nf>mov</span> <span class=no>al.ds</span><span class=p>:[</span><span class=no>bx</span><span class=err>+</span><span class=mi>10</span><span class=no>H</span><span class=p>]</span><span class=c>;取消颜色属性
</span><span class=c></span>            <span class=no>inc</span> <span class=no>bx</span>

            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>10</span><span class=no>H</span><span class=c>;第二个内循环也为10H
</span><span class=c></span>        <span class=no>s2</span><span class=p>:</span> <span class=no>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>add</span> <span class=no>di</span> <span class=mi>2</span>
            <span class=nf>loop</span> <span class=no>s2</span><span class=c>;此循环实现奇数地址存放字符的颜色属性
</span><span class=c></span>
            <span class=c>;以下4句为下一趟外循环做准备
</span><span class=c></span>            <span class=nf>pop</span> <span class=no>ax</span>
            <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>AH</span><span class=c>;将显存的段地址起始地址设置为当前行的下一行
</span><span class=c></span>                      <span class=c>;[在段地址中甲0aH，相当于在偏移地址中加了0a0h(=160d)]
</span><span class=c></span>            <span class=no>pop</span> <span class=no>cx</span>
            <span class=nf>loop</span> <span class=no>s3</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=err>，</span><span class=mi>4</span><span class=no>C00H</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>

<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>welcome to masm</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-9328763b459045db?imageMogr2/auto-orient/strip%7CimageView2/2/w/644/format/webp alt></p>
<p>welcome to masm</p>
<h1 id=十call和ret指令>十、CALL和RET指令</h1>
<h2 id=引言-4>引言</h2>
<ul>
<li>回想程序之间的加载返回过程。</li>
<li>call和ret指令都是转移指令，它们都修改IP或者同时修改CS和IP，经常被共用来实现程序的设计。</li>
<li>这一章讲解call和ret指令的原理。</li>
</ul>
<h2 id=101-ret和retf指令>10.1 ret和retf指令</h2>
<ul>
<li><strong>ret指令用栈中的数据来修改IP的内容，从而实现近转移。</strong></li>
<li>CPU执行ret指令时：
<ul>
<li>1、(IP)=((SS)*16+(SP))，指向栈顶</li>
<li>2、(SP)=(SP)+2</li>
</ul>
</li>
<li><strong>retf指令用栈中的数据，修改CS和IP的内容，从而实现远转移。</strong></li>
<li>CPU执行retf指令时，进行下面两步操作：
<ul>
<li>1、(IP)=((SS)*16+(SP))</li>
<li>2、(SP)=(SP)+2</li>
<li>3、(CS)=((SS)*16+(SP))</li>
<li>4、(SP)=(SP)+2</li>
</ul>
</li>
<li>用汇编的语法来解释ret和retf指令：
<ul>
<li>CPU执行ret指令相当于进行 POP IP</li>
<li>CPU执行retf指令相当于进行 POP IP和POP CS</li>
</ul>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span>

 <span class=nf>stack</span> <span class=no>segment</span>
              <span class=nf>db</span> <span class=mi>16</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
<span class=nf>stack</span> <span class=no>ends</span>

          <span class=nf>codesg</span> <span class=no>segment</span>
              <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
              <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

          <span class=nl>start:</span>
              <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stack</span>
              <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
              <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>16</span>
              <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>

              <span class=nf>push</span> <span class=no>ax</span>

              <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
              <span class=nf>ret</span>
<span class=nf>codesg</span> <span class=no>ends</span>

<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-0be8eabb3a8f4aca?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>1012debug_1</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span>

<span class=nf>stack</span> <span class=no>segment</span>
        <span class=nf>db</span> <span class=mi>16</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
<span class=nf>stack</span> <span class=no>ends</span>

<span class=nf>codesg</span> <span class=no>segment</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
        <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

    <span class=nl>start:</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stack</span>
        <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
        <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>16</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>push</span> <span class=no>cs</span>
        <span class=nf>push</span> <span class=no>ax</span>


        <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>retf</span>
<span class=nf>codesg</span> <span class=no>ends</span>

<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=检测点-101>检测点 10.1</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-1cc00b307b779d19?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点10.1</p>
<h2 id=102-call指令>10.2 call指令</h2>
<ul>
<li>call指令经常跟ret指令配合使用，CPU执行call指令时：
<ul>
<li><strong>1、将当前的IP或者CS和IP压入栈；</strong></li>
<li><strong>2、转移(jmp)。</strong></li>
</ul>
</li>
<li>call指令除了不能实现短转移之外，call指令实现转移的方法和jmp指令的原理相同。call指令实现段间的转移(远转移)或近转移。</li>
</ul>
<h2 id=103-依据位移进行转移的call指令>10.3 依据位移进行转移的call指令</h2>
<ul>
<li>call标号(将当前的IP压入栈后转到目标处执行指令)，执行时进行以下操作：
<ul>
<li>1、(SP)=(SP)-2<br>
((SS)*16+(SP))=(IP)</li>
<li>2、(IP)=(IP)+16位位移；</li>
<li>3、16位位移=标号处的地址减去call指令后的第一个字节的地址。16位位移的范围是-32768~32767，用补码表示。16位位移由编译器编译时算出。</li>
</ul>
</li>
<li>用汇编语法解释call指令：</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>push</span> <span class=no>IP</span>
<span class=nf>jmp</span> <span class=no>near</span> <span class=err>标号</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=检测点-102>检测点 10.2</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-19fb464bd0f63b53?imageMogr2/auto-orient/strip%7CimageView2/2/w/1198/format/webp alt></p>
<p>检测点10.2</p>
<h2 id=104-转移的目的地址在指令中的call指令>10.4 转移的目的地址在指令中的call指令</h2>
<ul>
<li>call far ptr 标号 实现的是段间转移，执行时：
<ul>
<li>1、CS先自减2；</li>
<li>2、CS的值等于SS的值乘以16加上SP的值，SP自减2，IP的值等于SS的值*16加上SP的值；</li>
<li>3、CS的值等于标号所在的段地址，IP的值等于标号所在的偏移地址.</li>
</ul>
</li>
<li>用汇编语法解释call指令：</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>push</span> <span class=no>CS</span>
<span class=nf>push</span> <span class=no>IP</span>
<span class=nf>jmp</span> <span class=no>far</span> <span class=no>ptr</span> <span class=err>标号</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=检测点-103>检测点 10.3</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-c393ece2c79a0562?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点 10.3</p>
<h2 id=105-转移地址在寄存器中的call指令>10.5 转移地址在寄存器中的call指令</h2>
<ul>
<li>指令格式是：call 16位寄存器，功能是：
<ul>
<li>1、SP的值先自减2；</li>
<li>2、IP的值SS的值乘以16再加上SP的值；</li>
<li>3、 IP的值等于16位寄存器的内容。</li>
</ul>
</li>
<li>用汇编语法解释此种call指令，CPU执行call 16位reg时，相当于：</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>          <span class=nf>push</span> <span class=no>IP</span>
          <span class=nf>jmp</span> <span class=mi>16</span><span class=err>位寄存器</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=检测点-104>检测点 10.4</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-063fe7056be0dae2?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点 10.4</p>
<h2 id=106-转移地址在内存中的call指令>10.6 转移地址在内存中的call指令</h2>
<ul>
<li>转移地址在内存中的call指令有两种格式</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>       <span class=nf>call</span> <span class=no>word</span> <span class=no>ptr</span> <span class=err>内存单元地址</span><span class=c>;段内跳转
</span><span class=c></span>       <span class=no>call</span> <span class=no>dword</span> <span class=no>ptr</span> <span class=err>内存单元地址</span><span class=c>;段间跳转
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>用汇编语法解释call word ptr 内存单元地址</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>       <span class=nf>push</span> <span class=no>IP</span>
       <span class=nf>jmp</span> <span class=no>word</span> <span class=no>ptr</span> <span class=err>内存单元地址</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>例子：</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>       <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>10</span><span class=no>h</span>
       <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0123</span><span class=no>H</span>
       <span class=nf>mov</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>],</span><span class=no>ax</span>
       <span class=nf>call</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>
       <span class=c>;执行后IP的值等于0123H，SP的值等于0EH
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>用汇编语法解释call dword ptr 内存单元地址</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>       <span class=nf>push</span> <span class=no>CS</span>
       <span class=nf>push</span> <span class=no>IP</span>
       <span class=nf>jmp</span> <span class=no>word</span> <span class=no>ptr</span> <span class=err>内存单元地址</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>例子：</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>       <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>10</span><span class=no>h</span>
       <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0123</span><span class=no>H</span>
       <span class=nf>mov</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>],</span><span class=no>ax</span>
       <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>],</span><span class=mi>0</span>
       <span class=nf>call</span> <span class=no>dword</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>
       <span class=c>;执行后IP的值等于0123H，SP的值等于0CH，CS的值等于0
</span></code></pre></td></tr></table>
</div>
</div><h2 id=检测点-105>检测点 10.5</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-f832aec987833d5b?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点10.5</p>
<h2 id=107-call和ret的配合使用>10.7 call和ret的配合使用</h2>
<ul>
<li>下面的程序返回前，bx中的值是多少？</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
<span class=nf>code</span> <span class=no>segment</span>
      <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>3</span>
            <span class=nf>call</span> <span class=no>s</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
          <span class=nl>s:</span>
            <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>loop</span> <span class=no>s</span>
            <span class=nf>ret</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>具有一定功能的程序段称为子程序，<strong>用call转去执行，在子程序后面使用ret实现返回。</strong></li>
<li>具有子程序的源程序的框架如下</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-00d707a08b70a26d?imageMogr2/auto-orient/strip%7CimageView2/2/w/1067/format/webp alt></p>
<p>107call</p>
<h2 id=108-mull指令>10.8 mull指令</h2>
<ul>
<li>mull指令时乘法指令，<strong>相乘的两个数要么都是8位的，要么都是16位的</strong>
<ul>
<li>8位：在AL中和8位寄存器中或内存字节单元中；</li>
<li>16位：在AX中和16位寄存器或内存字单元中。</li>
<li>结果
<ul>
<li>8位的存放在AX中；</li>
<li>16位：DX(高位)和AX(低位)中。</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mull</span> <span class=no>reg</span>

<span class=nf>mull</span> <span class=err>内存单元</span>
<span class=nf>mull</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>

<span class=nf>mull</span> <span class=no>word</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=err>+</span><span class=no>si</span><span class=err>+</span><span class=no>idata</span><span class=p>]</span>
<span class=c>;(ax)=(ax)*((ds)*16+(bx)+(si)+idata)
</span><span class=c>;(dx)=(ax)*((ds)*16+(bx)+(si)+idata)
</span></code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;计算100*10，两个数都小于255，可以做8位乘法
</span><span class=c></span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>100</span>
<span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>10</span>
<span class=nf>mull</span> <span class=no>bl</span>
<span class=c>;结果(ax)=1000(03E8H)
</span><span class=c></span>
<span class=c>;计算100*1000，1000都大于255，要做16位乘法
</span><span class=c></span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>100</span><span class=c>;高位自动补零
</span><span class=c></span><span class=no>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>10000</span>
<span class=nf>mull</span> <span class=no>bx</span>
<span class=c>;结果(ax)=4240H，(dx)=000FH，F4240H=1000000
</span></code></pre></td></tr></table>
</div>
</div><h2 id=109-模块化程序设计>10.9 模块化程序设计</h2>
<ul>
<li>cal和ret指令共同支持汇编语言编程中的模块化设计。</li>
</ul>
<h2 id=1010-参数和结果传递的问题>10.10 参数和结果传递的问题</h2>
<ul>
<li>
<p>用寄存器来存储参数和结果是最常用的方法。对于存放参数的寄存器和存放结果的寄存器，调用者和子程序的读写操作恰恰相反：</p>
<ul>
<li>调用者将参数送入参数寄存器，从结果寄存器中取到返回值；</li>
<li>子程序 从参数寄存器中取到参数，将返回值送入结果寄存器。</li>
</ul>
</li>
<li>
<p>编程：根据提供的N来计算N^3</p>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nl>cube:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>bx</span>
               <span class=nf>mul</span> <span class=no>bx</span>
               <span class=nf>mul</span> <span class=no>bx</span>
               <span class=nf>ret</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>编程：计算data段中第一组数据的3次方，结果保存在后面一组dword单元中</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

<span class=nf>data</span> <span class=no>segment</span>
          <span class=nf>dw</span> <span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span>
          <span class=nf>dd</span> <span class=mi>8</span> <span class=no>dup</span> <span class=p>(</span><span class=mi>0</span><span class=p>)</span>
<span class=nf>data</span> <span class=no>ends</span>

<span class=nf>code</span> <span class=no>segment</span>
          <span class=nl>start:</span>
              <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
              <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
              <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span><span class=c>;ds:si指向第一组word单元
</span><span class=c></span>              <span class=no>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>16</span><span class=c>;ds:di指向第二组dword单元
</span><span class=c></span>
              <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>8</span>
          <span class=nl>s:</span>  <span class=nf>mov</span> <span class=no>bx</span><span class=p>,[</span><span class=no>si</span><span class=p>]</span>
              <span class=nf>call</span> <span class=no>cube</span>
              <span class=nf>mov</span> <span class=p>[</span><span class=no>di</span><span class=p>],</span><span class=no>ax</span>
              <span class=nf>mov</span> <span class=p>[</span><span class=no>di</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=no>dx</span>
              <span class=nf>add</span> <span class=no>si</span><span class=p>,</span><span class=mi>2</span><span class=c>;ds:di指向下一个word单元
</span><span class=c></span>              <span class=no>add</span> <span class=no>di</span><span class=p>,</span><span class=mi>4</span><span class=c>;ds:di指向下一个dword单元
</span><span class=c></span>              <span class=no>loop</span> <span class=no>s</span>

              <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
              <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

             <span class=nl>cube:</span><span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>bx</span>
              <span class=nf>mul</span> <span class=no>bx</span>
              <span class=nf>mul</span> <span class=no>bx</span>
              <span class=nf>ret</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=1011-批量数据的传递>10.11 批量数据的传递</h2>
<ul>
<li>将批量数据放在内存中，然后将他们呢所在内存空间的首地址放在寄存器中，传递给需要的子程序，批量数据的返回结果也是采用同样的方法。除此之外还可以用栈来传递参数。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

<span class=nf>data</span> <span class=no>segment</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=no>conversation</span><span class=err>&#39;</span>
<span class=nf>data</span> <span class=no>ends</span>

    <span class=nl>start:</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
        <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
        <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span><span class=c>;ds:si指向字符串(批量数据)所在空间的首地址
</span><span class=c></span>
        <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>12</span><span class=c>;cx存放字符串的长度
</span><span class=c></span>        <span class=no>call</span> <span class=no>capital</span>

        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
        <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

    <span class=nl>capital:</span>
        <span class=nf>add</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>si</span><span class=p>],</span><span class=mi>11011111</span><span class=no>B</span>
        <span class=nf>inc</span> <span class=no>si</span>
        <span class=nf>loop</span> <span class=no>capital</span>
        <span class=nf>ret</span>
<span class=nf>code</span> <span class=no>ends</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=1012-寄存器冲突的问题>10.12 寄存器冲突的问题</h2>
<ul>
<li>编程：将一个全是字母，以0结尾的字符串转化为大写</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nl>capital:</span>
        <span class=nf>mov</span> <span class=no>cl</span><span class=p>,[</span><span class=no>si</span><span class=p>]</span><span class=c>;低8位
</span><span class=c></span>        <span class=no>mov</span> <span class=no>ch</span><span class=p>,</span><span class=mi>0</span><span class=c>;高8位设置为0
</span><span class=c></span>        <span class=no>jcxz</span> <span class=no>ok</span><span class=c>;如果(cx)=0则结束，如果不是0则处理
</span><span class=c></span>        <span class=no>and</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>si</span><span class=p>],</span><span class=mi>11011111</span><span class=no>B</span>
        <span class=nf>inc</span> <span class=no>si</span>
        <span class=nf>jmp</span> <span class=no>short</span> <span class=no>capital</span>
    <span class=nl>ok:</span>
        <span class=nf>ret</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>编程将data段中的字符串全部转化为大写</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
    <span class=nf>data</span> <span class=no>segment</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=no>word</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=no>unix</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=no>wind</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=no>good</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>data</span> <span class=no>ends</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;此程序有bug，cx有问题
</span><span class=c></span>    <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>data</span> <span class=no>segment</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=no>word</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=no>unix</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=no>wind</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>db</span><span class=err>&#39;</span><span class=no>good</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>data</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span>

            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>4</span>
        <span class=nl>s:</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=no>bx</span>
            <span class=nf>call</span> <span class=no>capital</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>5</span>
            <span class=nf>loop</span> <span class=no>s</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

    <span class=nl>capital:</span>
            <span class=nf>mov</span> <span class=no>cl</span><span class=p>,[</span><span class=no>si</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=no>ch</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>jcxz</span> <span class=no>ok</span>
            <span class=nf>and</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>si</span><span class=p>],</span><span class=mi>11011111</span><span class=no>b</span>
            <span class=nf>inc</span> <span class=no>si</span>
            <span class=nf>jmp</span> <span class=no>short</span> <span class=no>capital</span>
        <span class=nl>ok:</span>
            <span class=nf>ret</span>

    <span class=nf>code</span> <span class=no>ends</span>
    <span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h1 id=实验十>实验十</h1>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-96127f8d658020be?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>test10_1_1</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-5db082ab094e3ebd?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>test10_1_2</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-d3292727d44a40f9?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>test10_1_3</p>
<ul>
<li>实验10.1 显示字符串</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

<span class=nf>data</span> <span class=no>segment</span>
    <span class=nf>db</span> <span class=err>&#39;</span><span class=no>welcome</span> <span class=no>to</span> <span class=no>masm</span><span class=p>!</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>0</span>
<span class=nf>data</span> <span class=no>ends</span>

<span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>dh</span><span class=p>,</span><span class=mi>8</span><span class=c>;行号
</span><span class=c></span>            <span class=no>mov</span> <span class=no>dl</span><span class=p>,</span><span class=mi>3</span><span class=c>;列号
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cl</span><span class=p>,</span><span class=mi>2</span><span class=c>;颜色属性
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>call</span> <span class=no>show_str</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
        <span class=nl>show_str:</span><span class=c>;子程序
</span><span class=c></span>            <span class=nf>push</span> <span class=no>cx</span>
            <span class=nf>push</span> <span class=no>si</span>

            <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>0</span><span class=no>A0h</span><span class=c>;每行有80*2=160个字节=0a0h
</span><span class=c></span>            <span class=no>dec</span> <span class=no>dh</span><span class=c>;行号在显存中下标从0开始，所以减1
</span><span class=c></span>            <span class=no>mul</span> <span class=no>dh</span><span class=c>;相当于从第(n-1)*0a0h个byte单元开始
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=no>ax</span><span class=c>;定位好的位置偏移地址存放在bx里(行)
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>2</span><span class=c>;每个字符占2个字节
</span><span class=c></span>            <span class=no>mul</span> <span class=no>dl</span><span class=c>;定位列，结果ax存放的是定位好的列的位置
</span><span class=c></span>            <span class=no>sub</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2</span><span class=c>;列号在显存中下标从0开始，又因为是偶字节存放字符，所以减2
</span><span class=c></span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=no>ax</span><span class=c>;此时bx中存放的是行与列的偏移地址
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>B800h</span><span class=c>;显存开始的地方
</span><span class=c></span>            <span class=no>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span><span class=c>;es中存放的是显存的第0页的起始地段地址
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>0</span><span class=c>;di指向显存的偏移地址，确定指向下一个要处理的字符的位置
</span><span class=c></span>            <span class=no>mov</span> <span class=no>al</span><span class=p>,</span><span class=no>cl</span><span class=c>;cl存放颜色参数，下边cl要用来临时存放要处理的字符
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ch</span><span class=p>,</span><span class=mi>0</span><span class=c>;下边cx存放的是每次准备处理的字符
</span><span class=c></span>        <span class=no>s</span><span class=p>:</span>
            <span class=nf>mov</span> <span class=no>cl</span><span class=p>,</span><span class=no>ds</span><span class=p>:[</span><span class=no>si</span><span class=p>]</span><span class=c>;指向&#39;welcome to masm &#39;,0
</span><span class=c></span>
            <span class=nf>jcxz</span> <span class=no>ok</span><span class=c>;cl为0时跳转
</span><span class=c></span>            <span class=no>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>bx</span><span class=err>+</span><span class=no>di</span><span class=p>],</span><span class=no>cl</span><span class=c>;偶地址存放字符
</span><span class=c></span>            <span class=no>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>bx</span><span class=err>+</span><span class=no>di</span><span class=err>+</span><span class=mi>1</span><span class=p>],</span><span class=no>al</span><span class=c>;奇地址存放字符的颜色属性
</span><span class=c></span>            <span class=no>inc</span> <span class=no>si</span>
            <span class=nf>add</span> <span class=no>di</span><span class=p>,</span><span class=mi>2</span><span class=c>;指向了下个字符
</span><span class=c></span>            <span class=no>jmp</span> <span class=no>short</span> <span class=no>s</span> <span class=c>;无条件跳转，jcxz是离开的关键跳
</span><span class=c></span>
        <span class=nl>ok:</span>
            <span class=nf>pop</span> <span class=no>si</span>
            <span class=nf>pop</span> <span class=no>cx</span>
            <span class=nf>ret</span><span class=c>;定义结束
</span><span class=c></span><span class=no>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-508df3eb18966546?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>test101</p>
<ul>
<li>实验10.2</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span><span class=p>,</span><span class=no>ss</span><span class=p>:</span><span class=no>stack</span>

    <span class=nf>stack</span> <span class=no>segment</span>
    <span class=nf>dw</span> <span class=mi>8</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=nf>stack</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>

    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stack</span>
            <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>10</span><span class=no>h</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4240</span><span class=no>h</span>
            <span class=nf>mov</span> <span class=no>dx</span><span class=p>,</span><span class=mi>0</span><span class=no>fh</span>
            <span class=nf>mov</span> <span class=no>xx</span><span class=p>,</span><span class=mi>0</span><span class=no>ah</span>

            <span class=nf>call</span> <span class=no>divdw</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

        <span class=nl>divdw:</span>
            <span class=nf>push</span> <span class=no>ax</span><span class=c>;低16位先保存
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>dx</span><span class=c>;ax这时是高16位了
</span><span class=c></span>            <span class=no>mov</span> <span class=no>dx</span><span class=p>,</span><span class=mi>0</span><span class=c>;为了不影响余数位和高位数
</span><span class=c></span>            <span class=no>div</span> <span class=no>cx</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>pop</span> <span class=no>ax</span>
            <span class=nf>div</span> <span class=no>cx</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=no>dx</span>
            <span class=nf>mov</span> <span class=no>dx</span><span class=p>,</span><span class=no>dx</span>
            <span class=nf>ret</span>
    <span class=nf>code</span> <span class=no>ends</span>
    <span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>实验10.3</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>data</span>

<span class=nf>data</span> <span class=no>segment</span>
    <span class=nf>db</span> <span class=mi>10</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
<span class=nf>data</span> <span class=no>ends</span>

<span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>12666</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=no>data</span><span class=c>;指向字符串的首地址
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>bx</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>

            <span class=nf>call</span> <span class=no>dtoc</span><span class=c>;实现将word型整数转化为字符串并存储
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>dh</span><span class=p>,</span><span class=mi>8</span><span class=c>;打印初始化
</span><span class=c></span>            <span class=no>mov</span> <span class=no>dl</span><span class=p>,</span><span class=mi>3</span>
            <span class=nf>mov</span> <span class=no>cl</span><span class=p>,</span><span class=mi>0</span><span class=no>cah</span>

            <span class=nf>call</span> <span class=no>show_str</span><span class=c>;开始打印字符串
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
        <span class=nl>dtoc:</span>
            <span class=nf>push</span> <span class=no>dx</span>
            <span class=nf>push</span> <span class=no>cx</span>
            <span class=nf>push</span> <span class=no>ax</span>
            <span class=nf>push</span> <span class=no>si</span>

            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;bx在子程序中用来存放位数，用栈来临时存放修改后的字符
</span><span class=c></span>        <span class=no>s1</span><span class=p>:</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>10</span><span class=no>d</span><span class=c>;d表示十进制，cx准备被除，用取余法来取出数字
</span><span class=c></span>            <span class=no>mov</span> <span class=no>dx</span><span class=p>,</span><span class=mi>0</span>

            <span class=nf>div</span> <span class=no>cx</span><span class=c>;除以十
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=no>ax</span><span class=c>;得到的商复制给cx，要利用jcxz
</span><span class=c></span>            <span class=no>jcxz</span> <span class=no>s2</span><span class=c>;当商为0则跳到s2
</span><span class=c></span>            <span class=no>add</span> <span class=no>dx</span><span class=p>,</span><span class=mi>30</span><span class=no>h</span><span class=c>;余数加上30h得到相应的ascii码
</span><span class=c></span>            <span class=no>push</span> <span class=no>dx</span>
            <span class=nf>inc</span> <span class=no>bx</span>

            <span class=nf>jmp</span> <span class=no>short</span> <span class=no>s1</span>
        <span class=nf>s2</span><span class=err>：</span>
            <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=mi>30</span><span class=no>h</span><span class=c>;当商为0的时候，余数为个位
</span><span class=c></span>            <span class=no>push</span> <span class=no>dx</span>

            <span class=nf>inc</span> <span class=no>bx</span><span class=c>;再进行一次栈操作(补充当商为零而余数不为零时的情况)
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=no>bx</span><span class=c>;总共有bx位进栈，所以循环次数为bx
</span><span class=c></span>            <span class=no>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
        <span class=nl>s3:</span>
            <span class=nf>pop</span> <span class=no>ax</span><span class=c>;s3实现将栈中的数据依次出栈放到指定的内存中
</span><span class=c></span>            <span class=no>mov</span> <span class=p>[</span><span class=no>si</span><span class=p>],</span><span class=no>al</span>
            <span class=nf>inc</span> <span class=no>si</span>
            <span class=nf>loop</span> <span class=no>s3</span>

        <span class=nl>okay:</span>
            <span class=nf>pop</span> <span class=no>bx</span>
            <span class=nf>pop</span> <span class=no>si</span>
            <span class=nf>pop</span> <span class=no>ax</span>
            <span class=nf>pop</span> <span class=no>dx</span>

            <span class=nf>ret</span>
        <span class=nl>show_str:</span><span class=c>;子程序
</span><span class=c></span>            <span class=nf>push</span> <span class=no>bx</span>
            <span class=nf>push</span> <span class=no>cx</span>
            <span class=nf>push</span> <span class=no>si</span>

            <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>0</span><span class=no>A0h</span><span class=c>;每行有80*2=160个字节=0a0h
</span><span class=c></span>            <span class=no>dec</span> <span class=no>dh</span><span class=c>;行号在显存中下标从0开始，所以减1
</span><span class=c></span>            <span class=no>mul</span> <span class=no>dh</span><span class=c>;相当于从第(n-1)*0a0h个byte单元开始
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=no>ax</span><span class=c>;定位好的位置偏移地址存放在bx里(行)
</span><span class=c></span>            <span class=no>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>2</span><span class=c>;每个字符占2个字节
</span><span class=c></span>            <span class=no>mul</span> <span class=no>dl</span><span class=c>;定位列，结果ax存放的是定位好的列的位置
</span><span class=c></span>
            <span class=nf>sub</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2</span><span class=c>;列号在显存中下标从0开始，又因为是偶字节存放字符，所以减2
</span><span class=c></span>            <span class=no>add</span> <span class=no>bx</span><span class=p>,</span><span class=no>ax</span><span class=c>;此时bx中存放的是行与列的偏移地址
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>B800h</span><span class=c>;显存开始的地方
</span><span class=c></span>            <span class=no>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span><span class=c>;es中存放的是显存的第0页的起始地段地址
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>0</span><span class=c>;di指向显存的偏移地址，确定指向下一个要处理的字符的位置
</span><span class=c></span>            <span class=no>mov</span> <span class=no>al</span><span class=p>,</span><span class=no>cl</span><span class=c>;cl存放颜色参数，下边cl要用来临时存放要处理的字符
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ch</span><span class=p>,</span><span class=mi>0</span><span class=c>;下边cx存放的是每次准备处理的字符
</span><span class=c></span>        <span class=no>S</span><span class=p>:</span>
            <span class=nf>mov</span> <span class=no>cl</span><span class=p>,</span><span class=no>ds</span><span class=p>:[</span><span class=no>si</span><span class=p>]</span>

            <span class=nf>jcxz</span> <span class=no>ok</span>

            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>bx</span><span class=err>+</span><span class=no>di</span><span class=p>],</span><span class=no>cl</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>bx</span><span class=err>+</span><span class=no>di</span><span class=err>+</span><span class=no>i</span><span class=p>],</span><span class=no>al</span>

            <span class=nf>inc</span> <span class=no>si</span>
            <span class=nf>add</span> <span class=no>di</span><span class=p>,</span><span class=mi>2</span>

            <span class=nf>jmp</span> <span class=no>short</span> <span class=no>s</span>

        <span class=nl>ok:</span>
            <span class=nf>pop</span> <span class=no>si</span>
            <span class=nf>pop</span> <span class=no>cx</span>
            <span class=nf>pop</span> <span class=no>bx</span>
            <span class=nf>ret</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h1 id=十一标志寄存器>十一、标志寄存器</h1>
<h2 id=引言-5>引言</h2>
<ul>
<li>CPU内部的寄存器中有一种特殊的寄存器：
<ul>
<li>1、用来存储相关指令的某些执行结果；</li>
<li>2、用来为CPU执行相关指令提供行为依据；</li>
<li>3、用来控制CPU的相关工作方式。</li>
</ul>
</li>
<li>8086 CPU的标志寄存器只有16位，其中存储的信息通常被称为程序状态字(PSW)。</li>
<li>本章中的标志寄存器(以下简称为flag)。某些指令将影响标志寄存器中的多个标志位，这些被影响的标记位比较全面地记录ill指令的执行结果，为相关的处理提供了所需的依据。</li>
<li>flag寄存器是按位起作用的，每一位都有专门的含义，记录特定的信息，与其他寄存器不一样。</li>
<li>8086 CPU的flag寄存器的结构：</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-d712a884ae249075?imageMogr2/auto-orient/strip%7CimageView2/2/w/1158/format/webp alt></p>
<p>flag</p>
<ul>
<li>flag的1、3、5、12、13、14、15位在8086 CPU中没有使用，而0、2、4、6、7、8、9、10、11位都具有特殊的含义。</li>
</ul>
<h2 id=111-zfzero-flag标志>11.1 ZF(zero flag)标志</h2>
<ul>
<li>flag的第6位是ZF，零标志位，它记录相关指令执行后，结果为0，ZF=1(记录下是0这样的肯定信息)，结果不为0，ZF=0(表示结果非0)。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>
    <span class=nf>sub</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>

    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>
    <span class=nf>and</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
    <span class=c>;指令执行后，结果为0，则ZF=1
</span><span class=c></span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2</span>
    <span class=nf>sub</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>

    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>
    <span class=nf>or</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
    <span class=c>;指令执行后，结果为1，则ZF=0
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在8086CPU中,add、sub、mul、div、inc、or、and等它们大多都是运算(逻辑运算或是算术运算)指令，是影响标志寄存器的，而mov、push、pop等传送指令对标志寄存器一般没有影响，因为不会产生结果。</li>
</ul>
<h2 id=112-pf标志>11.2 PF标志</h2>
<ul>
<li>flag的第2位是PF，奇偶标志位，记录指令执行后结果所有的二进制位中1的个数。为偶数，PF=1，为奇数PF=0</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>1</span>
    <span class=nf>add</span> <span class=no>al</span><span class=p>,</span><span class=mi>10</span>
    <span class=c>;执行结果为00001011B，有3个1，则PF=0
</span><span class=c></span>
    <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>1</span>
    <span class=nf>or</span> <span class=no>al</span><span class=p>,</span><span class=mi>10</span>
    <span class=c>;执行后结果为00000011B，有2个1，则PF=1
</span></code></pre></td></tr></table>
</div>
</div><h2 id=113-sfsign-flag标志>11.3 SF(sign flag)标志</h2>
<ul>
<li>flag的第7位是SF符号标志位，记录指令执行后结果为负则SF=1，结果为正，SF=0。<strong>弱国我们将数据当作无符号数来运算，SF的值没有意义，虽然相关的指令影响了它的值。</strong></li>
<li>有符号数与补码
<ul>
<li>计算机默认把负数用补码记录。</li>
<li>00000001B，可以看作无符号数1，也可以看作符号数+1；</li>
<li>10000001B，可以看作无符号数129，也可以看作有符号数-127。</li>
</ul>
</li>
<li>补码</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>10000001</span><span class=no>B</span>
<span class=nf>add</span> <span class=no>al</span><span class=p>,</span><span class=mi>1</span>
<span class=c>;执行指令后al的值是10000010B，无符号数130，有符号数-126
</span></code></pre></td></tr></table>
</div>
</div><h2 id=检测点-111>检测点 11.1</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-0bcdc71ed3ba4c48?imageMogr2/auto-orient/strip%7CimageView2/2/w/1143/format/webp alt></p>
<p>检测点11.1</p>
<h2 id=114-cfcarry-flag标志>11.4 CF(carry flag)标志</h2>
<ul>
<li>
<p>flag的第0位是CF，进位标志位。一般情况下，在进行无符号运算的时候，它记录了运算结果的最高有效位向更高位的进位值或从更高位的借位值。对于位数为N的无符号数，其对应的二进制信息的最高位为N-1位的最高有效位，假想存在第N位。</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-73facd3f7d1f5598?imageMogr2/auto-orient/strip%7CimageView2/2/w/1101/format/webp alt></p>
<p>更高位</p>
</li>
<li>
<p>两个8位的数据运算可能产生进位或者借位，由于这个进位值在8位数中无法保存，8086CPU就用flag的CF位来记录这个进位值。</p>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>al.98h</span>
    <span class=nf>add</span> <span class=no>al</span><span class=p>,</span><span class=no>al</span><span class=c>;执行后(al)=30h，cf=1，cf记录了从最高有效位向更高位的进位值
</span><span class=c></span>    <span class=no>add</span> <span class=no>al</span><span class=p>,</span><span class=no>al</span><span class=c>;执行后(al)=60h，cf=0，cf记录了从更高有效位向更高位的进位值
</span><span class=c></span>
    <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>97</span><span class=no>h</span>
    <span class=nf>sub</span> <span class=no>al</span><span class=p>,</span><span class=mi>98</span><span class=no>h</span><span class=c>;执行后(al)=ffh，cf=1，cf记录了向更高位的借位值
</span><span class=c></span>    <span class=no>sub</span> <span class=no>al</span><span class=p>,</span><span class=no>al</span><span class=c>;执行后(al)=0，cf=0，cf记录了向更高位的借位值
</span></code></pre></td></tr></table>
</div>
</div><h2 id=115-ofoverflow-flag标志>11.5 OF(overflow flag)标志</h2>
<ul>
<li>如果运算结果超出了机器所能表达的范围(对于8位有符号数，机器所能表达的范围是-128~127)将产生溢出，对有符号数而言。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>code</span> <span class=no>segment</span>

    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>01100010</span><span class=no>b</span>
            <span class=nf>add</span> <span class=no>al</span><span class=p>,</span><span class=mi>01100011</span><span class=no>b</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-640b24ec3b1dc4fa?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>1150f_1</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>code</span> <span class=no>segment</span>

    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>10001000</span><span class=no>b</span>
            <span class=nf>add</span> <span class=no>al</span><span class=p>,</span><span class=mi>11110000</span><span class=no>b</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
    <span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-4298bfcb6b992695?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>115of2</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>98</span><span class=no>h</span>
            <span class=nf>add</span> <span class=no>al</span><span class=p>,</span><span class=no>al</span>
            <span class=nf>add</span> <span class=no>al</span><span class=p>,</span><span class=no>al</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-81cedf4a7b9fd536?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>CFdebug</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>97</span><span class=no>h</span>
            <span class=nf>sub</span> <span class=no>al</span><span class=p>,</span><span class=mi>98</span><span class=no>h</span>
            <span class=nf>add</span> <span class=no>al</span><span class=p>,</span><span class=no>al</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-bb5c78c64ee153ce?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>114cf2</p>
<ul>
<li><strong>CF是对无符号数运算有意义的标志位，而OF是对有符号数运算有意义的标志位；</strong> CPU用CF位来记录无符号数运算是否产生了进位，用OF位来记录有符号数是否产生了溢出。用SF位来记录结果的符号</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>    mov al,98d
    add al,99d
    ;对于无符号数运算，98+99没有进位，CF=0
    ;对于有符号数运算，98+99发生溢出，OF=1
</code></pre></td></tr></table>
</div>
</div><h2 id=检测点-112>检测点 11.2</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-9acf5ebaa90d402c?imageMogr2/auto-orient/strip%7CimageView2/2/w/1162/format/webp alt></p>
<p>检测点11.2</p>
<h2 id=116-adc指令>11.6 adc指令</h2>
<ul>
<li><strong>adc是带有进位加法指令，利用了CF位上记录的进位值。格式:adc操作对象1，操作对象2，功能：操作对象1=操作对象1+操作对象2+CF。</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>2</span>
    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>1</span>
    <span class=nf>sub</span> <span class=no>bx</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>adx</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>
    <span class=c>;执行后 (ax)=4，相当于计算(ax)+1+CF=2+1+1+4
</span><span class=c></span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>
    <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=no>ax</span>
    <span class=nf>adc</span> <span class=no>ax</span><span class=p>,</span><span class=mi>3</span>
    <span class=c>;执行后(ax)=5，相当于执行(ax)+3+CF=2+3+0=5
</span><span class=c></span>
    <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>98</span><span class=no>H</span>
    <span class=nf>add</span> <span class=no>al</span><span class=p>,</span><span class=no>al</span>
    <span class=nf>adx</span> <span class=no>al</span><span class=p>,</span><span class=mi>3</span>
    <span class=c>;执行后 (ax)=34H，相当于执行(ax)+3+CF=30H+3+1=34H
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>由adc指令前面的指令决定在执行adc指令的时候加上的CF的值的含义，关键在于所加上的CF的值是被什么指令设置的。如果CF的值是被sub指令设置的，那么它的含义就是借位值；如果是被add指令设置的，那么它的含义就是进位值。加法运算先是低位相加，再高位相加加上低位相加产生的进位值。</li>
<li>编程：计算1EF000H+201000H,结果存放在AX(高16位)和BX(低16位)中。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>001</span><span class=no>EH</span>
    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=no>F000H</span>
    <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>1000</span><span class=no>H</span>
    <span class=nf>adc</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0020</span><span class=no>H</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>编程：1EF0001000H+2010001EF0H,结果存放在AX(高16位)、BX(次16位)中和cx(低16位)。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>001</span><span class=no>EH</span>
    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=no>F000H</span>
    <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>1000</span><span class=no>H</span>
    <span class=nf>add</span> <span class=no>cx</span><span class=p>,</span><span class=mi>1</span><span class=no>EF0H</span>
    <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>1000</span><span class=no>H</span>
    <span class=nf>adc</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0020</span><span class=no>H</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>编程：对两个128位数据进行相加</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>data</span>
    <span class=nf>data</span> <span class=no>segment</span>
            <span class=nf>db</span> <span class=mi>16</span> <span class=no>dup</span><span class=p>(</span><span class=mi>88</span><span class=no>H</span><span class=p>)</span>
            <span class=nf>db</span> <span class=mi>16</span> <span class=no>dup</span><span class=p>(</span><span class=mi>11</span><span class=no>H</span><span class=p>)</span>
    <span class=nf>data</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>16</span>

            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>8</span>
            <span class=nf>call</span> <span class=no>add128</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>C00H</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>H</span>
    <span class=nl>add128:</span>
            <span class=nf>push</span> <span class=no>ax</span>
            <span class=nf>push</span> <span class=no>cx</span>
            <span class=nf>push</span> <span class=no>si</span>
            <span class=nf>push</span> <span class=no>di</span>

            <span class=nf>sub</span> <span class=no>ax</span><span class=p>,</span><span class=no>ax</span><span class=c>;将CF设置为0
</span><span class=c></span>        <span class=no>s</span><span class=p>:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,[</span><span class=no>si</span><span class=p>]</span>
            <span class=nf>adc</span> <span class=no>ax</span><span class=p>,[</span><span class=no>di</span><span class=p>]</span>
            <span class=nf>mov</span> <span class=p>[</span><span class=no>si</span><span class=p>],</span><span class=no>ax</span>
            <span class=nf>inc</span> <span class=no>si</span><span class=c>;不能用add si,2代替
</span><span class=c></span>            <span class=no>inc</span> <span class=no>si</span><span class=c>;因为会影响cf位
</span><span class=c></span>            <span class=no>inc</span> <span class=no>di</span><span class=c>;而loop和inc不会影响
</span><span class=c></span>            <span class=no>inc</span> <span class=no>di</span>

            <span class=nf>loop</span> <span class=no>s</span>

             <span class=nf>pop</span> <span class=no>di</span>
             <span class=nf>pop</span> <span class=no>si</span>
             <span class=nf>pop</span> <span class=no>cx</span>
             <span class=nf>pop</span> <span class=no>ax</span>
             <span class=nf>ret</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=117-sbb指令>11.7 sbb指令</h2>
<ul>
<li><strong>sbb是带借位减法指令，利用了CF位上记录的借位值。格式：sbb 操作对象1,操作对象2，功能是：操作对象1=操作对象1-操作对象2-CF。</strong></li>
<li>利用sbb指令我们可以对任意大的数据进行减法运算。sbb和adc是基于同样的思想设计的两条指令，在应用思路上sbb和adc类似。</li>
<li>编程：计算003E1000H-00202000H，结果放在ax、bx中</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>1000</span><span class=no>H</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>003</span><span class=no>EH</span>
    <span class=nf>sbb</span> <span class=no>bx</span><span class=p>,</span><span class=mi>2000</span><span class=no>H</span>
    <span class=nf>sbb</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0020</span><span class=no>H</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=118-cmp指令>11.8 cmp指令</h2>
<ul>
<li>cmp是比较指令，功能上相当于减法指令，只是不保存结果。格式：cmp 操作对象1,操作对象2.功能：计算操作对象1-操作对象2但不保存结果，仅仅是根据计算结果对标志寄存器进行设置。</li>
<li>cmp指令运算执行后通过做减法将对标志寄存器产生影响，其他相关指令通过识别这些被影响的标志寄存器位来得知比较结果。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>cmp</span> <span class=no>ax</span><span class=p>,</span><span class=no>ax</span>
    <span class=c>;执行后结果为0，ZF=1,PF=1,SF=0,CF=0,OF=0
</span><span class=c></span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>8</span>
    <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>3</span>
    <span class=nf>cmp</span> <span class=no>ax</span><span class=p>,</span><span class=no>bx</span>
    <span class=c>;执行后ax、bx的值不变，ZF=0,PF=1,SF=0,CF=0,OF=0
</span></code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>cmp</span> <span class=no>ax</span><span class=p>,</span><span class=no>bx</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-a5705fc6d26d1c15?imageMogr2/auto-orient/strip%7CimageView2/2/w/1191/format/webp alt></p>
<p>118cmp_1</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-5be4231bf1034b6c?imageMogr2/auto-orient/strip%7CimageView2/2/w/592/format/webp alt></p>
<p>118cmp2</p>
<ul>
<li>CPU在执行cmp指令时也包含了对无符号数运算和进行有符号数运算，所以利用cmp指令可以对无符号数进行比较也可以对有符号数进行比较。</li>
<li><strong>单纯地考察SF的值不可能知道结果的正负。因为SF记录的只是可以在计算机中存放的相应位数的结果的正负</strong>(例如：add ah， al执行后，SF记录的是ah中的8位二进制信息所表示的数据的正负)。<strong>如果没有溢出发生的话，实际结果的正负和逻辑上真正结果的正负就一致了。</strong>。例如：22H(34)-0A0H(-96)=130=82H(是-126的补码)，SF=1。
<ul>
<li><strong>1、如果SF=1或SF=0，OF=0，逻辑上真正结果的正负=实际结果的正负。</strong></li>
<li><strong>2、如果SF=1或SF=0，OF=1，逻辑上真正结果的负正=实际结果的正负。</strong></li>
</ul>
</li>
</ul>
<h2 id=119-检测比较结果的条件转移指令>11.9 检测比较结果的条件转移指令</h2>
<ul>
<li>与cmp相配使用，根据cmp指令的比较结果(cmp指令执行后相关标志位的值)进行工作的指令。</li>
<li>cmp指令可以同时进行两种比较，无符号数比较和有符号数比较，所以根据cmp指令的比较结果进行转移的指令也分为两种：
<ul>
<li>根据无符号数的比较结果进行转移的条件转移指令，它们检测ZF、CF的值；</li>
<li>根据有符号数的比较结果进行转移的条件转移指令，它们检测SF、OF、ZF的值。</li>
</ul>
</li>
<li><strong>它们所检测的标志位都是cmp指令进行无符号数比较时候记录比较结果的标志位。</strong></li>
</ul>
<table>
<thead>
<tr>
<th>指令</th>
<th>含义</th>
<th>检测的相关标志位</th>
</tr>
</thead>
<tbody>
<tr>
<td>je</td>
<td>等于则转移</td>
<td>ZF=1</td>
</tr>
<tr>
<td>jne</td>
<td>不等于则转移</td>
<td>ZF=0</td>
</tr>
<tr>
<td>jb</td>
<td>低于则转移</td>
<td>CF=1</td>
</tr>
<tr>
<td>jnb</td>
<td>不低于则转移</td>
<td>CF=0</td>
</tr>
<tr>
<td>ja</td>
<td>高于则转移</td>
<td>CF=0 and ZF=0</td>
</tr>
<tr>
<td>jna</td>
<td>不高于则转移</td>
<td>CF=1 or ZF=1</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>j</th>
<th>e</th>
<th>ne</th>
<th>b</th>
<th>nb</th>
<th>a</th>
<th>na</th>
</tr>
</thead>
<tbody>
<tr>
<td>jump</td>
<td>equal</td>
<td>not equal</td>
<td>below</td>
<td>not below</td>
<td>above</td>
<td>not above</td>
</tr>
</tbody>
</table>
<ul>
<li>编程：如果ah的值等于bh则ah的值等于ah的值加ah的值，否则ah的值等于ah的值加上bh的值。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>        <span class=nf>cmp</span> <span class=no>ah</span><span class=p>,</span><span class=no>bh</span>
        <span class=nf>je</span> <span class=no>s</span><span class=c>;ZF=1则跳转
</span><span class=c></span>        <span class=no>add</span> <span class=no>ah</span><span class=p>,</span><span class=no>bh</span>
        <span class=nf>jmp</span> <span class=no>short</span> <span class=no>ok</span>
    <span class=nl>s:</span>
        <span class=nf>add</span> <span class=no>ah</span><span class=p>,</span><span class=no>bh</span>
    <span class=nl>ok:</span><span class=nf>ret</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>je检测的是ZF的位置，不管je前面是什么指令，只要CPU执行je指令时，ZF=1那么就发生转移。</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>je</span> <span class=no>s</span>
        <span class=nf>inc</span> <span class=no>ax</span>
    <span class=nl>s:</span>
        <span class=nf>inc</span> <span class=no>ax</span>
    <span class=c>;执行后ax的值等于1，add ax,0使得ZF=1，所以je指令将进行转移。
</span></code></pre></td></tr></table>
</div>
</div><h2 id=课堂练习>课堂练习</h2>
<ul>
<li>编程:统计data段中数值为8的字节的个数，用ax保存统计结果。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;方案一
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>data</span> <span class=no>segment</span>
            <span class=nf>db</span> <span class=mi>8</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>63</span><span class=p>,</span><span class=mi>38</span>
    <span class=nf>data</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;ds:bx指向第一个字节
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=c>;初始化累加器
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>0</span>

        <span class=nl>s:</span>
            <span class=nf>cmp</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>],</span><span class=mi>8</span><span class=c>;和8进行比较
</span><span class=c></span>            <span class=no>jne</span> <span class=no>next</span><span class=c>;如果不相等转到next，继续循环
</span><span class=c></span>            <span class=no>inc</span> <span class=no>ax</span><span class=c>;如果相等就计数值加1
</span><span class=c></span>
        <span class=nl>next:</span>
            <span class=nf>inc</span> <span class=no>bx</span>
            <span class=nf>loop</span> <span class=no>s</span><span class=c>;执行后：(ax)=3
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>segment</span> 
</code></pre></td></tr></table>
</div>
</div></br>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;方案二
</span><span class=c></span><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>data</span> <span class=no>segment</span>
            <span class=nf>db</span> <span class=mi>8</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>63</span><span class=p>,</span><span class=mi>38</span>
    <span class=nf>data</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;ds:bx指向第一个字节
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=c>;初始化累加器
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>0</span>

        <span class=nl>s:</span>
            <span class=nf>cmp</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>],</span><span class=mi>8</span><span class=c>;和8进行比较
</span><span class=c></span>            <span class=no>je</span> <span class=no>ok</span><span class=c>;如果不相等转到ok，继续循环
</span><span class=c></span>            <span class=no>jmp</span> <span class=no>short</span> <span class=no>next</span><span class=c>;如果不想等就转到next，继续循环
</span><span class=c></span>
        <span class=nl>ok:</span>
            <span class=nf>inc</span> <span class=no>ax</span><span class=c>;如果相等就计数值加1
</span><span class=c></span>
        <span class=nl>next:</span>
            <span class=nf>inc</span> <span class=no>bx</span>
            <span class=nf>loop</span> <span class=no>s</span><span class=c>;执行后：(ax)=3
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>segment</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>编程:统计data段中数值大于8的字节的个数，用ax保存统计结果。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>data</span> <span class=no>segment</span>
            <span class=nf>db</span> <span class=mi>8</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>63</span><span class=p>,</span><span class=mi>38</span>
    <span class=nf>data</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=c>;ds:bx指向第一个字节
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=c>;初始化累加器
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>0</span>

        <span class=nl>s:</span>
            <span class=nf>cmp</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>bx</span><span class=p>],</span><span class=mi>8</span><span class=c>;和8进行比较
</span><span class=c></span>            <span class=no>jna</span> <span class=no>next</span><span class=c>;如果大于8转到next，继续循环
</span><span class=c></span>            <span class=no>inc</span> <span class=no>ax</span><span class=c>;如果大于就计数值加1
</span><span class=c></span>
        <span class=nl>next:</span>
            <span class=nf>inc</span> <span class=no>bx</span>
            <span class=nf>loop</span> <span class=no>s</span><span class=c>;执行后：(ax)=3
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>segment</span> 
</code></pre></td></tr></table>
</div>
</div><h2 id=检测点-113>检测点 11.3</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-51f01d62a37f398a?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>检测点11.3</p>
<h2 id=1110-dfdirection-flag标志和串传送指令>11.10 DF(direction flag)标志和串传送指令</h2>
<ul>
<li><strong>flag的第10位是DF，方向标志位，在串处理指令中，控制每次操作后si(一般指向原始偏移地址)、di(一般指向目标偏移地址)的增减。</strong>
<ul>
<li>DF=0：每次操作后si、di递增；</li>
<li>DF=1，每次操作后so、di递减。</li>
</ul>
</li>
<li><strong>movsb(mov string byte)串传送指令，以字节为单位传送。将ds:si指向的内存单元中的字节送入es:di中，然后根据标志寄存器DF位的值将si和di递增1或递减1。movsw，以字为单位传送。将ds:si指向的内存单元中的字送入es:di中，然后根据标志寄存器DF位的值将si和di递增2或递减2。</strong></li>
<li>**movsb和movsw进行的是串传送操作中的一个步骤，一般和rep配合使用，格式：rep movsb，rep的作用是根据cx 的值，重复执行后面的串传送指令。**由于每次执行一次movsb指令si和di都会递增或递减指向后一个单元或前个单元，则rep movsb就可以循环实现(cx)个字符的传送。
<ul>
<li>1、传送的原始位置；</li>
<li>2、传送的目的位置；</li>
<li>3、传送的长度；</li>
<li>4、传送的方向。</li>
<li>movsb功能：((es)*16+(di))=((ds)*16+(si))，如果DF=0，则(si)=(si)+1,(di)=(di)+1;如果DF=1，则(si)=(si)-1，(di)=(di)-1。</li>
</ul>
</li>
<li>由于flag的DF位决定着串传送指令执行后，si和di改变的方向，8086CPU提供两条指令对DF位进行设置：
<ul>
<li>cld指令：将标志寄存器的DF位设置为0；</li>
<li>std指令：将标志寄存器的DF位设置为1。</li>
</ul>
</li>
</ul>
<h2 id=1111-pushf和popf>11.11 pushf和popf</h2>
<ul>
<li>pushf的功能 是件标志寄存器的值压栈，popf是从栈中弹出数据m，送入标志寄存器中。pushf和popf为直接访问标志寄存器提供了一种方法。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;下面的程序执行后ax的值是多少？
</span><span class=c></span>    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>push</span> <span class=no>ax</span>
    <span class=nf>popf</span>
    <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>fff0h</span>
    <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0010</span><span class=no>h</span>
    <span class=nf>pushf</span>
    <span class=nf>pop</span> <span class=no>ax</span> 
    <span class=no>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>11000101</span><span class=no>b</span>
    <span class=nf>and</span> <span class=no>ah</span> <span class=mi>00001000</span><span class=no>b</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>编程：用串传送指令将data段总的第一个字符串复制到它后面的空间中。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>data</span> <span class=no>segment</span>
            <span class=nf>db</span><span class=err>&#39;</span><span class=no>welcome</span> <span class=no>to</span> <span class=no>masm</span><span class=p>!</span><span class=err>&#39;</span>
            <span class=nf>db</span> <span class=mi>16</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=nf>data</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span><span class=c>;指向data:0
</span><span class=c></span>            <span class=no>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>16</span><span class=c>;指向data:16
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>16</span><span class=c>;rep循环16次
</span><span class=c></span>
            <span class=nf>cld</span><span class=c>;设置DF=0，正向传送
</span><span class=c></span>            <span class=no>rep</span> <span class=no>movsb</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-244969b58f1410e4?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>1110</p>
<ul>
<li>用串传送指令将F00H段中的最后16个字符复制到data段中</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>data</span> <span class=no>segment</span>
            <span class=nf>db</span> <span class=mi>16</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=nf>data</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>f00h</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span><span class=no>ffffh</span><span class=c>;指向f0000:ffff
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>16</span><span class=c>;指向data:15
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>16</span><span class=c>;rep循环16次
</span><span class=c></span>
            <span class=nf>std</span><span class=c>;设置DF=1，逆向传送
</span><span class=c></span>            <span class=no>rep</span> <span class=no>movsb</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=检测点-114>检测点 11.4</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-1585ebbd2027a1dc?imageMogr2/auto-orient/strip%7CimageView2/2/w/843/format/webp alt></p>
<p>检测点11.4</p>
<h2 id=1112-标志寄存器在debug中的表示>11.12 标志寄存器在Debug中的表示</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-fc46994e4160a442?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>debugflag</p>
<table>
<thead>
<tr>
<th>标志</th>
<th>值为1的标记</th>
<th>值为0的标记</th>
</tr>
</thead>
<tbody>
<tr>
<td>OF</td>
<td>OV</td>
<td>NV</td>
</tr>
<tr>
<td>SF</td>
<td>NG</td>
<td>PL</td>
</tr>
<tr>
<td>ZF</td>
<td>ZR</td>
<td>NZ</td>
</tr>
<tr>
<td>PF</td>
<td>PE</td>
<td>PO</td>
</tr>
<tr>
<td>CF</td>
<td>CY</td>
<td>NC</td>
</tr>
<tr>
<td>DF</td>
<td>DN</td>
<td>UP</td>
</tr>
</tbody>
</table>
<h1 id=十二内中断>十二、内中断</h1>
<h2 id=引言-6>引言</h2>
<ul>
<li>中断时CPU处理外部突发事件的一个重要技术。它能使CPU在运行过程中对外部事件发出的中断请求几时进行处理，处理完成后又立即返回断电，基础进行CPU原来的工作。引起中断的原因或是说发出中断请求的来源叫做中断源。根据中断源的不同，可以把中断分为硬件中断和软件中断两大类，而硬件中断又可以分为外部中断和内部中断两类。</li>
<li>外部中断一般是指由计算器外部设备发出的中断请求。如：键盘中断、打印机中断、定时器中断等。外部中断时可以屏蔽的中断，业绩是说利用中断控制器可以屏蔽这些外部设备的中断请求。</li>
<li>内部中断是指因硬件出错(如突然掉电)或运算出错(如除数为0、单步中断)所引起的中断。内部中断是不可屏蔽的。</li>
<li>软件中断其实并不是真正的中断，它们只是可被调用执行的一般程序以及DOS的系统功能调用(int 21)等都是软件中断。</li>
<li>中断的优先权：
<ul>
<li>1、除法出错、溢出中断、软件中断；</li>
<li>2、不可屏蔽中断；</li>
<li>3、可屏蔽中断；</li>
<li>4、单步中断。</li>
</ul>
</li>
<li>中断信息中包含有标识中断源的类型码。根据CPU的设计，中断源类型码的作用就是用来定位中断处理程序。</li>
</ul>
<h2 id=121-内中断的产生>12.1 内中断的产生</h2>
<ul>
<li>8086CPU内部有以下情况发生时将产生相应的中断信息：
<ul>
<li>1、除法错误；</li>
<li>2、单步执行；</li>
<li>3、执行into指令；</li>
<li>4、执行int指令。</li>
</ul>
</li>
<li>8086CPU中的中断类型码如下：
<ul>
<li>1、除法错误：0</li>
<li>2、单步执行：1</li>
<li>3、执行into指令：4</li>
<li>4、执行int指令，该指令格式为int n，n为立即数是提供给CPU的中断类型码。</li>
</ul>
</li>
</ul>
<h2 id=122-中断处理程序>12.2 中断处理程序</h2>
<ul>
<li>CPU在收到中断信息后立即去执行该中断信息的处理程序。</li>
</ul>
<h2 id=123-中断向量表>12.3 中断向量表</h2>
<ul>
<li>中断向量列表就是中断向量(中断处理程序的入口地址)的列表，其在内存中保存，存放着256个中断源说对应的中断处理程序的入口。8086PC机中断向量表放在内存地址0处。从内存0000:0000到0000:03FF的1024(一个物理地址是由段地址和偏移地址构成，要用4个字节来存放)个单元中存放着中断向量表。</li>
<li>CPU用8位的中断类型码通过中断向量表找到相应的中断处理程序的入口地址。中断向量表中存放的就是各个类型的处理程序的地址，8位的类型码是个索引。</li>
</ul>
<h2 id=124-中断过程>12.4 中断过程</h2>
<ul>
<li>用中断码在中断向量表中找到中断处理程序的入口地址，用它来设置CS和IP，使CPU执行中断程序。用中断类型码找到中断向量并用它设置CS和IP，这个工作室由CPU的硬件自动完成的，这个工作的过程被称为中断过程。</li>
<li>8086CPU的中断过程：
<ul>
<li>1、从中断信息中取得中断类型码；</li>
<li>2、标志寄存器的值入栈，以保护标志位；</li>
<li>3、设置标志寄存器的第8位TF和第9位IF的值为0；</li>
<li>4、CS的内容入栈，IP的内容入栈；</li>
<li>5、从内存地址为中断类型码* 4和中断类型码 *4+2的两个字单元中读取中断处理程序的入口地址设置IP和CS。</li>
<li>在最后一步完成后，CPU开始执行由程序员编写的中断处理程序。</li>
</ul>
</li>
</ul>
<h2 id=125-中断处理程序和iret指令>12.5 中断处理程序和iret指令</h2>
<ul>
<li>常规的步骤
<ul>
<li>1、保存用到的寄存器；</li>
<li>2、处理中断；</li>
<li>3、 恢复用到的寄存器；</li>
<li>4、 用iret指令返回。</li>
</ul>
</li>
<li>iret指令的功能为相应的按顺序恢复之前保存起来的IP、CS地址和标志位寄存器。用汇编语法描述为：</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>pop</span> <span class=no>IP</span>
<span class=nf>pop</span> <span class=no>CS</span>
<span class=nf>popf</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=126-除法错误中断的处理>12.6 除法错误中断的处理</h2>
<ul>
<li>当CPU执行dvi等处罚指令的时候，如果发生了除法溢出错误，将产生中断类型码为0的中断信息，CPU将检测到这个信息然后引发中断过程，转去执行0号中断所对应的中断处理程序。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>codesg</span>

    <span class=nf>codesg</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1000</span><span class=no>h</span>
            <span class=nf>mov</span> <span class=no>bh</span><span class=p>,</span><span class=mi>1</span>    
            <span class=no>div</span> <span class=no>bh</span>
    <span class=nf>codesg</span> <span class=no>ends</span>

<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-5c595ab454cfb14c?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>126</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-624615b341ec92a8?imageMogr2/auto-orient/strip%7CimageView2/2/w/635/format/webp alt></p>
<p>debug 126</p>
<h2 id=127-编程处理0号中断>12.7 编程处理0号中断</h2>
<ul>
<li>改变0号中断处理程序的功能，在屏幕中间显示字然后再返回操作系统。
<ul>
<li>当发生除法溢出时产生0号中断信息，引发中断过程。
<ul>
<li>此时CPU将进行以下工作(中断过程)</li>
<li>当中断0发生时，CPU将转去执行中断处理程序。</li>
<li>先进行相关处理，然后向显示缓冲区送字符串，最后返回。</li>
</ul>
</li>
<li>改变后的中断处理程序应该放在内存中，因为除法溢出随时可能发生，CPU随时都可能将CS:IP指向改变后的中断处理程序的入口执行程序。</li>
<li>把程序存入内存，修改向量表(即将内存地址登记在中断向量表的对应表项中)，中断时调用这个内存。</li>
</ul>
</li>
</ul>
<blockquote>
<p>除法溢出对应的中断类型码为0，它的中断处理程序的入口地址应该从0* 4+2地址单元开始存放，段地址存放在0* 4+2字单元中，偏移地址存放在0*4字单元中。也就是改变后的中断处理程序的段地址0存放在0000:0002字单元中，偏移地址200H存放在0000:0000字单元中。如果要显示的字符串在程序的data段中，那么程序执行完成后返回，它所占用的内存空间被系统释放，在其中存放的信息也可能被别的信息覆盖。</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

          <span class=nf>code</span> <span class=no>segment</span>
          <span class=nl>start:</span>
                  <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>cs</span>
                  <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
                  <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=no>offset</span> <span class=no>do0</span><span class=c>;设置ds:di指向源地址
</span><span class=c></span>                  <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
                  <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
                  <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>200</span><span class=no>h</span><span class=c>;设置es:si指向目的地址
</span><span class=c></span>                  <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=no>offset</span> <span class=no>do0end</span> <span class=p>-</span> <span class=no>offset</span> <span class=no>do0</span><span class=c>;设置cx为传输长度，编译器可以识别加减乘除运算符
</span><span class=c></span>                  <span class=no>cld</span><span class=c>;设置传输方向为正
</span><span class=c></span>                  <span class=no>rep</span> <span class=no>movsb</span>

                  <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=c>;设置中断向量表
</span><span class=c></span>                  <span class=no>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
                  <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>0</span><span class=p>*</span><span class=mi>4</span><span class=p>],</span><span class=mi>200</span><span class=no>h</span>
                  <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>0</span><span class=p>*</span><span class=mi>4</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=mi>0</span>

                  <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
                  <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
              <span class=nl>do0:</span>
                  <span class=nf>jmp</span> <span class=no>short</span> <span class=no>do0start</span>
                  <span class=nf>db</span><span class=err>&#34;</span><span class=no>welcome</span> <span class=no>to</span> <span class=no>masm</span><span class=p>!</span><span class=err>&#34;</span><span class=c>;在代码段中存储数据
</span><span class=c></span>              <span class=no>do0start</span><span class=p>:</span>
                  <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>cs</span>
                  <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
                  <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>202</span><span class=no>h</span><span class=c>;jmp short do0start这条指令栈两个字节
</span><span class=c></span>                  <span class=c>;显示字符串，设置es:di指向字符串
</span><span class=c></span>                  <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>b800h</span><span class=c>;显存空间，直接显示在显示器上
</span><span class=c></span>                  <span class=no>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
                  <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>12</span><span class=p>*</span><span class=mi>160</span><span class=err>+</span><span class=mi>36</span><span class=p>*</span><span class=mi>2</span><span class=c>;这只es:di指向显存空间的中间位置
</span><span class=c></span>                  <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>16</span><span class=c>;设置cx为字符串(welcome to masm！)长度
</span><span class=c></span>              <span class=no>s</span><span class=p>:</span>
                  <span class=nf>mov</span> <span class=no>al</span><span class=p>,[</span><span class=no>si</span><span class=p>]</span>
                  <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=p>],</span><span class=no>al</span>
                  <span class=nf>inc</span> <span class=no>si</span>
                  <span class=nf>add</span> <span class=no>di</span><span class=p>,</span><span class=mi>1</span>
                  <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>02</span><span class=no>h</span>
                  <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=no>di</span><span class=p>],</span><span class=no>al</span>
                  <span class=nf>add</span> <span class=no>di</span><span class=p>,</span><span class=mi>1</span>
                  <span class=nf>loop</span> <span class=no>s</span>

                  <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
                  <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
              <span class=nl>do0end:</span>
                  <span class=nf>nop</span>

          <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-0a7f4b12ca469744?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>do0</p>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-372a3cfef110daa7?imageMogr2/auto-orient/strip%7CimageView2/2/w/654/format/webp alt></p>
<p>do02</p>
<h2 id=128-单步中断>12.8 单步中断</h2>
<ul>
<li>CPU执行完一条指令之后，如果检测到标志寄存器的TF位为1，则产生单步中断引发中断过程。单步中断的中断类型码为1，它所引发的中断过程如下：
<ul>
<li>1、取得中断类型码；</li>
<li>2、标志寄存器入栈，TF、IF设置为0；</li>
<li>3、CS、IP入栈；</li>
<li>4、指向指定类型码的中断向量表。</li>
</ul>
</li>
</ul>
<h2 id=129-响应中断的特殊情况>12.9 响应中断的特殊情况</h2>
<ul>
<li>在有些情况下CPU在执行完当前指令后，即便是发生了中断也不会响应。</li>
</ul>
<blockquote>
<p>在执行完向ss寄存器传送数据的指令后，即便检测到了中断信号CPU也不会响应。因为ss:sp指向栈顶，对他们的设置应该连续完成。如果在执行完设置ss指令后mCPU响应中断引发中断过程，要在栈中压入标志寄存器、CS和IP的值。而ss改变，sp并未改变则ss:sp指向不是正确的栈顶将引发错误。</p>
</blockquote>
<ul>
<li>我们要将栈顶设置为1000:0，不应该隔开</li>
</ul>
<table>
<thead>
<tr>
<th>应该</th>
<th>不应该</th>
</tr>
</thead>
<tbody>
<tr>
<td>mov ax,1000h</td>
<td>mov ax,1000h</td>
</tr>
<tr>
<td>mov ss,ax</td>
<td>mov ss,ax</td>
</tr>
<tr>
<td>mov sp,0</td>
<td>mov ax,0</td>
</tr>
<tr>
<td>mov ax,0</td>
<td>mov sp,0</td>
</tr>
</tbody>
</table>
<h1 id=十三int-指令>十三、int 指令</h1>
<h2 id=引言-7>引言</h2>
<ul>
<li>在第12章中了解中断过程和除法错误中断和单步中断的处理，这章了解int指令。</li>
</ul>
<h2 id=131-int-指令>13.1 int 指令</h2>
<ul>
<li>
<p>int格式：int n，n为中断类型码，它的功能是引发中断过程。CPU执行int n之力量能够，相当引发一个n号的中断过程，可以在程序中使用int指令调用任何一个中断的中断处理程序。执行过程如下：</p>
<ul>
<li>中断过程从，此处去执行n号中断的中断处理程序。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>code</span> <span class=no>segment</span>

    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>b800h</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>12</span><span class=p>*</span><span class=mi>160</span><span class=err>+</span><span class=mi>40</span><span class=p>*</span><span class=mi>2</span><span class=p>],</span><span class=err>&#39;</span><span class=p>!</span><span class=err>&#39;</span>

            <span class=nf>int</span> <span class=mi>0</span><span class=c>;执行int 0指令，引发中断过程，执行0号中断处理程序
</span><span class=c></span>    <span class=no>code</span> <span class=no>ends</span>
 <span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-5f5e62dc453468ef?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>131dosbox</p>
<p>​</p>
</li>
<li>
<p>int指令的最终功能和call类似，都是调用一段程序。一般情况下系统将一些具有一定功能的子程序以中断处理程序的方式提供给应用程序调用，也可以自己编写一些中断处理程序供别人使用。</p>
</li>
</ul>
<h2 id=132-编写供应用程序调用的中断例程>13.2 编写供应用程序调用的中断例程</h2>
<ul>
<li>中断处理程序简称为中断例程。</li>
<li>实例1：编写、安装中断7ch的中断例程实现求一word型数据的平方。
<ul>
<li>1、编程实现求平方功能的程序；</li>
<li>2、安装程序在0:200处；</li>
<li>3、设置中断向量表将程序的入口地址保存在7ch表项中，使其成为中断7ch的中断例程。</li>
</ul>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>             <span class=c>;计算
</span><span class=c></span><span class=nf>ssume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
             <span class=nf>code</span> <span class=no>segment</span>
             <span class=nl>start:</span>
                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>3456</span>
                     <span class=nf>int</span> <span class=mi>7</span><span class=no>ch</span>
                     <span class=nf>add</span> <span class=no>ax</span><span class=p>,</span><span class=no>ax</span>
                     <span class=nf>adc</span> <span class=no>ax</span><span class=p>,</span><span class=no>dx</span>
                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
                     <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
             <span class=nf>code</span> <span class=no>ends</span>
             <span class=nf>end</span> <span class=no>start</span>



             <span class=c>;安装程序
</span><span class=c></span>             <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
             <span class=nf>code</span> <span class=no>segment</span>
             <span class=nl>start:</span>
                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>cs</span>
                     <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
                     <span class=nf>mov</span> <span class=no>si</span> <span class=no>offset</span> <span class=no>sqr</span><span class=c>;设置ds:si指向源地址
</span><span class=c></span>                     <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
                     <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
                     <span class=nf>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>200</span><span class=no>h</span><span class=c>;设置es:di指向目的地址
</span><span class=c></span>                     <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=no>offset</span> <span class=no>sqrend-</span> <span class=no>offset</span> <span class=no>sqr</span><span class=c>;设置cx为传输长度
</span><span class=c></span>                     <span class=no>cld</span><span class=c>;设置传输方向为正
</span><span class=c></span>                     <span class=no>rep</span> <span class=no>movsb</span>

                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
                     <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
                     <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>7</span><span class=no>ch</span><span class=p>*</span><span class=mi>4</span><span class=p>],</span><span class=mi>200</span><span class=no>h</span>
                     <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>ws</span><span class=p>:[</span><span class=mi>7</span><span class=no>ch</span><span class=p>*</span><span class=mi>4</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=mi>0</span>
                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
                     <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
                 <span class=nl>sqr:</span>
                     <span class=nf>mul</span> <span class=no>ax</span>
                     <span class=nf>iret</span>
                 <span class=nl>sqrend:</span>
                     <span class=nf>nop</span>
             <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>CPU执行int 7ch指令进入中断例程之前，标志寄存器、当前的CS和IP都被压入栈中，在执行完中断例程后，用iret指令恢复int 7ch执行前的标志寄存器和CS和IP的值，从而接着执行应用程序。</li>
<li><strong>int指令和iret指令配合使用与call指令和ret指令配合使用具有相似的思路。</strong></li>
<li>实例2：编写、安装中断7ch的中断例程，实现将一个全是字母，以0为结尾的字符串转化为大写。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
             <span class=nf>data</span> <span class=no>segment</span>
                     <span class=nf>db</span><span class=err>&#39;</span><span class=no>conversation</span><span class=err>&#39;</span><span class=p>,</span><span class=mi>0</span>
             <span class=nf>data</span> <span class=no>ends</span>

             <span class=nf>code</span> <span class=no>segment</span>
             <span class=nl>start:</span>
                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
                     <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
                     <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
                     <span class=nf>int</span> <span class=mi>7</span><span class=no>ch</span>
                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
                     <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
             <span class=nf>code</span> <span class=no>ends</span> 
             <span class=no>end</span> <span class=no>start</span>






             <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
             <span class=nf>code</span> <span class=no>segment</span>

             <span class=nl>start:</span>
                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>cs</span>
                     <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
                     <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=no>offset</span> <span class=no>capital</span>
                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
                     <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
                     <span class=nf>mov</span> <span class=no>di</span> <span class=mi>200</span><span class=no>h</span>
                     <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=no>offset</span> <span class=no>capitalend</span> <span class=p>-</span> <span class=no>offset</span> <span class=no>capital</span>
                     <span class=nf>cld</span>
                     <span class=na>rep</span> <span class=nf>movsb</span>

                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
                     <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
                     <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>7</span><span class=no>ch</span><span class=p>*</span><span class=mi>4</span><span class=p>],</span><span class=mi>200</span><span class=no>h</span>
                     <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>7</span><span class=no>ch</span><span class=p>*</span><span class=mi>4</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=mi>0</span>

                     <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
                     <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

                 <span class=nl>capital:</span>
                     <span class=nf>push</span> <span class=no>cx</span>
                     <span class=nf>push</span> <span class=no>si</span>
                 <span class=nl>change:</span>
                     <span class=nf>mov</span> <span class=no>cl</span><span class=p>,[</span><span class=no>si</span><span class=p>]</span>
                     <span class=nf>mov</span> <span class=no>ch</span><span class=p>,</span><span class=mi>0</span>
                     <span class=nf>jcxz</span> <span class=no>ok</span>
                     <span class=nf>and</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>si</span><span class=p>],</span><span class=mi>11011111</span><span class=no>b</span>
                     <span class=nf>inc</span> <span class=no>si</span>
                     <span class=nf>jmp</span> <span class=no>short</span> <span class=no>change</span>
                 <span class=nl>ok:</span>
                     <span class=nf>pop</span> <span class=no>si</span>
                     <span class=nf>pop</span> <span class=no>cx</span>
                     <span class=nf>iret</span>

                 <span class=nl>capitalend:</span>
                     <span class=nf>nop</span>
             <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>要注意用到的寄存器冲突。</li>
</ul>
<h2 id=133-对intiret和栈的深入理解>13.3 对int、iret和栈的深入理解</h2>
<ul>
<li>中断处理程序和iret指令</li>
<li>编程：用7ch中断例程完成loop指令的功能，在屏幕中间显示80个"!".</li>
</ul>
<blockquote>
<p>loop指令需要循环次数和到标号的位移。为了模拟loop指令7ch中断例程应具备下面dec cx和如果cx的值不等于0则转移到标号s处。</p>
</blockquote>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=p>-</span> <span class=kt>int</span> <span class=m>7</span><span class=n>ch引发中断过程后</span><span class=err>，进入</span><span class=m>7</span><span class=n>ch中断例程在中断过程中当前的标志寄存器</span><span class=err>、</span><span class=n>CS和IP都要压栈</span><span class=err>。此时压入的</span><span class=n>CS和IP中的内容分别是调用程序的段地址</span><span class=p>(</span><span class=err>可以认为是标号</span><span class=n>s的段地址</span><span class=p>)</span><span class=err>和</span><span class=kt>int</span> <span class=m>7</span><span class=n>ch后一条指令的偏移地址</span><span class=p>(</span><span class=err>即标号</span><span class=n>se的偏移地址</span><span class=p>)</span><span class=err>。使用</span><span class=n>iret指令用栈中的内容设置CS</span><span class=err>、</span><span class=n>IP</span><span class=err>，从而实现转移到标号</span><span class=n>s处</span><span class=err>。</span>

<span class=err>```</span><span class=n>asm</span>
<span class=n>assume</span> <span class=n>cs</span><span class=p>:</span><span class=n>code</span>

    <span class=n>code</span> <span class=n>segment</span>
    <span class=n>start</span><span class=p>:</span>
            <span class=n>mov</span> <span class=n>ax</span><span class=p>,</span><span class=m>0</span><span class=n>b800h</span><span class=p>;</span><span class=err>显存地址</span>
            <span class=n>mov</span> <span class=n>es</span><span class=p>,</span><span class=n>ax</span>
            <span class=n>mov</span> <span class=n>di</span><span class=p>,</span><span class=m>160</span><span class=p>*</span><span class=m>12</span>
            <span class=n>mov</span> <span class=n>bx</span><span class=p>,</span><span class=n>offset</span> <span class=n>s</span><span class=p>-</span> <span class=n>offset</span> <span class=n>se</span><span class=p>;</span><span class=err>设置从标号</span><span class=n>s的转移位移</span>
            <span class=n>mov</span> <span class=n>cx</span><span class=p>,</span><span class=m>80</span>
        <span class=n>s</span><span class=p>:</span>
            <span class=n>mov</span> <span class=kt>byte</span> <span class=n>ptr</span> <span class=n>es</span><span class=p>:[</span><span class=n>di</span><span class=p>],</span><span class=sc>&#39;!&#39;</span>
            <span class=k>add</span> <span class=n>di</span><span class=p>,</span><span class=m>2</span>
            <span class=kt>int</span> <span class=m>7</span><span class=n>ch</span><span class=p>;</span><span class=err>如果</span><span class=n>cx的值不等于0则转移到标号s处</span>
        <span class=n>se</span><span class=p>:</span>
            <span class=n>nop</span>

            <span class=n>mov</span> <span class=n>ax</span><span class=p>,</span><span class=m>4</span><span class=n>c00h</span>
            <span class=kt>int</span> <span class=m>21</span><span class=n>h</span>
<span class=n>code</span> <span class=n>ends</span>
<span class=n>end</span> <span class=n>start</span>




    <span class=p>;</span><span class=m>7</span><span class=n>ch中断例程</span>
        <span class=n>lp</span><span class=p>:</span>
            <span class=n>push</span> <span class=n>bp</span>
            <span class=n>mov</span> <span class=n>bp</span><span class=p>,</span><span class=n>sp</span><span class=p>;</span>
            <span class=n>dec</span> <span class=n>cx</span>
            <span class=n>jcxz</span> <span class=n>lpret</span>
            <span class=k>add</span> <span class=p>[</span><span class=n>bp</span><span class=p>+</span><span class=m>2</span><span class=p>],</span><span class=n>bx</span>
        <span class=n>lpret</span><span class=p>:</span>
            <span class=n>pop</span> <span class=n>bp</span>
            <span class=n>iret</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>## 13.4 BIOD和DOS所提供的中断例程

- bios中主要包含以下几部分内容：
  - 1、硬件操作系统的检测和初始化程序；
  - 2、外部中断和内部中断的中断例程；
  - 3、用于对硬件设备进行I\O操作的中断例程；
  - 4、其他和硬件系统相关的中断例程。
- bios和dos在所提供的中断例程中包含了许多子程序，可以用int指令直接调用。和硬件设备相关的dos中断例程中一般都调用了bios的中断例程

## 13.5 bios和dos中断例程的安装过程

- 1、开机后8086CPU一加电初始化CS和IP，自动执行FFFF:0处指令，转去执行bios中的硬件系统检测和初始化程序。
- 2、初始化程序将建立bios所支持的中断向量，即将biso提供的中断例程的入口地址登记在中断向量表中。
- 3、硬件系统检测和初始化完成后，调用int 19h进行操作系统的引导。从此将计算机交由操作系统控制。
- 4、dos启动后除完成其他工作外，还将它所提供的中断例程装入内存并建立相应的中断向量。

## 13.6 bios中断例程应用

- bios和dos提供的中断例程douyongah来传递内部子程序的编号。
- int 10h中断例程是bios提供的中断例程，其中包含了多个和屏幕输出相关的子程序。int 10h中断例程的设置光标位置功能：

```asm
    mov ah,2;表示调用10h号中断例程的2号子程序，功能为设置光标位置
    mov bh,0;页号
    mov dh,5;行号
    mov dl 12;列号
    int 10h;
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;功能为在光标位置显示字符功能
</span><span class=c></span><span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=mi>9</span><span class=c>;置光标，调用9号子程序
</span><span class=c></span><span class=no>mov</span> <span class=no>al</span><span class=p>,</span><span class=err>&#39;</span><span class=no>a</span><span class=err>&#39;</span><span class=c>;字符
</span><span class=c></span><span class=no>mov</span> <span class=no>bl</span><span class=p>,</span><span class=mi>7</span><span class=c>;颜色属性，和在显存中的属性字节的格式相同
</span><span class=c></span><span class=no>mov</span> <span class=no>bh</span><span class=p>,</span><span class=mi>0</span><span class=c>;第0页
</span><span class=c></span><span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>3</span><span class=c>;字符重复个数
</span><span class=c></span><span class=no>int</span> <span class=mi>10</span><span class=no>h</span>
<span class=err>​```</span>
<span class=err>-</span> <span class=err>编程：在屏幕的第5行12列显示3个红底高亮闪烁绿色的&#39;</span><span class=nf>a</span><span class=err>&#39;</span>
<span class=err>​```</span><span class=nf>asm</span>
    <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>code</span> <span class=no>segment</span>
            <span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=mi>2</span><span class=c>;设置光标
</span><span class=c></span>            <span class=no>mov</span> <span class=no>bh</span><span class=p>,</span><span class=mi>0</span><span class=c>;第0页
</span><span class=c></span>            <span class=no>mov</span> <span class=no>dh</span><span class=p>,</span><span class=mi>5</span><span class=c>;dh中放行号
</span><span class=c></span>            <span class=no>mov</span> <span class=no>dl</span><span class=p>,</span><span class=mi>12</span><span class=c>;dl中放列号
</span><span class=c></span>            <span class=no>int</span> <span class=mi>10</span>

            <span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=mi>9</span><span class=c>;设置光标
</span><span class=c></span>            <span class=no>mov</span> <span class=no>al</span><span class=p>,</span><span class=err>&#39;</span><span class=no>a</span><span class=err>&#39;</span><span class=c>;字符
</span><span class=c></span>            <span class=no>mov</span> <span class=no>bl</span><span class=p>,</span><span class=mi>11001010</span><span class=no>b</span><span class=c>;颜色属性
</span><span class=c></span>            <span class=no>mov</span> <span class=no>bh</span><span class=p>,</span><span class=mi>0</span><span class=c>;第0页
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>3</span><span class=c>;字符重复个数
</span><span class=c></span>            <span class=no>int</span> <span class=mi>10</span><span class=no>h</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
    <span class=nf>end</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-51f0b4f968259aec?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>136</p>
<h2 id=137-dos中断例程应用>13.7 dos中断例程应用</h2>
<ul>
<li>int 21h 中断例程</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>          <span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=mi>4</span><span class=no>ch</span><span class=c>;程序返回
</span><span class=c></span>          <span class=no>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>0</span><span class=c>;返回值0是正常返回
</span><span class=c></span>          <span class=c>;合起来写就是 mov ax,4c00h
</span><span class=c></span>          <span class=no>int</span> <span class=mi>21</span><span class=no>h</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>int 2h中断例程还具有在光标位置显示字符串的功能、</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>      <span class=nl>ds:</span><span class=nf>dx</span><span class=c>;要显示的字符串需要用 $ 作为结束符
</span><span class=c></span>      <span class=no>mov</span> <span class=no>ah</span><span class=p>,</span><span class=mi>9</span><span class=c>;功能号9，表示在光标位置显示字符串
</span><span class=c></span>      <span class=no>int</span> <span class=mi>21</span><span class=no>h</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h1 id=十四端口>十四、端口</h1>
<h2 id=引言-8>引言</h2>
<ul>
<li>CPU可以直接读写3个地方的数据：
<ul>
<li>1、CPU内部的寄存器；</li>
<li>2、内存单元；</li>
<li>3、 端口。</li>
</ul>
</li>
</ul>
<h2 id=141-端口的读写>14.1 端口的读写</h2>
<ul>
<li><strong>mov、push、pop等死内存读写指令。in和out是端口读指令写指令时in是从端口读取数据，out是往端口写入数据。in和out指令只能用ax或al来存放从端口中读入的数据或要发送到端口中的数据，访问8位短空时用al，访问16位端口时用ax。</strong>
<ul>
<li>访问内存：
<ul>
<li>mov ax,ds:[8+0];假设(ds)=0</li>
<li>执行时，与总线相关的操作：
<ul>
<li>1、CPU通过地址线信息8发出；</li>
<li>2、CPU通过控制线发出内存读命令，选中存储器芯片并通知它将要从中读取数据；</li>
<li>3、 存储器将8号单元中的数据通过数据线送入CPU。</li>
</ul>
</li>
</ul>
</li>
<li>访问端口：
<ul>
<li>in al,60h;从60h号端口读入一个字节。</li>
<li>执行时与总线相关的操作：
<ul>
<li>1、CPU通过地址线将地址信息60h发出；</li>
<li>2、CPU通过控制线发出端口读命令，选中端口所在的芯片，并通知它，将要从中读取数据；</li>
<li>3、端口所在的芯片将60h端口中的数据通过数据线送入CPU。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=c>;对0~255以内的端口进行读写
</span><span class=c></span><span class=nf>in</span> <span class=no>al</span><span class=p>,</span><span class=mi>20</span><span class=no>h</span><span class=c>;从20h端口读入一个字节
</span><span class=c></span><span class=no>out</span> <span class=mi>20</span><span class=no>h</span><span class=p>,</span><span class=no>al</span><span class=c>;往20h端口写入一个字节
</span><span class=c>;对256~65535的端口进行读写时，端口放在dx中
</span><span class=c></span><span class=no>mov</span> <span class=no>dx</span><span class=p>,</span><span class=mi>3</span><span class=no>f8h</span><span class=c>;将端口号3f8h送入dx
</span><span class=c></span><span class=no>in</span> <span class=no>al</span><span class=p>,</span><span class=no>dx</span><span class=c>;从3f8端口读入一个字节
</span><span class=c></span><span class=no>out</span> <span class=mi>3</span><span class=no>f8h</span><span class=p>,</span><span class=no>al</span><span class=c>;往3f8h端口写入一个字节
</span></code></pre></td></tr></table>
</div>
</div><h2 id=142-cmos-ram芯片>14.2 CMOS RAM芯片</h2>
<ul>
<li>
<p>CMOA RAM特征：</p>
<ul>
<li>
<p>1、包含一个实时钟和一个有128个存储单元的RAM存储器。(早期的计算机位64个字节)。</p>
</li>
<li>
<p>2、该芯片靠电池供电。因此关机后其内部的实时钟仍可正常工作，RAM中的信息不会丢失。</p>
</li>
<li>
<p>3、128个字节的RAM，内部实时钟占用0~0dh单元来保存时间信息默契与大部分单元用于保存系统配置信息，供系统启动时bios程序读取。</p>
</li>
<li>
<blockquote>
<p>bios也提供了相关的程序使用户在开机时配置CMOS RAM中的系统信息。</p>
</blockquote>
</li>
<li>
<p>4、该芯片内部有两个端口，端口地址为70h和71<br>
h。CPU通过这两个端口读写CMOS RAM。</p>
</li>
<li>
<p>5、70h为地址端口，存放要访问的CMOS RAM单元的地址;71h为数据端口，存放从选定的CMOS RAM单元中读取的数据，或要写入到其中的数据。</p>
</li>
</ul>
</li>
<li>
<p>CPU对CMOS RAM的读写分两步进行，以读2号单元为例：</p>
<ul>
<li>1、将2送入端口70h；</li>
<li>2、从71h读出2号单元的内容。</li>
</ul>
</li>
</ul>
<h2 id=143-shl和shr指令>14.3 shl和shr指令</h2>
<ul>
<li>shl为逻辑左移指令功能为：
<ul>
<li>1、将一个寄存器或内存单元中的数据向左移位；</li>
<li>2、将<strong>最后移出</strong>的一位写入CF中；</li>
<li>3、最低位用0补充。</li>
</ul>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>          <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>01001000</span><span class=no>b</span>
          <span class=nf>shl</span> <span class=no>al</span><span class=p>,</span><span class=mi>1</span><span class=c>;将al中的数据左移一位
</span><span class=c></span>          <span class=c>;执行后al的值是10010000b，CF=0
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>如果移动位数大于1时，必须将移动位数放在cl中。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>          <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>01010001</span><span class=no>b</span>
          <span class=nf>mov</span> <span class=no>cl</span><span class=p>,</span><span class=mi>3</span>
          <span class=nf>shl</span> <span class=no>al</span><span class=p>,</span><span class=no>cl</span>
          <span class=c>;执行后al的值为10001000b，cf=0
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>二进制逻辑左移一位，相当于执行x=x*2(2是进制位)</li>
</ul>
<table>
<thead>
<tr>
<th>mov al,00000001b</th>
<th>执行后al的值等于00000001b=1</th>
</tr>
</thead>
<tbody>
<tr>
<td>shl al,1</td>
<td>执行后al的值等于00000010b=2</td>
</tr>
<tr>
<td>shl al,1</td>
<td>执行后al的值等于00000100b=4</td>
</tr>
<tr>
<td>shl al,1</td>
<td>执行后al的值等于00001000b=8</td>
</tr>
<tr>
<td>mov cl,3</td>
<td></td>
</tr>
<tr>
<td>shl al,cl</td>
<td>执行后al的值等于01000000b=64</td>
</tr>
</tbody>
</table>
<ul>
<li>shr为逻辑左移指令功能为：
<ul>
<li>1、将一个寄存器或内存单元中的数据向右移位；</li>
<li>2、将<strong>最后移出</strong>的一位写入CF中；</li>
<li>3、最高位用0补充。</li>
</ul>
</li>
<li>二进制逻辑右移一位，相当于执行x=x/2(2是进制位)</li>
</ul>
<h2 id=144-cmosram中存储的时间信息>14.4 CMOS　RAM中存储的时间信息</h2>
<ul>
<li>
<p>在CMOS RAM中以每个信息一字节存放着当前的时间信息：年09h，月08h，日07h，时04h，分02h，秒00h。这些数据以BCD码的方式存放，BCD码以4位为一位。</p>
</li>
<li>
<p>数值26BCD码表示为0010 0110，用两个BCD码表示两位十进制，高4位表示十位，低4位表示各位。</p>
</li>
<li>
<p>编程：在屏幕中间显示当前的月份。</p>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=c>;向地址端口70h写入要访问的单元地址，读取CMOS RAM的信息
</span><span class=c></span>            <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>8</span>
            <span class=nf>out</span> <span class=mi>70</span><span class=no>h</span><span class=p>,</span><span class=no>al</span>
            <span class=nf>in</span> <span class=no>al</span><span class=p>,</span><span class=mi>71</span><span class=no>h</span><span class=c>;从数据端口中取得指定单元中的数据
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ah</span><span class=p>,</span><span class=no>al</span><span class=c>;al中为从CMOS RAM的8号端口读出数据
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cl</span><span class=p>,</span><span class=mi>4</span>
            <span class=nf>shr</span> <span class=no>ah</span><span class=p>,</span><span class=no>cl</span><span class=c>;ah中为月份的十位数码值
</span><span class=c></span>            <span class=no>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>00001111</span><span class=no>b</span><span class=c>;ah中为月份的个位数值码
</span><span class=c></span>            <span class=no>add</span> <span class=no>ah</span><span class=p>,</span><span class=mi>30</span><span class=no>h</span><span class=c>;BCD码值+30h(字符&#39;0&#39;)=十进制对应的ASCII码
</span><span class=c></span>            <span class=no>add</span> <span class=no>al</span><span class=p>,</span><span class=mi>30</span><span class=no>h</span>
            <span class=c>;用BCD码表示的月份以十进制的形式显示到屏幕上。
</span><span class=c></span>            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=no>b800h</span><span class=c>;显存
</span><span class=c></span>            <span class=no>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>bx</span>
            <span class=nf>mov</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>160</span><span class=p>*</span><span class=mi>12</span><span class=err>+</span><span class=mi>40</span><span class=p>*</span><span class=mi>2</span><span class=p>],</span><span class=no>ah</span><span class=c>;显示月份的十位数码
</span><span class=c></span>            <span class=no>mov</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>160</span><span class=p>*</span><span class=mi>12</span><span class=err>+</span><span class=mi>40</span><span class=p>*</span><span class=mi>2</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=no>al</span><span class=c>;显示月份的个位数码
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

    <span class=nf>code</span> <span class=no>ends</span>
    <span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><p><img src=https://upload-images.jianshu.io/upload_images/1968661-0b7fb2ed2e7270a6?imageMogr2/auto-orient/strip%7CimageView2/2/w/642/format/webp alt></p>
<p>144_1</p>
<h1 id=十五外中断>十五、外中断</h1>
<h2 id=151接口芯片和端口>15.1接口芯片和端口</h2>
<ul>
<li>CPU通过端口和外设进行联系。在PC系统的接口卡和主板上，装有各种接口芯片。这些外设接口芯片的内部有若干寄存器，CCPU将这些寄存器当作端口来访问。外设的输入不直接送入内存和CPU，而是送入相关的接口芯片的端口中；CPU向外设的输出也不是直接送入到外设而是先送入端口再由相关的芯片送到外设。</li>
</ul>
<h2 id=152外中断信息>15.2外中断信息</h2>
<ul>
<li>
<p>外中断源有两类：</p>
<ul>
<li>1、可屏蔽中断；
<ul>
<li>可屏蔽中断时CPU可以不响应的外中断。CPU是否响应可屏蔽中断要看标志寄存器的IF位的设置。</li>
</ul>
</li>
<li>2、不可屏蔽中断</li>
</ul>
</li>
<li>
<p>当CPU检测到可屏蔽中断信息时：</p>
<ul>
<li>如果IF=1，则CPU在执行完当前指令后响应中断引发中断过程。</li>
<li>如果IF=0，着不响应可屏蔽中断。</li>
<li><a href=https://www.jianshu.com/p/f7434bb2ce09#12420e4b8ade696ade8bf87e7a88b_139>内中断过程</a></li>
</ul>
</li>
<li>
<blockquote>
<p>可屏蔽中断所引发的中断过程，除在第一步的实现上有所不同外，基本上和内中断的中断过程相同。因为可屏蔽中断信息来自于CPU外部，中断类型码是通过数据总线送入CPU的；而内中断的中断类型码是在CPU内部产生的。在中断过程中将IF置0的原因是在进入中断处理程序后禁止其他的可屏蔽中断。</p>
</blockquote>
</li>
<li>
<p>8086CPU提供的设置IF的指令如下：</p>
<ul>
<li>sti，设置IF=1；</li>
<li>cli，设置if=0.</li>
</ul>
</li>
<li>
<p>不可屏蔽中断是CPU必须响应的外中断。当CPU检测到不可屏蔽中断信息时，则在执行完当前指令后立即响应引发中断过程。对于8086CPU不可屏蔽的中断类型码固定为2。所以中断过程中不需要取中断类型码。几乎所有外设引发的外中断都是可屏蔽中断。</p>
</li>
<li>
<p>不可屏蔽中断过程：</p>
<ul>
<li>1、标志寄存器入栈，IF=0，TF=0’</li>
<li>2、CS和IP入栈；</li>
<li>3、(IP)=(8)，(CS)=(0AH)</li>
</ul>
</li>
</ul>
<h2 id=153pc机及键盘的处理过程>15.3PC机及键盘的处理过程</h2>
<ul>
<li>
<p>键盘输入的处理过程：</p>
<ul>
<li>1、键盘输入产生扫描码；</li>
<li>2、扫描码送入60h端口；</li>
<li>3、引发9号中断；</li>
<li>4、执行int 9中断例程。</li>
<li>
<blockquote>
<p>前三步由硬件系统自动完成，第四步用户可以修改int 9中断程序。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>按下一个键产生的扫描码称为通码，松开一个键产生的扫描码称为断码。扫描码被送入主板上的相关接口芯片端口地址为60h的寄存器中。</p>
</li>
<li>
<p>扫描码长度为一个字节，通码的第7位为0，断码的第7位为1。即断码=通码+80h。</p>
</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-16a6a9fab3b09a6e?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp alt></p>
<p>键盘上部分键的扫描码</p>
<ul>
<li>bios提供了int 9中断例程，用来进行基本键盘输入处理，主要的工作如下：
<ul>
<li>1、读出60h端口中的扫描码；</li>
<li>2、如果是字符键的扫描码就将它和它所对应的字符码(ASCII码)送入内存中的bios键盘缓冲区；
<ul>
<li>键盘的输入到达60h端口时相关的芯片就会向CPU发出中断类型码为9的可屏蔽中断信息。</li>
<li>CPU检测到该中断信息后，如果IF=1，则相应中断，引发中断过程，转去执行int 9中断例程。</li>
<li>如果是控制键(如ctrl)和切换键(如capslock)的扫描码，则将其转变为状态字节(用为进制位记录控制键和切换键状态的字节)写入内存中存储状态字节的单元</li>
</ul>
</li>
<li>3、键盘系统进行相关的控制。如向相关芯片发出应答信息。</li>
</ul>
</li>
<li>bios键盘缓冲区是系统启动后mbios用于存放int 9中断例程所接收的键盘输入的内存区。该内存可以存储15个键盘输入，在bios键盘缓冲区中一个键盘输入用一个字单元存放，高位字节存放扫描码，低位字节存放字符码。0040:17单元存储键盘状态字节该字节记录了控制键和切换键的状态
<ul>
<li>0:置1表表示按下右shift键</li>
<li>1:置1表表示按下左shift键</li>
<li>2:置1表表示按下ctrl</li>
<li>3:置1表表示按下alt</li>
<li>4:置1表表示按下scroll指示灯亮</li>
<li>5:置1表表示按下numlock，小键盘输入的是数字</li>
<li>6:置1表表示按下capslock，输入大写字母</li>
<li>7:置1表表示按下insert。处于删除状态</li>
</ul>
</li>
</ul>
<h2 id=154编写int-9中断>15.4编写int 9中断</h2>
<ul>
<li>键盘输入的处理过程</li>
<li>编程：在屏幕中间依次显示让人看清的a~z，按下esc键后改变显示的颜色。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;显示字符
</span><span class=c></span><span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>b800h</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=err>&#39;</span><span class=no>a</span><span class=err>&#39;</span>
        <span class=nl>s:</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=mi>160</span><span class=p>*</span><span class=mi>12</span><span class=err>+</span><span class=mi>40</span><span class=p>*</span><span class=mi>2</span><span class=p>],</span><span class=no>ah</span>
            <span class=nf>inc</span> <span class=no>ax</span>
            <span class=nf>cmp</span> <span class=no>ah</span><span class=p>,</span><span class=err>&#39;</span><span class=no>z</span><span class=err>&#39;</span>
            <span class=nf>jna</span> <span class=no>s</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div></br>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;延迟显示字符
</span><span class=c></span>
<span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
    <span class=nf>stack</span> <span class=no>segment</span>
            <span class=nf>db</span> <span class=mi>128</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=nf>stack</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stack</span>
            <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>128</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>b800h</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=err>&#39;</span><span class=no>a</span><span class=err>&#39;</span>
        <span class=nl>s:</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=mi>160</span><span class=p>*</span><span class=mi>12</span><span class=err>+</span><span class=mi>40</span><span class=p>*</span><span class=mi>2</span><span class=p>],</span><span class=no>ah</span>
            <span class=nf>call</span> <span class=no>delay</span>
            <span class=nf>inc</span> <span class=no>ah</span>
            <span class=nf>cmp</span> <span class=no>ah</span><span class=p>,</span><span class=err>&#39;</span><span class=no>z</span><span class=err>&#39;</span>
            <span class=nf>jna</span> <span class=no>s</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

        <span class=nl>delay:</span>
            <span class=nf>push</span> <span class=no>ax</span>
            <span class=nf>push</span> <span class=no>dx</span>
            <span class=nf>mov</span> <span class=no>dx</span><span class=p>,</span><span class=mi>10</span><span class=no>h</span><span class=c>;循环100次，延迟的时间和CPU的计算能力成反比
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
        <span class=nl>s1:</span>
            <span class=nf>sub</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>
            <span class=nf>sbb</span> <span class=no>dx</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>cmp</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>jne</span> <span class=no>s1</span>
            <span class=nf>cmp</span> <span class=no>dx</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>jne</span> <span class=no>s1</span>
            <span class=nf>pop</span> <span class=no>dx</span>
            <span class=nf>pop</span> <span class=no>ax</span>
            <span class=nf>ret</span>
    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div></br>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>    <span class=c>;实现IF=0，TF=0步骤
</span><span class=c></span>    <span class=nf>pushf</span>
    <span class=nf>pop</span> <span class=no>ax</span>
    <span class=nf>and</span> <span class=no>ah</span><span class=p>,</span><span class=mi>11111100</span><span class=no>b</span>
    <span class=nf>push</span> <span class=no>ax</span>
    <span class=nf>popf</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>int指令在执行时CPU进行的工作</li>
<li>完整程序</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span><span class=lnt>97
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>stack</span> <span class=no>segment</span>
            <span class=nf>db</span> <span class=mi>128</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=nf>stack</span> <span class=no>ends</span>

    <span class=nf>data</span> <span class=no>segment</span>
            <span class=nf>dw</span> <span class=mi>0</span><span class=p>,</span><span class=mi>0</span>
    <span class=nf>data</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stack</span>
            <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>128</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
            <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>

            <span class=nf>push</span> <span class=no>es</span><span class=p>:[</span><span class=mi>9</span><span class=p>*</span><span class=mi>4</span><span class=p>]</span>
            <span class=nf>pop</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>
            <span class=nf>push</span> <span class=no>es</span><span class=p>:[</span><span class=mi>9</span><span class=p>*</span><span class=mi>4</span><span class=err>+</span><span class=mi>2</span><span class=p>]</span>
            <span class=nf>pop</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>2</span><span class=p>]</span><span class=c>;将原来的int9中断例程的入口地址保存
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>9</span><span class=p>*</span><span class=mi>4</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=no>offset</span> <span class=no>int9</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=mi>9</span><span class=p>*</span><span class=mi>4</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=no>cs</span><span class=c>;在中断向量表中设置新的int 9中断例程的入口地址
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>b800h</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=err>&#39;</span><span class=no>a</span><span class=err>&#39;</span>

        <span class=nl>s:</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=mi>160</span><span class=p>*</span><span class=mi>12</span><span class=err>+</span><span class=mi>40</span><span class=p>*</span><span class=mi>2</span><span class=p>],</span><span class=no>ah</span>
            <span class=nf>call</span> <span class=no>delay</span>
            <span class=nf>inc</span> <span class=no>ah</span>
            <span class=nf>cmp</span> <span class=no>ah</span><span class=p>,</span><span class=err>&#39;</span><span class=no>z</span><span class=err>&#39;</span>
            <span class=nf>jna</span> <span class=no>s</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>

            <span class=nf>push</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span>
            <span class=nf>pop</span> <span class=no>es</span><span class=p>:[</span><span class=mi>9</span><span class=p>*</span><span class=mi>4</span><span class=p>]</span>
            <span class=nf>push</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>2</span><span class=p>]</span>
            <span class=nf>pop</span> <span class=no>es</span><span class=p>:[</span><span class=mi>9</span><span class=p>*</span><span class=mi>4</span><span class=err>+</span><span class=mi>2</span><span class=p>]</span><span class=c>;将中断向量表中int9中断例程的入口恢复为原来的地址
</span><span class=c></span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

        <span class=nl>delay:</span>
            <span class=nf>push</span> <span class=no>ax</span>
            <span class=nf>push</span> <span class=no>dx</span>
            <span class=nf>mov</span> <span class=no>dx</span><span class=p>,</span><span class=mi>10</span><span class=no>h</span><span class=c>;循环100次，延迟的时间和CPU的计算能力成反比
</span><span class=c></span>            <span class=no>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
        <span class=nl>s1:</span>
            <span class=nf>sub</span> <span class=no>ax</span><span class=p>,</span><span class=mi>1</span>
            <span class=nf>sbb</span> <span class=no>dx</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>cmp</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>jne</span> <span class=no>s1</span>
            <span class=nf>cmp</span> <span class=no>dx</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>jne</span> <span class=no>s1</span>
            <span class=nf>pop</span> <span class=no>dx</span>
            <span class=nf>pop</span> <span class=no>ax</span>
            <span class=nf>ret</span>

            <span class=c>;新的int 9中断例程
</span><span class=c></span>
        <span class=nl>int9:</span>
            <span class=nf>push</span> <span class=no>ax</span>
            <span class=nf>push</span> <span class=no>bx</span>
            <span class=nf>push</span> <span class=no>es</span>

            <span class=nf>in</span> <span class=no>al</span><span class=p>,</span><span class=mi>60</span><span class=no>h</span>

            <span class=nf>pushf</span>
            <span class=nf>pushf</span>
            <span class=nf>pop</span> <span class=no>bx</span>
            <span class=nf>and</span> <span class=no>bh</span><span class=p>,</span><span class=mi>11111100</span><span class=no>b</span>
            <span class=nf>push</span> <span class=no>bx</span>
            <span class=nf>popf</span>
            <span class=nf>call</span> <span class=no>dword</span> <span class=no>ptr</span> <span class=no>ds</span><span class=p>:[</span><span class=mi>0</span><span class=p>]</span><span class=c>;对int指令进行模拟，调用原来的int9中断例程
</span><span class=c></span>
            <span class=nf>cmp</span> <span class=no>al</span><span class=p>,</span><span class=mi>1</span><span class=c>;esc键盘扫描码
</span><span class=c></span>            <span class=no>jne</span> <span class=no>int9ret</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>b800h</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>inc</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>160</span><span class=p>*</span><span class=mi>12</span><span class=err>+</span><span class=mi>40</span><span class=p>*</span><span class=mi>2</span><span class=err>+</span><span class=mi>1</span><span class=p>]</span><span class=c>;改变颜色
</span><span class=c></span>
        <span class=nl>int9ret:</span>
            <span class=nf>pop</span> <span class=no>es</span>
            <span class=nf>pop</span> <span class=no>bx</span>
            <span class=nf>pop</span> <span class=no>ax</span>
            <span class=nf>iret</span>

    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=155安装新的int-9中断例程>15.5安装新的int 9中断例程</h2>
<ul>
<li><strong>小甲鱼版(笔者未成功运行)</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span><span class=lnt>97
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>assume cs:code

    stack segment
            db 128 dup(0)
    stack ends

    data segment
            dw 0,0
    data ends

    code segment
    start:
            mov ax,stack
            mov ss,ax
            mov sp,128
            mov ax,data
            mov ds,ax
            mov ax,0
            mov es,ax

            push es:[9*4]
            pop ds:[0]
            push es:[9*4+2]
            pop ds:[2];将原来的int9中断例程的入口地址保存

            mov word ptr es:[9*4+2],offset int9
            mov es:[9*4+2],cs;在中断向量表中设置新的int 9中断例程的入口地址

            mov ax,0b800h
            mov es,ax
            mov ah,&#39;a&#39;

        s:
            mov es:[160*12+40*2],ah
            call delay
            inc ah
            cmp ah,&#39;z&#39;
            jna s
            mov ax,0
            mov es,ax

            push ds:[0]
            pop es:[9*4]
            push ds:[2]
            pop es:[9*4+2];将中断向量表中int9中断例程的入口恢复为原来的地址

            mov ax,4c00h
            int 21h

        delay:
            push ax
            push dx
            mov dx,10000h;循环100次，延迟的时间和CPU的计算能力成反比
            mov ax,0
        s1:
            sub ax,1
            sbb dx,0
            cmp ax,0
            jne s1
            cmp dx,0
            jne s1
            pop dx
            pop ax
            ret

            ;新的int 9中断例程

        int9:
            push ax
            push bx
            push es

            in al,60h

            pushf
            pushf
            pop bx
            and bh,11111100b
            push bx
            popf
            call dword ptr ds:[0];对int指令进行模拟，调用原来的int9中断例程

            cmp al,1;esc键盘扫描码
            jne int9ret

            mov ax,0b800h
            mov es,ax
            inc byte ptr es:[160*12+40*2+1];改变颜色

        int9ret:
            pop es
            pop bx
            pop ax
            iret

    code ends
end start
</code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>王爽原版(笔者未成功运行)</strong></li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>

    <span class=nf>stack</span> <span class=no>segment</span>
            <span class=nf>db</span> <span class=mi>128</span> <span class=no>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=nf>stack</span> <span class=no>ends</span>

    <span class=nf>code</span> <span class=no>segment</span>
    <span class=nl>start:</span>
            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>stack</span>
            <span class=nf>mov</span> <span class=no>ss</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>sp</span><span class=p>,</span><span class=mi>128</span>

            <span class=nf>push</span> <span class=no>cs</span>
            <span class=nf>pop</span> <span class=no>ds</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>

            <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=no>offset</span> <span class=no>int9</span><span class=c>;设置ds:si指向源地址
</span><span class=c></span>            <span class=no>mov</span> <span class=no>di</span><span class=p>,</span><span class=mi>204</span><span class=no>h</span><span class=c>;设置es:di指向目的地址
</span><span class=c></span>            <span class=no>mov</span> <span class=no>cx</span><span class=p>,</span><span class=no>offset</span> <span class=no>int9end</span> <span class=p>-</span> <span class=no>offset</span> <span class=no>int9</span><span class=c>;设置cx为传输长度
</span><span class=c></span>            <span class=no>cld</span><span class=c>;设置传输方向
</span><span class=c></span>            <span class=no>rep</span> <span class=no>movsb</span>

            <span class=nf>push</span> <span class=no>es</span><span class=p>:[</span><span class=mi>9</span><span class=p>*</span><span class=mi>4</span><span class=p>]</span>
            <span class=nf>pop</span> <span class=no>es</span><span class=p>:[</span><span class=mi>200</span><span class=no>h</span><span class=p>]</span>
            <span class=nf>push</span> <span class=no>es</span><span class=p>:[</span><span class=mi>9</span><span class=p>*</span><span class=mi>4</span><span class=err>+</span><span class=mi>2</span><span class=p>]</span>
            <span class=nf>pop</span> <span class=no>es</span><span class=p>:[</span><span class=mi>202</span><span class=no>h</span><span class=p>]</span>

            <span class=nf>cli</span>
            <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>9</span><span class=p>*</span><span class=mi>4</span><span class=p>],</span><span class=mi>204</span><span class=no>h</span>
            <span class=nf>mov</span> <span class=no>word</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=mi>9</span><span class=p>*</span><span class=mi>4</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=mi>0</span>
            <span class=nf>sti</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
            <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>

        <span class=nl>int9:</span>
            <span class=nf>push</span> <span class=no>ax</span>
            <span class=nf>push</span> <span class=no>bx</span>
            <span class=nf>push</span> <span class=no>cx</span>
            <span class=nf>push</span> <span class=no>es</span>

            <span class=nf>in</span> <span class=no>al</span><span class=p>,</span><span class=mi>60</span><span class=no>h</span>

            <span class=nf>pushf</span>
            <span class=nf>call</span> <span class=no>dword</span> <span class=no>ptr</span> <span class=no>cs</span><span class=p>:[</span><span class=mi>200</span><span class=no>h</span><span class=p>]</span><span class=c>;当此中断例程执行时(CS)=0
</span><span class=c></span>
            <span class=nf>cmp</span> <span class=no>al</span><span class=p>,</span><span class=mi>3</span><span class=no>bh</span><span class=c>;f1的扫描码
</span><span class=c></span>            <span class=no>jne</span> <span class=no>int9ret</span>

            <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>0</span><span class=no>b800h</span>
            <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>ax</span>
            <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>1</span>
            <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>2000</span>

        <span class=nl>s:</span>
            <span class=nf>inc</span> <span class=no>byte</span> <span class=no>ptr</span> <span class=no>es</span><span class=p>:[</span><span class=no>bx</span><span class=p>]</span>
            <span class=nf>add</span> <span class=no>bx</span><span class=p>,</span><span class=mi>2</span>
            <span class=nf>loop</span> <span class=no>s</span>

        <span class=nl>int9ret:</span>
            <span class=nf>pop</span> <span class=no>es</span>
            <span class=nf>pop</span> <span class=no>cx</span>
            <span class=nf>pop</span> <span class=no>bx</span>
            <span class=nf>pop</span> <span class=no>ax</span>
            <span class=nf>iret</span>

        <span class=nl>int9end:</span>
            <span class=nf>nop</span>

    <span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h1 id=第16章-直接定址表>第16章 直接定址表</h1>
<h2 id=161-描述单元长度的标号>16.1 描述单元长度的标号</h2>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
<span class=nf>cod</span> <span class=no>segment</span>
    <span class=nl>a:</span><span class=nf>db</span> <span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span>
    <span class=nl>b:</span><span class=nf>dw</span> <span class=mi>0</span>

<span class=nl>start:</span>
        <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=no>offset</span> <span class=no>a</span>
        <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=no>offset</span> <span class=no>b</span>
        <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>8</span>
    <span class=nl>s:</span>
        <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=no>cs</span><span class=p>:[</span><span class=no>si</span><span class=p>]</span>
        <span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>add</span> <span class=no>cs</span><span class=p>:[</span><span class=no>bx</span><span class=p>],</span><span class=no>ax</span>
        <span class=nf>inc</span> <span class=no>si</span>

    <span class=nf>loop</span> <span class=no>s</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
        <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
<span class=c>;代码中的 s、start等都是标号，表示了内存的地址
</span></code></pre></td></tr></table>
</div>
</div><p>在code段中使用的标号a，b后面没有：，因此他们可以同时描述内存地址和单元长度的标号</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
<span class=nf>cod</span> <span class=no>segment</span>
    <span class=nf>a</span> <span class=no>db</span> <span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span> <span class=c>;描述了地址code：0，和从这个地址开始以后的内存单元都是直接单元
</span><span class=c></span>    <span class=no>b</span> <span class=no>dw</span> <span class=mi>0</span> <span class=c>;则b是code[8]
</span><span class=c></span>
<span class=nl>start:</span>
        <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>mov</span> <span class=no>cx</span><span class=p>,</span><span class=mi>8</span>
    <span class=nl>s:</span>
        <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=no>a</span><span class=p>[</span><span class=no>si</span><span class=p>]</span> <span class=c>;相当于mov al,cs:0[si]
</span><span class=c></span>        <span class=no>mov</span> <span class=no>ah</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>add</span> <span class=no>b</span><span class=p>,</span><span class=no>ax</span>
        <span class=nf>inc</span> <span class=no>si</span>

    <span class=nf>loop</span> <span class=no>s</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
        <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
<span class=nf>code</span> <span class=no>ends</span>
<span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=检测点-161>检测点 16.1</h2>
<p><img src=https://upload-images.jianshu.io/upload_images/1968661-d7443f3d02a0fd2a?imageMogr2/auto-orient/strip%7CimageView2/2/w/829/format/webp alt></p>
<p>检测点16.1</p>
<h2 id=162-在其他段中使用数据标号>16.2 在其他段中使用数据标号</h2>
<ul>
<li>注意：在后面加有：的地址标号只能在代码段中使用，不能在其他段中使用。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>  <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span><span class=p>,</span><span class=no>ds</span><span class=p>:</span><span class=no>data</span>
  <span class=nf>cod</span> <span class=no>segment</span>
    <span class=nl>a:</span><span class=nf>db</span> <span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span>
    <span class=nl>b:</span><span class=nf>dw</span> <span class=mi>0</span>
  <span class=nf>data</span> <span class=no>ends</span>

  <span class=nl>start:</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=no>data</span>
        <span class=nf>mov</span> <span class=no>ds</span><span class=p>,</span><span class=no>ax</span>
        <span class=nf>mov</span> <span class=no>si</span><span class=p>,</span><span class=mi>0</span>
    <span class=nl>s:</span>
        <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=no>a</span><span class=p>[</span><span class=no>si</span><span class=p>]</span>
        <span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>add</span> <span class=no>b</span><span class=p>,</span><span class=no>ax</span>
        <span class=nf>inc</span> <span class=no>si</span>

    <span class=nf>loop</span> <span class=no>s</span>
        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
        <span class=nf>int</span> <span class=mi>21</span><span class=no>h</span>
  <span class=nf>code</span> <span class=no>ends</span>
  <span class=nf>end</span> <span class=no>start</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>如果现在代码段中直接用数据标号访问数据，则需要用伪指令assume将标号所在的段和一个段寄存器联系起来。 我们可以将标号当作数据来定义，此时编译器将标号所表示的地址当作数据的值。</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=nf>data</span> <span class=no>segment</span>
    <span class=nf>a</span> <span class=no>db</span> <span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span>
    <span class=nf>b</span> <span class=no>dw</span> <span class=mi>0</span>
    <span class=nf>c</span> <span class=no>dw</span> <span class=no>a</span><span class=p>,</span><span class=no>b</span>
    <span class=c>;相当于 c dw offset a,offset b
</span><span class=c></span><span class=nf>data</span> <span class=no>ends</span>

<span class=nf>data</span> <span class=no>segment</span>
    <span class=nf>a</span> <span class=no>db</span> <span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span>
    <span class=nf>b</span> <span class=no>dw</span> <span class=mi>0</span>
    <span class=nf>c</span> <span class=no>dd</span> <span class=no>a</span><span class=p>,</span><span class=no>b</span>
    <span class=c>;相当于 c dw offset a,seg a,offset b,seg b
</span><span class=c></span>    <span class=c>;seg操作符，功能是取得某一标号的段地址
</span><span class=c></span><span class=nf>data</span> <span class=no>ends</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=163-直接定址表>16.3 直接定址表</h2>
<ul>
<li>
<p>利用表，在两个数据集合之间建立一种映射关系，使我们可以利用查表的方法根据给出的数据得到其在另一集合中对应数据</p>
<ul>
<li>目的：
<ol>
<li>为了算法的清晰和简洁</li>
<li>为了加快运算速度</li>
<li>为了使程序易于扩充</li>
</ol>
</li>
</ul>
</li>
<li>
<p>小练习，编写子程序，以十六进制的形式在屏幕中间显示给定的byte型数据。小技巧，利用映射关系，0-9数值+30h=对应字符的ascii值，10-15和A到F之间的银色关系是：数值+37h=对应字符的ascii的值</p>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-asm data-lang=asm>  <span class=nf>assume</span> <span class=no>cs</span><span class=p>:</span><span class=no>code</span>
  <span class=nl>code:</span><span class=nf>segment</span>
        <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=mi>0</span><span class=no>eh</span>

        <span class=nf>call</span> <span class=no>showbyte</span>

        <span class=nf>mov</span> <span class=no>ax</span><span class=p>,</span><span class=mi>4</span><span class=no>c00h</span>
        <span class=nf>int</span> <span class=mi>21</span>
        <span class=c>;子程序，用al传送要显示的数据
</span><span class=c></span>
  <span class=nl>showbyte:</span>
        <span class=nf>jmp</span> <span class=no>short</span> <span class=no>show</span>

        <span class=nf>table</span> <span class=no>db</span> <span class=err>&#39;</span><span class=mi>1023456789</span><span class=no>ABCDEF</span><span class=err>&#39;</span><span class=c>;字符表
</span><span class=c></span>
  <span class=nl>show:</span>
        <span class=nf>push</span> <span class=no>bx</span>
        <span class=nf>push</span> <span class=no>es</span>

        <span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=no>al</span>
        <span class=nf>shr</span> <span class=no>ah</span><span class=p>,</span><span class=mi>1</span>
        <span class=nf>shr</span> <span class=no>ah</span><span class=p>,</span><span class=mi>1</span>
        <span class=nf>shr</span> <span class=no>ah</span><span class=p>,</span><span class=mi>1</span>
        <span class=nf>shr</span> <span class=no>ah</span><span class=p>,</span><span class=mi>1</span><span class=c>;右移4位，ah中得到高4位的值
</span><span class=c></span>        <span class=no>and</span> <span class=no>al</span><span class=p>,</span><span class=mi>00001111</span><span class=no>b</span><span class=c>;al中为低4位
</span><span class=c></span>
        <span class=nf>mov</span> <span class=no>bl</span><span class=p>,</span><span class=no>ah</span>
        <span class=nf>mov</span> <span class=no>bh</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>mov</span> <span class=no>ah</span><span class=p>,</span><span class=no>table</span><span class=p>[</span><span class=no>bx</span><span class=p>]</span><span class=c>;用高4位的值作为相对于table的便宜，取得对应的字符
</span><span class=c></span>
        <span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span><span class=mi>0</span><span class=no>b800h</span>
        <span class=nf>mov</span> <span class=no>es</span><span class=p>,</span><span class=no>bx</span>
        <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=mi>160</span><span class=p>*</span><span class=mi>12</span><span class=err>+</span><span class=mi>40</span><span class=p>*</span><span class=mi>2</span><span class=p>],</span><span class=no>ah</span>

        <span class=nf>mov</span> <span class=no>bl</span><span class=p>,</span><span class=no>al</span>
        <span class=nf>mov</span> <span class=no>bh</span><span class=p>,</span><span class=mi>0</span>
        <span class=nf>mov</span> <span class=no>al</span><span class=p>,</span><span class=no>table</span><span class=p>[</span><span class=no>bx</span><span class=p>]</span><span class=c>;用低4位的值作为相对于table的偏移，取得对应的字符
</span><span class=c></span>
        <span class=nf>mov</span> <span class=no>es</span><span class=p>:[</span><span class=mi>160</span><span class=p>*</span><span class=mi>12</span><span class=err>+</span><span class=mi>40</span><span class=p>*</span><span class=mi>2</span><span class=err>+</span><span class=mi>2</span><span class=p>],</span><span class=no>al</span>

        <span class=nf>pop</span> <span class=no>es</span>
        <span class=nf>pop</span> <span class=no>bx</span>
        <span class=nf>ret</span>

  <span class=nf>code</span> <span class=no>ends</span>
  <span class=nf>end</span> <span class=no>start</span> 
</code></pre></td></tr></table>
</div>
</div><h2 id=164-程序入口地址的直接定址表>16.4 程序入口地址的直接定址表</h2>
<ul>
<li>小练习</li>
</ul>
<ol>
<li>清屏：将显存中当前屏幕中的支付设为空格；</li>
<li>设置前景色：设置显存中当前屏幕中处于奇地址的属性字节的第0、1、2位；</li>
<li>设置背景色：设置显存中当前屏幕中处于奇地址的属性字节的第4、5、6位；</li>
<li>向上滚动一行：依次将第n+行的内容复制到第n行处，最后一行为空。</li>
</ol>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>;================================入口函数1=====================================
;入口函数说明;
;用ah传递功能号，0是清屏，1是设置前景色，2是设置背景色，3是向上滚动一行

setscreen:
        jmp short set
        table dw sub1,sub2,sub3,sub4

set:
        push bx
        cmp ah,3;判断传递的功能号是否大于3
        ja sret
        mov bl,ah
        mov bh,0
        add bx,bx;根据ah中的功能号计算对应子程序的地址在table表中的偏移

        call word ptr table[bx];调用对应的子程序

sret;
        pop bx
        iret

;================================入口函数2=====================================
;入口函数说明;
;用ah传递功能号，0是清屏，1是设置前景色，2是设置背景色，3是向上滚动一行

setscreen:
        cmp ah,0
        je do1
        cmp ah,1
        je do2
        cmp ah,2
        je do3
        cmp ah,3
        je do4

        jmp short sret

do1:
        call sub1
        jmp short sret

do2:
        call sub2
        jmp short sret

do3:
        call sub3
        jmp short sret

do4:
        call sub4
        jmp short sret

;子功能==========================================================================

;清屏
sub1:
        push bx
        push cx
        push es
        mov bx,0b800h
        mov es,bx
        mov bx,0
        mov cx,2000

sub1s:
        mov byte ptr es:[bx],&#39;&#39;
        add bx,2
    loop sub1s

        pop es
        pop cx
        pop bx
        ret

;设置前景色
sub2:
        push bx
        push cx
        push es
        mov bx,0b800h
        mov es,bx
        mov bx,1
        mov cx,2000

sub2s:
        mov byte ptr es:[bx],11111000b
        or es:[bx],al
        add bx,2
    loop sub2s

        pop es
        pop cx
        pop bx
        ret

;设置背景色
sub3:
        push bx
        push cx
        push es
        mov cl,4
        shl al,cl
        mov bx,0b800h
        mov es,bx
        mov bx,1
        mov cx,2000

sub3s:
        mov byte ptr es:[bx],10001111b
        or es:[bx],al
        add bx,2
    loop sub3s

        pop es
        pop cx
        pop bx
        ret

;向上滚动一行
sub4:
        push cx
        push si
        push di
        push es
        push ds

        mov si,0b800h
        mov es,si
        mov ds,si
        mov si,160;ds：si指向第n+行
        mov di,0;es：di指向第n行
        cld
        mov cx,24;共复制24行

sub4s:
        push cx
        mov cx,160
        rep movsb;复制
        pop cx
    loop sub4s

        mov cx,80
        mov si,0

sub4s1:
        mov byte ptr es:[160*24+si],&#39;&#39;;最后一行清空
        add si,2
    loop sub4s1

        pop ds
        pop es
        pop di
        pop si
        pop cx
        ret;结束
</code></pre></td></tr></table>
</div>
</div>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>Justice</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2024-01-05 22:16:21
</span>
</p>
<p class=copyright-item>
<span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
<div class=post-reward>
<input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label>
<div class=qr-code>
<label class=qr-code-image for=reward>
<img class=image src=/image/wx_reward_qrcode.png>
<span>微信打赏</span>
</label>
<label class=qr-code-image for=reward>
<img class=image src=/image/alipay_reward_qrcode.png>
<span>支付宝打赏</span>
</label>
<label class=qr-code-image for=reward>
<img class=image src=/image/bitcoin_reward_qrcode.png>
<span>比特币打赏</span>
</label>
</div>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=https://justice.bj.cn/tags/language/>language</a>
<a href=https://justice.bj.cn/tags/asm/>asm</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/14.language/asm/x86%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81/>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg>
</i>
<span class="prev-text nav-default">x86指令编码</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/90.play/emuelec/>
<span class="next-text nav-default">EmuElec</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg>
</i>
</a>
</nav>
</footer>
</article>
<div class="post bg-white">
<script src=https://utteranc.es/client.js repo=ZhuZhengyi/gh_comment issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</div>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=mailto:justice_103@126.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a>
<a href=https://justice.bj.cn/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2000 -
2024
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
Justice
</span></span>
<span id=busuanzi_container>
访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript>window.MathJax={showProcessingMessages:!1,messageStyle:'none'}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css integrity=sha384-BdGj8xC2eZkQaxoQ8nSLefg4AV4/AwB3Fj+8SUSo7pnKP6Eoy18liIKTPn9oBYNG crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.js integrity=sha384-JiKN5O8x9Hhs/UE5cT5AAJqieYlOZbGT3CHws/y97o3ty4R7/O5poG9F3JoiOYw1 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{})})</script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=/js/fuse.min.js></script>
<script src=/js/fastsearch.js></script>
</body>
</html>