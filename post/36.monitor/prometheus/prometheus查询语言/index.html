<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>PromQL查询语言 - Justice的小站</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="Justice">
<meta name=description content="PromQL查询语言 简介 PromQL（Prometheus Query Language）是 Prometheus 自己开发的表达式语言，语言表现力很丰富，内置函数也很多。使">
<meta name=keywords content="Hugo,theme,jane">
<meta name=generator content="Hugo 0.88.1">
<link rel=canonical href=https://justice.bj.cn/post/36.monitor/prometheus/prometheus%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/sass/jane.min.2f6e4d7e6e51da09470910b5f0d41a7d2c517dbe97416dd268a18bb7334c4ff8.css integrity="sha256-L25Nfm5R2glHCRC18NQafSxRfb6XQW3SaKGLtzNMT/g=" media=screen crossorigin=anonymous>
<meta property="og:title" content="PromQL查询语言">
<meta property="og:description" content="PromQL查询语言 简介 PromQL（Prometheus Query Language）是 Prometheus 自己开发的表达式语言，语言表现力很丰富，内置函数也很多。使">
<meta property="og:type" content="article">
<meta property="og:url" content="https://justice.bj.cn/post/36.monitor/prometheus/prometheus%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80/"><meta property="article:section" content="post">
<meta property="article:modified_time" content="2021-09-16T09:46:04+08:00"><meta property="og:site_name" content="Justice的小站">
<meta itemprop=name content="PromQL查询语言">
<meta itemprop=description content="PromQL查询语言 简介 PromQL（Prometheus Query Language）是 Prometheus 自己开发的表达式语言，语言表现力很丰富，内置函数也很多。使">
<meta itemprop=dateModified content="2021-09-16T09:46:04+08:00">
<meta itemprop=wordCount content="2905">
<meta itemprop=keywords content="monitor,prometheus,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="PromQL查询语言">
<meta name=twitter:description content="PromQL查询语言 简介 PromQL（Prometheus Query Language）是 Prometheus 自己开发的表达式语言，语言表现力很丰富，内置函数也很多。使"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>Justice's Blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/>主页</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/post/>点滴</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/tags/>标签</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/categories/>分类</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://gohugo.io rel=noopener target=_blank>
更多
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6 21.568 21.632 54.144 54.208 54.144 54.208C534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0 30.72.0 55.04-24.512 55.04-54.848C512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408v-49.28C896 481.792 871.424 457.152 841.152 457.152z"/></svg>
</i>
</a>
</li>
<li class=mobile-menu-item>
<a id=openSearchMobile class="mobile-menu-item-link menu-item-search" href=#>
<i class=iconfont><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="18" height="18" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M973.81454219 973.81454219a91.78207815 91.78207815.0 01-129.80999631.0L682.0297247 811.83972101a425.48527711 425.48527711.0 01-230.35931791 68.16531768 428.3346319 428.3346319.0 11428.3346319-428.3346319A425.48527711 425.48527711.0 01811.83972101 682.0297247l162.02961656 161.97482118a91.83687354 91.83687354.0 01-.05479538 129.80999631zm-522.1441354-828.1209266a305.97679241 305.97679241.0 100 611.95358361 305.97679241 305.97679241.0 000-611.95358361z"/></svg>
</i>
</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<div class=modal-dialog>
<div class=modal-content>
<div id=closeSearch title=Close class=close>X</div>
<div class=modal-header>
<div class=modal-title>Search</div>
</div>
<div class=modal-body>
<script>(function(){var c='002186711602136249422:q1gkomof_em',a=document.createElement('script'),b;a.type='text/javascript',a.async=!0,a.src=(document.location.protocol=='https:'?'https:':'http:')+'//cse.google.com/cse.js?cx='+c,b=document.getElementsByTagName('script')[0],b.parentNode.insertBefore(a,b)})()</script>
<gcse:search></gcse:search>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/ class=logo>
Justice's Blog
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/>主页</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/post/>点滴</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/tags/>标签</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/categories/>分类</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://gohugo.io rel=noopener target=_blank>
更多
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6 21.568 21.632 54.144 54.208 54.144 54.208C534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0 30.72.0 55.04-24.512 55.04-54.848C512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408v-49.28C896 481.792 871.424 457.152 841.152 457.152z"/></svg>
</i>
</a>
</li>
<li class=menu-item>
<a id=openSearch class="menu-item-link menu-item-search" href=#>
<i class=iconfont><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="18" height="18" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M973.81454219 973.81454219a91.78207815 91.78207815.0 01-129.80999631.0L682.0297247 811.83972101a425.48527711 425.48527711.0 01-230.35931791 68.16531768 428.3346319 428.3346319.0 11428.3346319-428.3346319A425.48527711 425.48527711.0 01811.83972101 682.0297247l162.02961656 161.97482118a91.83687354 91.83687354.0 01-.05479538 129.80999631zm-522.1441354-828.1209266a305.97679241 305.97679241.0 100 611.95358361 305.97679241 305.97679241.0 000-611.95358361z"/></svg>
</i>
</a>
</li>
</ul>
</nav>
</header>
<div id=mobile-panel>
<main id=main class="main bg-llight">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>PromQL查询语言</h1>
<div class=post-meta>
<time datetime=2021-09-16 class=post-time>
2021-09-166
</time>
<div class=post-category>
<a href=https://justice.bj.cn/categories/monitor/> monitor </a>
<a href=https://justice.bj.cn/categories/prometheus/> prometheus </a>
</div>
<span id=busuanzi_container_page_pv>
| 阅读 <span id=busuanzi_value_page_pv></span>
</span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#简介>简介</a>
<ul>
<li><a href=#1-promql-语法>1. PromQL 语法</a></li>
<li><a href=#2-promql-操作符>2. PromQL 操作符</a></li>
<li><a href=#3-函数>3. 函数</a></li>
<li><a href=#删除指标>删除指标</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<h1 id=promql查询语言>PromQL查询语言</h1>
<h2 id=简介>简介</h2>
<p>PromQL（Prometheus Query Language）是 Prometheus 自己开发的表达式语言，语言表现力很丰富，内置函数也很多。使用它可以对时序数据进行筛选和聚合。</p>
<h3 id=1-promql-语法>1. PromQL 语法</h3>
<h4 id=11-数据类型>1.1 数据类型</h4>
<p>PromQL 表达式计算出来的值有以下几种类型：</p>
<ul>
<li>瞬时向量 (Instant vector): 一组时序，每个时序只有一个采样值</li>
<li>区间向量 (Range vector): 一组时序，每个时序包含一段时间内的多个采样值</li>
<li>标量数据 (Scalar): 一个浮点数</li>
<li>字符串 (String): 一个字符串，暂时未用</li>
</ul>
<h4 id=12-时序选择器>1.2 时序选择器</h4>
<h5 id=121-瞬时向量选择器>1.2.1 瞬时向量选择器</h5>
<p>瞬时向量选择器用来选择<strong>一组时序在某个采样点的采样值</strong>。</p>
<p>最简单的情况就是指定一个度量指标，选择出所有属于该度量指标的时序的当前采样值。比如下面的表达式：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>http_requests_total
</code></pre></td></tr></table>
</div>
</div><p>可以通过在后面添加用大括号包围起来的一组标签键值对来对时序进行过滤。比如下面的表达式筛选出了 <code>job</code> 为 <code>prometheus</code>，并且 <code>group</code> 为 <code>canary</code> 的时序：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=n>http_requests_total</span><span class=p>{</span><span class=n>job</span><span class=p>=</span><span class=s>&#34;prometheus&#34;</span><span class=p>,</span> <span class=k>group</span><span class=p>=</span><span class=s>&#34;canary&#34;</span><span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>匹配标签值时可以是<strong>等于</strong>，也可以<strong>使用正则表达式</strong>。总共有下面几种匹配操作符：</p>
<ul>
<li><code>=</code>：完全相等</li>
<li><code>!=</code>： 不相等</li>
<li><code>=~</code>： 正则表达式匹配</li>
<li><code>!~</code>： 正则表达式不匹配</li>
</ul>
<p>下面的表达式筛选出了 environment 为 staging 或 testing 或 development，并且 method 不是 GET 的时序：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>http_requests_total<span class=o>{</span><span class=nv>environment</span><span class=o>=</span>~<span class=s2>&#34;staging|testing|development&#34;</span>,method!<span class=o>=</span><span class=s2>&#34;GET&#34;</span><span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>度量指标名可以使用内部标签 <code>__name__</code> 来匹配，表达式 <code>http_requests_total</code> 也可以写成 <code>{__name__="http_requests_total"}</code>。表达式 <code>{__name__=~"job:.*"}</code> 匹配所有度量指标名称以 <code>job:</code> 打头的时序。</p>
<h5 id=122-区间向量选择器>1.2.2 区间向量选择器</h5>
<p>区间向量选择器类似于瞬时向量选择器，不同的是它选择的是<strong>过去一段时间的采样值</strong>。可以通过在瞬时向量选择器后面添加包含在 <code>[]</code> 里的时长来得到区间向量选择器。比如下面的表达式选出了所有度量指标为 <code>http_requests_total</code> 且 <code>job</code> 为 <code>prometheus</code> 的时序在过去 5 分钟的采样值。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>http_requests_total<span class=o>{</span><span class=nv>job</span><span class=o>=</span><span class=s2>&#34;prometheus&#34;</span><span class=o>}[</span>5m<span class=o>]</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>说明：时长的单位可以是下面几种之一：</strong></p>
<ul>
<li>s：seconds</li>
<li>m：minutes</li>
<li>h：hours</li>
<li>d：days</li>
<li>w：weeks</li>
<li>y：years</li>
</ul>
<h5 id=123-偏移修饰器>1.2.3 偏移修饰器</h5>
<p>前面介绍的选择器默认都是以当前时间为基准时间，偏移修饰器用来调整基准时间，使其往前偏移一段时间。偏移修饰器紧跟在选择器后面，使用 offset 来指定要偏移的量。比如下面的表达式选择度量名称为 <code>http_requests_total</code> 的所有时序在 <code>5</code> 分钟前的采样值。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>http_requests_total offset 5m
</code></pre></td></tr></table>
</div>
</div><p>下面的表达式选择 <code>http_requests_total</code> 度量指标在 <code>1</code> 周前的这个时间点过去 5 分钟的采样值。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=nt>http_requests_total</span><span class=o>[</span><span class=nt>5m</span><span class=o>]</span> <span class=nt>offset</span> <span class=nt>1w</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=2-promql-操作符>2. PromQL 操作符</h3>
<h4 id=21-二元操作符>2.1 二元操作符</h4>
<p>PromQL 的二元操作符支持基本的逻辑和算术运算，包含<strong>算术类</strong>、<strong>比较类</strong>和<strong>逻辑类</strong>三大类。</p>
<h5 id=211-算术类二元操作符>2.1.1 算术类二元操作符</h5>
<p>算术类二元操作符有以下几种：</p>
<ul>
<li><code>+</code>：加</li>
<li><code>-</code>：减</li>
<li><code>*</code>：乘</li>
<li><code>/</code>：除</li>
<li><code>%</code>：求余</li>
<li><code>^</code>：乘方</li>
</ul>
<p>算术类二元操作符可以使用在标量与标量、向量与标量，以及向量与向量之间。</p>
<p><strong>二元操作符上下文里的向量特指瞬时向量，不包括区间向量。</strong></p>
<ul>
<li>标量与标量之间，结果很明显，跟通常的算术运算一致。</li>
<li>向量与标量之间，相当于把标量跟向量里的每一个标量进行运算，这些计算结果组成了一个新的向量。</li>
<li>向量与向量之间，会稍微麻烦一些。运算的时候首先会为左边向量里的每一个元素在右边向量里去寻找一个匹配元素（匹配规则后面会讲），然后对这两个匹配元素执行计算，这样每对匹配元素的计算结果组成了一个新的向量。如果没有找到匹配元素，则该元素丢弃。</li>
</ul>
<h5 id=212-比较类二元操作符>2.1.2 比较类二元操作符</h5>
<p>比较类二元操作符有以下几种：</p>
<ul>
<li><code>==</code> (equal)</li>
<li><code>!=</code> (not-equal)</li>
<li><code>></code> (greater-than)</li>
<li><code>&lt;</code> (less-than)</li>
<li><code>>=</code> (greater-or-equal)</li>
<li><code>&lt;=</code> (less-or-equal)</li>
</ul>
<p>比较类二元操作符同样可以使用在标量与标量、向量与标量，以及向量与向量之间。默认执行的是过滤，也就是保留值。</p>
<p>也可以通过在运算符后面跟 bool 修饰符来使得返回值 0 和 1，而不是过滤。</p>
<ul>
<li>标量与标量之间，必须跟 bool 修饰符，因此结果只可能是 0（false） 或 1（true）。</li>
<li>向量与标量之间，相当于把向量里的每一个标量跟标量进行比较，结果为真则保留，否则丢弃。如果后面跟了 bool 修饰符，则结果分别为 1 和 0。</li>
<li>向量与向量之间，运算过程类似于算术类操作符，只不过如果比较结果为真则保留左边的值（包括度量指标和标签这些属性），否则丢弃，没找到匹配也是丢弃。如果后面跟了 bool 修饰符，则保留和丢弃时结果相应为 1 和 0。</li>
</ul>
<h5 id=213-逻辑类二元操作符>2.1.3 逻辑类二元操作符</h5>
<p>逻辑操作符仅用于向量与向量之间。</p>
<ul>
<li><code>and</code>：交集</li>
<li><code>or</code>：合集</li>
<li><code>unless</code>：补集</li>
</ul>
<p>具体运算规则如下：</p>
<ul>
<li><code>vector1 and vector2</code> 的结果由在 vector2 里有匹配（标签键值对组合相同）元素的 vector1 里的元素组成。</li>
<li><code>vector1 or vector2</code> 的结果由所有 vector1 里的元素加上在 vector1 里没有匹配（标签键值对组合相同）元素的 vector2 里的元素组成。</li>
<li><code>vector1 unless vector2</code> 的结果由在 vector2 里没有匹配（标签键值对组合相同）元素的 vector1 里的元素组成。</li>
</ul>
<h5 id=214-二元操作符优先级>2.1.4 二元操作符优先级</h5>
<p>PromQL 的各类二元操作符运算优先级如下：</p>
<ol>
<li><code>^</code></li>
<li><code>*, /, %</code></li>
<li><code>+, -</code></li>
<li><code>==, !=, &lt;=, &lt;, >=, ></code></li>
<li><code>and, unless</code></li>
<li><code>or</code></li>
</ol>
<h4 id=22-向量匹配>2.2 向量匹配</h4>
<p>前面算术类和比较类操作符都需要在向量之间进行匹配。共有两种匹配类型，<code>one-to-one</code> 和 <code>many-to-one</code> / <code>one-to-many</code>。</p>
<h5 id=221-one-to-one-向量匹配>2.2.1 One-to-one 向量匹配</h5>
<p>这种匹配模式下，两边向量里的元素如果其标签键值对组合相同则为匹配，并且只会有一个匹配元素。可以使用 <code>ignoring</code> 关键词来忽略不参与匹配的标签，或者使用 <code>on</code> 关键词来指定要参与匹配的标签。语法如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span> <span class=nt>&lt;bin-op&gt;</span> ignoring(<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>) <span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span>
<span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span> <span class=nt>&lt;bin-op&gt;</span> on(<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>) <span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>比如对于下面的输入：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>method_code:http_errors:rate5m<span class=o>{</span><span class=nv>method</span><span class=o>=</span><span class=s2>&#34;get&#34;</span>, <span class=nv>code</span><span class=o>=</span><span class=s2>&#34;500&#34;</span><span class=o>}</span>  <span class=m>24</span>
method_code:http_errors:rate5m<span class=o>{</span><span class=nv>method</span><span class=o>=</span><span class=s2>&#34;get&#34;</span>, <span class=nv>code</span><span class=o>=</span><span class=s2>&#34;404&#34;</span><span class=o>}</span>  <span class=m>30</span>
method_code:http_errors:rate5m<span class=o>{</span><span class=nv>method</span><span class=o>=</span><span class=s2>&#34;put&#34;</span>, <span class=nv>code</span><span class=o>=</span><span class=s2>&#34;501&#34;</span><span class=o>}</span>  <span class=m>3</span>
method_code:http_errors:rate5m<span class=o>{</span><span class=nv>method</span><span class=o>=</span><span class=s2>&#34;post&#34;</span>, <span class=nv>code</span><span class=o>=</span><span class=s2>&#34;500&#34;</span><span class=o>}</span> <span class=m>6</span>
method_code:http_errors:rate5m<span class=o>{</span><span class=nv>method</span><span class=o>=</span><span class=s2>&#34;post&#34;</span>, <span class=nv>code</span><span class=o>=</span><span class=s2>&#34;404&#34;</span><span class=o>}</span> <span class=m>21</span>

method:http_requests:rate5m<span class=o>{</span><span class=nv>method</span><span class=o>=</span><span class=s2>&#34;get&#34;</span><span class=o>}</span>  <span class=m>600</span>
method:http_requests:rate5m<span class=o>{</span><span class=nv>method</span><span class=o>=</span><span class=s2>&#34;del&#34;</span><span class=o>}</span>  <span class=m>34</span>
method:http_requests:rate5m<span class=o>{</span><span class=nv>method</span><span class=o>=</span><span class=s2>&#34;post&#34;</span><span class=o>}</span> <span class=m>120</span>
</code></pre></td></tr></table>
</div>
</div><p>执行下面的查询：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>method_code:http_errors:rate5m<span class=o>{</span><span class=nv>code</span><span class=o>=</span><span class=s2>&#34;500&#34;</span><span class=o>}</span> / ignoring<span class=o>(</span>code<span class=o>)</span> method:http_requests:rate5m
</code></pre></td></tr></table>
</div>
</div><p>得到的结果为：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=p>{</span><span class=n>method</span><span class=o>=</span><span class=s>&#34;get&#34;</span><span class=p>}</span>  <span class=mf>0.04</span>            <span class=c1>//  24 / 600
</span><span class=c1></span><span class=p>{</span><span class=n>method</span><span class=o>=</span><span class=s>&#34;post&#34;</span><span class=p>}</span> <span class=mf>0.05</span>            <span class=c1>//   6 / 120
</span></code></pre></td></tr></table>
</div>
</div><p>也就是每一种 method 里 code 为 500 的请求数占总数的百分比。由于 method 为 put 和 del 的没有匹配元素所以没有出现在结果里。</p>
<h5 id=222-many-to-one--one-to-many-向量匹配>2.2.2 Many-to-one / one-to-many 向量匹配</h5>
<p>这种匹配模式下，某一边会有多个元素跟另一边的元素匹配。这时就需要使用 <code>group_left</code> 或 <code>group_right</code> 组修饰符来指明哪边匹配元素较多，左边多则用 <code>group_left</code>，右边多则用 <code>group_right</code>。其语法如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span> <span class=nt>&lt;bin-op&gt;</span> ignoring(<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>) group_left(<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>) <span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span>
<span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span> <span class=nt>&lt;bin-op&gt;</span> ignoring(<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>) group_right(<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>) <span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span>
<span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span> <span class=nt>&lt;bin-op&gt;</span> on(<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>) group_left(<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>) <span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span>
<span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span> <span class=nt>&lt;bin-op&gt;</span> on(<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>) group_right(<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>) <span class=nt>&lt;vector</span> <span class=err>expr</span><span class=nt>&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>组修饰符只适用于算术类和比较类操作符。</strong></p>
<p>对于前面的输入，执行下面的查询：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>method_code:http_errors:rate5m / ignoring(code) group_left method:http_requests:rate5m
</code></pre></td></tr></table>
</div>
</div><p>将得到下面的结果：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=p>{</span><span class=n>method</span><span class=o>=</span><span class=s>&#34;get&#34;</span><span class=p>,</span> <span class=n>code</span><span class=o>=</span><span class=s>&#34;500&#34;</span><span class=p>}</span>  <span class=mf>0.04</span>            <span class=c1>//  24 / 600
</span><span class=c1></span><span class=p>{</span><span class=n>method</span><span class=o>=</span><span class=s>&#34;get&#34;</span><span class=p>,</span> <span class=n>code</span><span class=o>=</span><span class=s>&#34;404&#34;</span><span class=p>}</span>  <span class=mf>0.05</span>            <span class=c1>//  30 / 600
</span><span class=c1></span><span class=p>{</span><span class=n>method</span><span class=o>=</span><span class=s>&#34;post&#34;</span><span class=p>,</span> <span class=n>code</span><span class=o>=</span><span class=s>&#34;500&#34;</span><span class=p>}</span> <span class=mf>0.05</span>            <span class=c1>//   6 / 120
</span><span class=c1></span><span class=p>{</span><span class=n>method</span><span class=o>=</span><span class=s>&#34;post&#34;</span><span class=p>,</span> <span class=n>code</span><span class=o>=</span><span class=s>&#34;404&#34;</span><span class=p>}</span> <span class=mf>0.175</span>           <span class=c1>//  21 / 120
</span></code></pre></td></tr></table>
</div>
</div><p>也就是每种 method 的每种 code 错误次数占每种 method 请求数的比例。这里匹配的时候 ignoring 了 code，才使得两边可以形成 Many-to-one 形式的匹配。由于左边多，所以需要使用 group_left 来指明。</p>
<p>Many-to-one / one-to-many 过于高级和复杂，要尽量避免使用。很多时候通过 ignoring 就可以解决问题。</p>
<h4 id=23-聚合操作符>2.3 聚合操作符</h4>
<p>PromQL 的聚合操作符用来将向量里的元素聚合得更少。总共有下面这些聚合操作符：</p>
<ul>
<li>sum：求和</li>
<li>min：最小值</li>
<li>max：最大值</li>
<li>avg：平均值</li>
<li>stddev：标准差</li>
<li>stdvar：方差</li>
<li>count：元素个数</li>
<li>count_values：等于某值的元素个数</li>
<li>bottomk：最小的 k 个元素</li>
<li>topk：最大的 k 个元素</li>
<li>quantile：分位数</li>
</ul>
<p>聚合操作符语法如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;aggr-op&gt;</span>([parameter,] <span class=nt>&lt;vector</span> <span class=err>expression</span><span class=nt>&gt;</span>) [without|by (<span class=nt>&lt;label</span> <span class=err>list</span><span class=nt>&gt;</span>)]
</code></pre></td></tr></table>
</div>
</div><p>其中 <code>without</code> 用来指定不需要保留的标签（也就是这些标签的多个值会被聚合），而 <code>by</code> 正好相反，用来指定需要保留的标签（也就是按这些标签来聚合）。</p>
<p>下面来看几个示例：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sum(http_requests_total) without (instance)
</code></pre></td></tr></table>
</div>
</div><p>http_requests_total 度量指标带有 application、instance 和 group 三个标签。上面的表达式会得到每个 application 的每个 group 在所有 instance 上的请求总数。效果等同于下面的表达式：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=n>sum</span><span class=p>(</span><span class=n>http_requests_total</span><span class=p>)</span> <span class=k>by</span> <span class=p>(</span><span class=n>application</span><span class=p>,</span> <span class=k>group</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><p>下面的表达式可以得到所有 application 的所有 group 的所有 instance 的请求总数。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>sum(http_requests_total)
</code></pre></td></tr></table>
</div>
</div><h3 id=3-函数>3. 函数</h3>
<p>Prometheus 内置了一些函数来辅助计算，下面介绍一些典型的。</p>
<ul>
<li>abs()：绝对值</li>
<li>sqrt()：平方根</li>
<li>exp()：指数计算</li>
<li>ln()：自然对数</li>
<li>ceil()：向上取整</li>
<li>floor()：向下取整</li>
<li>round()：四舍五入取整</li>
<li>delta()：计算区间向量里每一个时序第一个和最后一个的差值</li>
<li>sort()：排序</li>
</ul>
<h3 id=删除指标>删除指标</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=c1>##</span>
$ prometheus --web.enable-admin-api

$ curl -X POST -g <span class=s1>&#39;http://10.201.70.57:9090/api/v1/admin/tsdb/delete_series?match[]={cluster=&#34;chubaofs-test-03&#34;}&#39;</span>          
</code></pre></td></tr></table>
</div>
</div>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>Justice</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2021-09-166
</span>
</p>
<p class=copyright-item>
<span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
<div class=post-reward>
<input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label>
<div class=qr-code>
</div>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=https://justice.bj.cn/tags/monitor/>monitor</a>
<a href=https://justice.bj.cn/tags/prometheus/>prometheus</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/30.architech/consul%E5%9F%BA%E7%A1%80/>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg>
</i>
<span class="prev-text nav-default">Consul基础</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/70.tool/jq/>
<span class="next-text nav-default">JQ</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg>
</i>
</a>
</nav>
</footer>
</article>
<div class="post bg-white">
<script src=https://utteranc.es/client.js repo=ZhuZhengyi/gh_comment issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</div>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=mailto:justice_103@126.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a>
<a href=https://justice.bj.cn/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2000 -
2021
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
Justice
</span></span>
<span id=busuanzi_container>
访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript>window.MathJax={showProcessingMessages:!1,messageStyle:'none'}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css integrity=sha384-BdGj8xC2eZkQaxoQ8nSLefg4AV4/AwB3Fj+8SUSo7pnKP6Eoy18liIKTPn9oBYNG crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.js integrity=sha384-JiKN5O8x9Hhs/UE5cT5AAJqieYlOZbGT3CHws/y97o3ty4R7/O5poG9F3JoiOYw1 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{})})</script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script>$("#openSearch, #openSearchMobile").click(function(){$(".modal-dialog").addClass("visible")}),$("#closeSearch").click(function(){$(".modal-dialog").removeClass("visible")}),$(document).click(function(a){$(a.target).closest(".modal-content, #openSearch, #openSearchMobile").length||$("body").find(".modal-dialog").removeClass("visible")})</script>
</body>
</html>