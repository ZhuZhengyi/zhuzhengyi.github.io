<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Germlin - Justice的小站</title>
<meta name=renderer content="webkit">
<meta name=referrer content="no-referrer">
<meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes">
<meta name=MobileOptimized content="width">
<meta name=HandheldFriendly content="true">
<meta name=applicable-device content="pc,mobile">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=mobile-web-app-capable content="yes">
<meta name=author content="Justice">
<meta name=description content="Germlin 简介 Gremlin是Apache TinkerPop的图形查询语言，是一种函数式数据流语言，可以使得用户使用简洁的方式表述复杂的属性图（pr">
<meta name=keywords content="tech,it,blog">
<meta name=generator content="Hugo 0.88.1">
<link rel=canonical href=https://justice.bj.cn/post/30.architech/graphdb/germlin/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/sass/jane.min.34a0cf3583dc0fd6b4e3fe24a36c076984feee75ebc2792cff33928ccdcfc628.css integrity="sha256-NKDPNYPcD9a04/4ko2wHaYT+7nXrwnks/zOSjM3Pxig=" media=screen crossorigin=anonymous>
<meta property="og:title" content="Germlin">
<meta property="og:description" content="Germlin 简介 Gremlin是Apache TinkerPop的图形查询语言，是一种函数式数据流语言，可以使得用户使用简洁的方式表述复杂的属性图（pr">
<meta property="og:type" content="article">
<meta property="og:url" content="https://justice.bj.cn/post/30.architech/graphdb/germlin/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-10-10T14:35:02+08:00">
<meta property="article:modified_time" content="2021-10-10T14:35:02+08:00"><meta property="og:site_name" content="Justice的小站">
<meta itemprop=name content="Germlin">
<meta itemprop=description content="Germlin 简介 Gremlin是Apache TinkerPop的图形查询语言，是一种函数式数据流语言，可以使得用户使用简洁的方式表述复杂的属性图（pr"><meta itemprop=datePublished content="2021-10-10T14:35:02+08:00">
<meta itemprop=dateModified content="2021-10-10T14:35:02+08:00">
<meta itemprop=wordCount content="4539">
<meta itemprop=keywords content="architech,graphdb,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Germlin">
<meta name=twitter:description content="Germlin 简介 Gremlin是Apache TinkerPop的图形查询语言，是一种函数式数据流语言，可以使得用户使用简洁的方式表述复杂的属性图（pr"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>Justice's Blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/>主页</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/post/>点滴</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/tags/>标签</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=https://justice.bj.cn/categories/>分类</a>
</li><li class=mobile-menu-item>
<a class=menu-item-link href=http://passer-by.com/pacman/ rel=noopener target=_blank>
更多
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6 21.568 21.632 54.144 54.208 54.144 54.208C534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0 30.72.0 55.04-24.512 55.04-54.848C512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408v-49.28C896 481.792 871.424 457.152 841.152 457.152z"/></svg>
</i>
</a>
</li>
</ul>
</nav>
<link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css>
<link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header id=header class="header container">
<div class=logo-wrapper>
<a href=/ class=logo>
Justice's Blog
</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/>主页</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/post/>点滴</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/tags/>标签</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=https://justice.bj.cn/categories/>分类</a>
</li>
<li class=menu-item>
<a class=menu-item-link href=http://passer-by.com/pacman/ rel=noopener target=_blank>
更多
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6 21.568 21.632 54.144 54.208 54.144 54.208C534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0 30.72.0 55.04-24.512 55.04-54.848C512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408v-49.28C896 481.792 871.424 457.152 841.152 457.152z"/></svg>
</i>
</a>
</li>
<li class=menu-item>
<a id=search-btn class="menu-item-link menu-item-search" href=#>
<i class=iconfont><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="18" height="18" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M973.81454219 973.81454219a91.78207815 91.78207815.0 01-129.80999631.0L682.0297247 811.83972101a425.48527711 425.48527711.0 01-230.35931791 68.16531768 428.3346319 428.3346319.0 11428.3346319-428.3346319A425.48527711 425.48527711.0 01811.83972101 682.0297247l162.02961656 161.97482118a91.83687354 91.83687354.0 01-.05479538 129.80999631zm-522.1441354-828.1209266a305.97679241 305.97679241.0 100 611.95358361 305.97679241 305.97679241.0 000-611.95358361z"/></svg>
</i>
</a>
</li>
</ul>
</nav>
</header>
<div id=fastSearch>
<input id=searchInput tabindex=0>
<ul id=searchResults>
</ul>
</div>
<div id=mobile-panel>
<main id=main class="main bg-llight">
<div class=content-wrapper>
<div id=content class="content container">
<article class="post bg-white">
<header class=post-header>
<h1 class=post-title>Germlin</h1>
<div class=post-meta>
<time datetime=2021-10-10 class=post-time>
2021-10-10 14:35:02
</time>
<div class=post-category>
<a href=https://justice.bj.cn/categories/architech/> architech </a>
<a href=https://justice.bj.cn/categories/graphdb/> graphdb </a>
</div>
<span id=busuanzi_container_page_pv>
| 阅读 <span id=busuanzi_value_page_pv></span>
</span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>文章目录</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#简介>简介</a></li>
<li><a href=#gremlin-查询示例>Gremlin 查询示例</a>
<ul>
<li></li>
</ul>
</li>
<li><a href=#gremlin-语法特性>Gremlin 语法特性</a>
<ul>
<li></li>
</ul>
</li>
<li><a href=#参考>参考</a></li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<h1 id=germlin>Germlin</h1>
<h2 id=简介>简介</h2>
<p><code>Gremlin</code>是Apache TinkerPop的图形查询语言，是一种函数式数据流语言，可以使得用户使用简洁的方式表述复杂的属性图（property graph）的遍历或查询。每个Gremlin遍历由一系列步骤（可能存在嵌套）组成，每一步都在数据流（data stream）上执行一个原子操作。</p>
<p>Gremlin 语言包括三个基本的操作：</p>
<ul>
<li>map-step：对数据流中的对象进行转换；</li>
<li>filter-step：对数据流中的对象就行过滤；</li>
<li>sideEffect-step：对数据流进行计算统计；</li>
</ul>
<p>Tinkerpop3 模型核心概念</p>
<ul>
<li>Graph: 维护节点&边的集合，提供访问底层数据库功能，如事务功能</li>
<li>Element: 维护属性集合，和一个字符串label，表明这个element种类</li>
<li><strong>Vertex</strong>: 继承自Element，维护了一组入度，出度的边集合</li>
<li><strong>Edge</strong>: 继承自Element，维护一组入度，出度vertex节点集合.</li>
<li>Property: kv键值对</li>
<li>VertexProperty: 节点的属性，有一组健值对kv，还有额外的properties 集合。同时也继承自element，必须有自己的id, label.</li>
<li>Cardinality: 「single, list, set」 节点属性对应的value是单值，还是列表，或者set。</li>
</ul>
<h2 id=gremlin-查询示例>Gremlin 查询示例</h2>
<p>下面先介绍下本文中所用到的图的 <code>Schema</code>（Lable）：</p>
<p>顶点：</p>
<ul>
<li>person</li>
<li>software</li>
</ul>
<p>边：person</p>
<ul>
<li>uses(person -> software)</li>
<li>develops(person -> software)</li>
<li>knows(person -> person)</li>
</ul>
<p>下面结合上面的 <code>Schema</code> 给出一些常用的图操作。完整的语法见下一部分。</p>
<h4 id=查询点>查询点</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>limit</span><span class=o>(</span><span class=n>100</span><span class=o>)</span> <span class=c1>// 查询所有点，但限制点的返回数量为100，也可以使用range(x, y)的算子，返回区间内的点数量。 &lt;br&gt;
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>hasLabel</span><span class=o>(</span><span class=err>&#39;</span><span class=n>software</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>// 查询点的label值为&#39;software&#39;的点。 &lt;br&gt;
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>(</span><span class=err>&#39;</span><span class=n>11</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>// 查询id为‘11’的点。
</span></code></pre></td></tr></table>
</div>
</div><h4 id=查询边>查询边</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>E</span><span class=o>()</span> <span class=c1>// 查询所有边，不推荐使用，边数过大时，这种查询方式不合理，一般需要添加过滤条件或限制返回数量。 &lt;br&gt;
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>E</span><span class=o>(</span><span class=err>&#39;</span><span class=n>55</span><span class=o>-</span><span class=n>81</span><span class=o>-</span><span class=n>5</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>// 查询边id为‘55-81-5’的边。 &lt;br&gt;
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>E</span><span class=o>().</span><span class=na>hasLabel</span><span class=o>(</span><span class=err>&#39;</span><span class=n>develops</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>// 查询label为‘develops’的边。 &lt;br&gt;
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>(</span><span class=err>&#39;</span><span class=n>46</span><span class=err>&#39;</span><span class=o>).</span><span class=na>outE</span><span class=o>(</span><span class=err>&#39;</span><span class=n>develops</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>// 查询点id为‘46’所有label为‘develops’的边。
</span></code></pre></td></tr></table>
</div>
</div><h4 id=查询属性>查询属性</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>limit</span><span class=o>(</span><span class=n>3</span><span class=o>).</span><span class=na>valueMap</span><span class=o>()</span> <span class=c1>// 查询点的所有属性（可填参数，表示只查询该点， 一个点所有属性一行结果）。 &lt;br&gt;
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>limit</span><span class=o>(</span><span class=n>1</span><span class=o>).</span><span class=na>label</span><span class=o>()</span> <span class=c1>// 查询点的label。 &lt;br&gt;
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>limit</span><span class=o>(</span><span class=n>10</span><span class=o>).</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>// 查询点的name属性（可不填参数，表示查询所有属性， 一个点每个属性一行结果，只有value，没有key）。
</span></code></pre></td></tr></table>
</div>
</div><h4 id=新增点>新增点</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>graph</span><span class=o>.</span><span class=na>addVertex</span><span class=o>(</span><span class=n>label</span><span class=o>,</span><span class=err>&#39;</span><span class=n>person</span><span class=err>&#39;</span><span class=o>,</span><span class=n>id</span><span class=o>,</span><span class=err>&#39;</span><span class=n>500</span><span class=sc>&#39;,&#39;</span><span class=n>age</span><span class=sc>&#39;,&#39;</span><span class=n>18</span><span class=o>-</span><span class=n>24</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>//新增点，Label为user，ID为500，age为18-24。 &lt;br&gt;
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>addV</span><span class=o>(</span><span class=err>&#39;</span><span class=n>person</span><span class=err>&#39;</span><span class=o>).</span><span class=na>property</span><span class=o>(</span><span class=n>id</span><span class=o>,</span><span class=err>&#39;</span><span class=n>600</span><span class=err>&#39;</span><span class=o>).</span><span class=na>property</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=sc>&#39;,&#39;</span><span class=n>18</span><span class=o>-</span><span class=n>24</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>//新增点，Label为user，ID为500，age为18-24。
</span></code></pre></td></tr></table>
</div>
</div><h4 id=新增边>新增边</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>a</span> <span class=o>=</span> <span class=n>graph</span><span class=o>.</span><span class=na>addVertex</span><span class=o>(</span><span class=n>label</span><span class=o>,</span><span class=err>&#39;</span><span class=n>person</span><span class=err>&#39;</span><span class=o>,</span><span class=n>id</span><span class=o>,</span><span class=err>&#39;</span><span class=n>501</span><span class=sc>&#39;,&#39;</span><span class=n>age</span><span class=sc>&#39;,&#39;</span><span class=n>18</span><span class=o>-</span><span class=n>24</span><span class=err>&#39;</span><span class=o>)</span> 
<span class=n>b</span> <span class=o>=</span> <span class=n>graph</span><span class=o>.</span><span class=na>addVertex</span><span class=o>(</span><span class=n>label</span><span class=o>,</span><span class=err>&#39;</span><span class=n>software</span><span class=err>&#39;</span><span class=o>,</span><span class=n>id</span><span class=o>,</span><span class=err>&#39;</span><span class=n>502</span><span class=sc>&#39;,&#39;</span><span class=n>title</span><span class=sc>&#39;,&#39;</span><span class=n>love</span><span class=err>&#39;</span><span class=o>)</span> 
<span class=n>a</span><span class=o>.</span><span class=na>addEdge</span><span class=o>(</span><span class=err>&#39;</span><span class=n>develops</span><span class=err>&#39;</span><span class=o>,</span> <span class=n>b</span><span class=o>,</span> <span class=err>&#39;</span><span class=n>Year</span><span class=sc>&#39;,&#39;</span><span class=n>1994</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>// 新增边，边的两个点ID分别为501、502。
</span></code></pre></td></tr></table>
</div>
</div><h4 id=删除点>删除点</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>(</span><span class=err>&#39;</span><span class=n>600</span><span class=err>&#39;</span><span class=o>).</span><span class=na>drop</span><span class=o>()</span> <span class=c1>// 删除ID为600的点。
</span></code></pre></td></tr></table>
</div>
</div><h4 id=删除边>删除边</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>E</span><span class=o>(</span><span class=err>&#39;</span><span class=n>501</span><span class=o>-</span><span class=n>502</span><span class=o>-</span><span class=n>0</span><span class=err>&#39;</span><span class=o>).</span><span class=na>drop</span><span class=o>()</span> <span class=c1>//删除ID为“501-502-0”的边。
</span></code></pre></td></tr></table>
</div>
</div><h2 id=gremlin-语法特性>Gremlin 语法特性</h2>
<h4 id=基础>基础</h4>
<ol>
<li><code>V()</code>：查询顶点，一般作为图查询的第1步，后面可以续接的语句种类繁多。例，<code>g.V()，g.V('v_id')</code>，查询所有点和特定点；</li>
<li><code>E()</code>：查询边，一般作为图查询的第1步，后面可以续接的语句种类繁多；</li>
<li><code>id()</code>：获取顶点、边的id。例：<code>g.V().id()</code>，查询所有顶点的id；</li>
<li><code>label()</code>：获取顶点、边的 label。例：<code>g.V().label()</code>，可查询所有顶点的label。</li>
<li><code>key() / values()</code>：获取属性的key/value的值。</li>
<li><code>properties()</code>：获取顶点、边的属性；可以和 key()、value()搭配使用，以获取属性的名称或值。例：<code>g.V().properties('name')</code>，查询所有顶点的 name 属性；</li>
<li><code>valueMap()</code>：获取顶点、边的属性，以Map的形式体现，和<code>properties()</code>比较像；</li>
<li><code>values()</code>：获取顶点、边的属性值。例，<code>g.V().values()</code> 等于 <code>g.V().properties().value()</code></li>
</ol>
<h4 id=遍历>遍历</h4>
<p>顶点为基准：</p>
<ol>
<li><code>out(label)</code>：根据指定的 Edge Label 来访问顶点的 OUT 方向邻接<strong>点</strong>（可以是零个 Edge Label，代表所有类型边；也可以一个或多个 Edge Label，代表任意给定 Edge Label 的边，下同）；</li>
<li><code>in(label)</code>：根据指定的 Edge Label 来访问顶点的 IN 方向邻接<strong>点</strong>；</li>
<li><code>both(label)</code>：根据指定的 Edge Label 来访问顶点的双向邻接<strong>点</strong>；</li>
<li><code>outE(label)</code>： 根据指定的 Edge Label 来访问顶点的 OUT 方向邻接<strong>边</strong>；</li>
<li><code>inE(label)</code>：根据指定的 Edge Label 来访问顶点的 IN 方向邻接<strong>边</strong>；</li>
<li><code>bothE(label)</code>：根据指定的 Edge Label 来访问顶点的双向邻接<strong>边</strong>；</li>
</ol>
<p>边为基准的：</p>
<ol>
<li><code>outV()</code>：访问边的出顶<strong>点</strong>，出顶点是指边的起始顶点；</li>
<li><code>inV()</code>：访问边的入顶<strong>点</strong>，入顶点是指边的目标顶点，也就是箭头指向的顶点；</li>
<li><code>bothV()</code>：访问边的双向顶<strong>点</strong>；</li>
<li><code>otherV()</code>：访问边的伙伴顶<strong>点</strong>，即相对于基准顶点而言的另一端的顶点；</li>
</ol>
<h4 id=过滤>过滤</h4>
<p>在众多Gremlin的语句中，有一大类是filter类型，顾名思义，就是对输入的对象进行条件判断，只有满足过滤条件的对象才可以通过filter进入下一步。</p>
<h5 id=has>has</h5>
<p>has语句是filter类型语句的代表，能够以顶点和边的属性作为过滤条件，决定哪些对象可以通过。常用的有下面几种:</p>
<ol>
<li><code>has(key,value)</code>: 通过属性的名字和值来过滤顶点或边；</li>
<li><code>has(label, key, value)</code>: 通过label和属性的名字和值过滤顶点和边；</li>
<li><code>has(key,predicate)</code>: 通过对指定属性用条件过滤顶点和边，例：<code>g.V().has('age', gt(20))</code>，可得到年龄大于20的顶点；</li>
<li><code>hasLabel(labels…​)</code>: 通过 label 来过滤顶点或边，满足label列表中一个即可通过；</li>
<li><code>hasId(ids…​)</code>: 通过 id 来过滤顶点或者边，满足id列表中的一个即可通过；</li>
<li><code>hasKey(keys…​)</code>: 通过 properties 中的若干 key 过滤顶点或边；</li>
<li><code>hasValue(values…​)</code>: 通过 properties 中的若干 value 过滤顶点或边；</li>
<li><code>has(key)</code>: properties 中存在 key 这个属性则通过，等价于hasKey(key)；</li>
<li><code>hasNot(key)</code>: 和 has(key) 相反；</li>
</ol>
<p>例：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>hasLabel</span><span class=o>(</span><span class=err>&#39;</span><span class=n>person</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>// lable 等于 person 的所有顶点；
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>has</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>,</span><span class=n>inside</span><span class=o>(</span><span class=n>20</span><span class=o>,</span><span class=n>30</span><span class=o>)).</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>// 所有年龄在20（含）~30（不含）之间的顶点；
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>has</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>,</span><span class=n>outside</span><span class=o>(</span><span class=n>20</span><span class=o>,</span><span class=n>30</span><span class=o>)).</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>// 所有年龄不在20（含）~30（不含）之间的顶点；
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>has</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>,</span><span class=n>within</span><span class=o>(</span><span class=err>&#39;</span><span class=n>josh</span><span class=sc>&#39;,&#39;</span><span class=n>marko</span><span class=err>&#39;</span><span class=o>)).</span><span class=na>valueMap</span><span class=o>()</span> <span class=c1>// name 是&#39;josh&#39;或&#39;marko&#39;的顶点的属性；
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>has</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>,</span><span class=n>without</span><span class=o>(</span><span class=err>&#39;</span><span class=n>josh</span><span class=sc>&#39;,&#39;</span><span class=n>marko</span><span class=err>&#39;</span><span class=o>)).</span><span class=na>valueMap</span><span class=o>()</span> <span class=c1>// name 不是&#39;josh&#39;或&#39;marko&#39;的顶点的属性；
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>has</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>,</span><span class=n>not</span><span class=o>(</span><span class=n>within</span><span class=o>(</span><span class=err>&#39;</span><span class=n>josh</span><span class=sc>&#39;,&#39;</span><span class=n>marko</span><span class=err>&#39;</span><span class=o>))).</span><span class=na>valueMap</span><span class=o>()</span> <span class=c1>// 同上
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>properties</span><span class=o>().</span><span class=na>hasKey</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>).</span><span class=na>value</span><span class=o>()</span> <span class=c1>// age 这个属性的所有 value
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>hasNot</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>).</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>)</span> <span class=c1>//  不含 age 这个属性的所有 顶点的 name 属性
</span></code></pre></td></tr></table>
</div>
</div><h4 id=路径>路径</h4>
<p>在使用Gremlin对图进行分析时，关注点有时并不仅仅在最终达到顶点、边或者属性，通过什么样的路径到达最终的顶点、边和属性同样重要。此时可以借助<code>path()</code> 来获取经过的路径信息。</p>
<p><code>path()</code> 返回当前遍历过的所有路径。有时需要对路径进行过滤，只选择没有环路的路径或者选择包含环路的路径，Gremlin针对这种需求提供了两种过滤路径的step：<code>simplePath()</code> 和<code>cyclicPath()</code>。</p>
<ol>
<li><code>path()</code>：获取当前遍历过的所有路径；</li>
<li><code>simplePath()</code>：过滤掉路径中含有环路的对象，只保留路径中不含有环路的对象；</li>
<li><code>cyclicPath()</code>：过滤掉路径中不含有环路的对象，只保留路径中含有环路的对象。</li>
</ol>
<p>例1：寻找4跳以内从 andy 到 jack 的最短路径。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>(</span><span class=s>&#34;andy&#34;</span><span class=o>)</span>
 <span class=o>.</span><span class=na>repeat</span><span class=o>(</span><span class=n>both</span><span class=o>().</span><span class=na>simplePath</span><span class=o>()).</span><span class=na>until</span><span class=o>(</span><span class=n>hasId</span><span class=o>(</span><span class=s>&#34;target_v_id&#34;</span><span class=o>)</span>
 <span class=o>.</span><span class=na>and</span><span class=o>().</span><span class=na>loops</span><span class=o>().</span><span class=na>is</span><span class=o>(</span><span class=n>lte</span><span class=o>(</span><span class=n>4</span><span class=o>))).</span><span class=na>hasId</span><span class=o>(</span><span class=s>&#34;jack&#34;</span><span class=o>)</span>
 <span class=o>.</span><span class=na>path</span><span class=o>().</span><span class=na>limit</span><span class=o>(</span><span class=n>1</span><span class=o>)</span>
</code></pre></td></tr></table>
</div>
</div><p>例2：“Titan” 顶点到与其有两层关系的顶点的不含环路的路径（只包含顶点）</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>()</span>
<span class=o>.</span><span class=na>hasLabel</span><span class=o>(</span><span class=err>&#39;</span><span class=n>software</span><span class=err>&#39;</span><span class=o>).</span><span class=na>has</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=sc>&#39;,&#39;</span><span class=n>Titan</span><span class=err>&#39;</span><span class=o>)</span>
<span class=o>.</span><span class=na>both</span><span class=o>().</span><span class=na>both</span><span class=o>().</span><span class=na>simplePath</span><span class=o>()</span>
<span class=o>.</span><span class=na>path</span><span class=o>()</span>
</code></pre></td></tr></table>
</div>
</div><h4 id=迭代>迭代</h4>
<ol>
<li><code>repeat()</code>：指定要重复执行的语句；</li>
<li><code>times()</code>： 指定要重复执行的次数，如执行3次；<br>
3.<code>until()</code>：指定循环终止的条件，如一直找到某个名字的朋友为止；</li>
<li><code>emit()</code>：指定循环语句的执行过程中收集数据的条件，每一步的结果只要符合条件则被收集，不指定条件时收集所有结果；<br>
5.<code>loops()</code>：当前循环的次数，可用于控制最大循环次数等，如最多执行3次。</li>
</ol>
<p><code>repeat()</code> 和 <code>until()</code> 的位置不同，决定了不同的循环效果：</p>
<ul>
<li><code>repeat()</code> + <code>until()</code>：等同 do-while；</li>
<li><code>until()</code> + <code>repeat()</code>：等同 while-do。</li>
</ul>
<p><code>repeat()</code> 和 <code>emit()</code> 的位置不同，决定了不同的循环效果：</p>
<ul>
<li><code>repeat()</code> + <code>emit()</code>：先执行后收集；</li>
<li><code>emit()</code> + <code>repeat()</code>：表示先收集再执行。</li>
</ul>
<p>注意：</p>
<blockquote>
<p>emit()与times()搭配使用时，是“或”的关系而不是“与”的关系，满足两者间任意一个即可。<br>
emit()与until()搭配使用时，是“或”的关系而不是“与”的关系，满足两者间任意一个即可。</p>
</blockquote>
<p>例1：根据出边进行遍历，直到抵达叶子节点（无出边的顶点），输出其路径顶点名：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>(</span><span class=n>1</span><span class=o>)</span>
 <span class=o>.</span><span class=na>repeat</span><span class=o>(</span><span class=n>out</span><span class=o>())</span>
 <span class=o>.</span><span class=na>until</span><span class=o>(</span><span class=n>outE</span><span class=o>().</span><span class=na>count</span><span class=o>().</span><span class=na>is</span><span class=o>(</span><span class=n>0</span><span class=o>))</span>
 <span class=o>.</span><span class=na>path</span><span class=o>().</span><span class=na>by</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>)</span>
</code></pre></td></tr></table>
</div>
</div><p>例2：查询顶点’1’的3度 OUT 可达点路径</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>(</span><span class=sc>&#39;1&#39;</span><span class=o>)</span>
 <span class=o>.</span><span class=na>repeat</span><span class=o>(</span><span class=n>out</span><span class=o>())</span>
 <span class=o>.</span><span class=na>until</span><span class=o>(</span><span class=n>loops</span><span class=o>().</span><span class=na>is</span><span class=o>(</span><span class=n>3</span><span class=o>))</span>
 <span class=o>.</span><span class=na>path</span><span class=o>()</span>
</code></pre></td></tr></table>
</div>
</div><h4 id=转换>转换</h4>
<ol>
<li>map()：可以接受一个遍历器 Step 或 Lamda 表达式，将遍历器中的元素映射（转换）成<strong>另一个类型的某个对象</strong>（一对一），以便进行下一步处理</li>
<li>flatMap()：可以接受一个遍历器 Step 或 Lamda 表达式，将遍历器中的元素映射（转换）成另一个类型的某个<strong>对象流或迭代器</strong>（一对多）。</li>
</ol>
<p>稍微了解函数式编程的同学都比较熟悉这两个操作了，在这里不再赘述。</p>
<p>例：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=c1>// 创建了 titan 的作者节点的姓名
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>(</span><span class=err>&#39;</span><span class=n>titan</span><span class=err>&#39;</span><span class=o>).</span><span class=na>in</span><span class=o>(</span><span class=err>&#39;</span><span class=n>created</span><span class=err>&#39;</span><span class=o>).</span><span class=na>map</span><span class=o>(</span><span class=n>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>))</span>
<span class=c1>// 创建了 titan 的作者节点的所有出边
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>(</span><span class=err>&#39;</span><span class=n>titan</span><span class=err>&#39;</span><span class=o>).</span><span class=na>in</span><span class=o>(</span><span class=err>&#39;</span><span class=n>created</span><span class=err>&#39;</span><span class=o>).</span><span class=na>flatMap</span><span class=o>(</span><span class=n>outE</span><span class=o>())</span>
</code></pre></td></tr></table>
</div>
</div><h4 id=排序>排序</h4>
<ol>
<li><code>order()</code></li>
<li><code>order().by()</code></li>
</ol>
<p>排序比较简单，直接看例子吧。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=c1>// 默认升序排列
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>).</span><span class=na>order</span><span class=o>()</span>
<span class=c1>// 按照元素属性age的值升序排列，并只输出姓名
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>hasLabel</span><span class=o>(</span><span class=err>&#39;</span><span class=n>person</span><span class=err>&#39;</span><span class=o>).</span><span class=na>order</span><span class=o>().</span><span class=na>by</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>,</span> <span class=n>asc</span><span class=o>).</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id=逻辑>逻辑</h4>
<ol>
<li><code>is()</code>：可以接受一个对象（能判断相等）或一个判断语句（如：P.gt()、P.lt()、P.inside()等），当接受的是对象时，原遍历器中的元素<strong>必须与对象相等</strong>才会保留；当接受的是判断语句时，原遍历器中的元素满足判断才会保留，其实接受一个对象相当于P.eq()；</li>
<li><code>and()</code>：可以接受任意数量的遍历器（traversal），原遍历器中的元素，只有在每个新遍历器中<strong>都能生成至少一个输出的情况下</strong>才会保留，相当于过滤器组合的与条件；</li>
<li><code>or()</code>：可以接受任意数量的遍历器（traversal），原遍历器中的元素，只要在全部新遍历器中<strong>能生成至少一个输出</strong>的情况下就会保留，相当于过滤器组合的或条件；</li>
<li><code>not()</code>：仅能接受一个遍历器（traversal），原遍历器中的元素，在新遍历器中能生成输出时会被移除，不能生成输出时则会保留，相当于<strong>过滤器的非条件</strong>。</li>
</ol>
<p>例1：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=c1>// 筛选出顶点属性“age”等于28的属性值，与`is(P.eq(28))`等效
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>).</span><span class=na>is</span><span class=o>(</span><span class=n>28</span><span class=o>)</span>

<span class=c1>// 所有包含出边“supports”和“created”的顶点的名字“name”
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span>
    <span class=n>and</span><span class=o>(</span>
        <span class=n>outE</span><span class=o>(</span><span class=err>&#39;</span><span class=n>supports</span><span class=err>&#39;</span><span class=o>),</span> 
        <span class=n>outE</span><span class=o>(</span><span class=err>&#39;</span><span class=n>created</span><span class=err>&#39;</span><span class=o>))</span>
    <span class=o>.</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>)</span>

<span class=c1>// 使用 where语句 实现上面的功能
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>where</span><span class=o>(</span><span class=n>outE</span><span class=o>(</span><span class=err>&#39;</span><span class=n>supports</span><span class=err>&#39;</span><span class=o>)</span>
            <span class=o>.</span><span class=na>and</span><span class=o>()</span>
            <span class=o>.</span><span class=na>outE</span><span class=o>(</span><span class=err>&#39;</span><span class=n>created</span><span class=err>&#39;</span><span class=o>)</span>
    <span class=o>.</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>)</span>


<span class=c1>// 筛选出所有不是“person”的顶点的“label”
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>not</span><span class=o>(</span><span class=n>hasLabel</span><span class=o>(</span><span class=err>&#39;</span><span class=n>person</span><span class=err>&#39;</span><span class=o>)).</span><span class=na>label</span><span class=o>()</span>
</code></pre></td></tr></table>
</div>
</div><p>例2：获取所有最多只有一条“created”边并且年龄不等于28的“person”顶点</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>hasLabel</span><span class=o>(</span><span class=err>&#39;</span><span class=n>person</span><span class=err>&#39;</span><span class=o>)</span>
 <span class=o>.</span><span class=na>and</span><span class=o>(</span><span class=n>outE</span><span class=o>(</span><span class=err>&#39;</span><span class=n>created</span><span class=err>&#39;</span><span class=o>).</span><span class=na>count</span><span class=o>().</span><span class=na>is</span><span class=o>(</span><span class=n>lte</span><span class=o>(</span><span class=n>1</span><span class=o>)),</span> 
      <span class=n>values</span><span class=o>(</span><span class=s>&#34;age&#34;</span><span class=o>).</span><span class=na>is</span><span class=o>(</span><span class=n>P</span><span class=o>.</span><span class=na>not</span><span class=o>(</span><span class=n>P</span><span class=o>.</span><span class=na>eq</span><span class=o>(</span><span class=n>28</span><span class=o>))))</span>
 <span class=o>.</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id=统计>统计</h4>
<ol>
<li>sum()：将 traversal 中的所有的数字求和；</li>
<li>max()：对 traversal 中的所有的数字求最大值；</li>
<li>min()：对 traversal 中的所有的数字求最小值；</li>
<li>mean()：将 traversal 中的所有的数字求均值；</li>
<li>count()：统计 traversal 中 item 总数。</li>
</ol>
<p>例：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=c1>// 计算所有“person”的“created”出边数的均值 &lt;br&gt;
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>hasLabel</span><span class=o>(</span><span class=err>&#39;</span><span class=n>person</span><span class=err>&#39;</span><span class=o>)</span> 
<span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>outE</span><span class=o>(</span><span class=err>&#39;</span><span class=n>created</span><span class=err>&#39;</span><span class=o>).</span><span class=na>count</span><span class=o>())</span> 
<span class=o>.</span><span class=na>mean</span><span class=o>()</span>
</code></pre></td></tr></table>
</div>
</div><h4 id=分支>分支</h4>
<ol>
<li><code>choose()</code> ：分支选择, 常用使用场景为： <code>choose(predicate, true-traversal, false-traversal)</code>，根据 predicate 判断，当前对象满足时，继续 true-traversal，否则继续 false-traversal；</li>
<li><code>optional()</code>：类似于 by() 无实际意义，搭配 choose() 使用；</li>
</ol>
<p>例1：<code>if-else</code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>hasLabel</span><span class=o>(</span><span class=err>&#39;</span><span class=n>person</span><span class=err>&#39;</span><span class=o>)</span>
<span class=o>.</span> <span class=n>choose</span><span class=o>(</span><span class=n>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>).</span><span class=na>is</span><span class=o>(</span><span class=n>lte</span><span class=o>(</span><span class=n>30</span><span class=o>)),</span> 
<span class=n>__</span><span class=o>.</span><span class=na>in</span><span class=o>(),</span> 
<span class=n>__</span><span class=o>.</span><span class=na>out</span><span class=o>()).</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>)</span>
</code></pre></td></tr></table>
</div>
</div><p>例2：<code>if-elseif-else</code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=c1>// 查找所有的“person”类型的顶点 &lt;br&gt;
</span><span class=c1>// 如果“age”属性等于0，输出名字 &lt;br&gt;
</span><span class=c1>// 如果“age”属性等于28，输出年龄 &lt;br&gt;
</span><span class=c1>// 如果“age”属性等于29，输出他开发的软件的名字 &lt;br&gt;
</span><span class=c1>// choose(predicate).option().option()... &lt;br&gt;
</span><span class=c1></span><span class=n>g</span><span class=o>.</span><span class=na>V</span><span class=o>().</span><span class=na>hasLabel</span><span class=o>(</span><span class=err>&#39;</span><span class=n>person</span><span class=err>&#39;</span><span class=o>)</span> 
<span class=o>.</span><span class=na>choose</span><span class=o>(</span><span class=n>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>))</span> 
<span class=o>.</span><span class=na>option</span><span class=o>(</span><span class=n>0</span><span class=o>,</span> <span class=n>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>))</span>  
<span class=o>.</span><span class=na>option</span><span class=o>(</span><span class=n>28</span><span class=o>,</span> <span class=n>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>age</span><span class=err>&#39;</span><span class=o>))</span> 
<span class=o>.</span><span class=na>option</span><span class=o>(</span><span class=n>29</span><span class=o>,</span> <span class=n>__</span><span class=o>.</span><span class=na>out</span><span class=o>(</span><span class=err>&#39;</span><span class=n>created</span><span class=err>&#39;</span><span class=o>)</span>
<span class=o>.</span><span class=na>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>))</span> <span class=o>&lt;</span><span class=n>br</span><span class=o>&gt;</span> 
<span class=o>.</span><span class=na>option</span><span class=o>(</span><span class=n>none</span><span class=o>,</span> <span class=n>values</span><span class=o>(</span><span class=err>&#39;</span><span class=n>name</span><span class=err>&#39;</span><span class=o>))</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=参考>参考</h2>
<ol>
<li>
<p><a href=http://tinkerpop-gremlin.cn/>http://tinkerpop-gremlin.cn/</a></p>
</li>
<li>
<p><a href=http://tang.love/2018/11/15/gremlin_traversal_language/>http://tang.love/2018/11/15/gremlin_traversal_language/</a></p>
</li>
<li>
<p><a href=https://zhuanlan.zhihu.com/p/115098569>深入学习图语言Gremlin | 图数据库入门</a></p>
</li>
<li>
<p>P</p>
</li>
</ol>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>文章作者</span>
<span class=item-content>Justice</span>
</p>
<p class=copyright-item>
<span class=item-title>上次更新</span>
<span class=item-content>
2021-10-10 14:35:02
</span>
</p>
<p class=copyright-item>
<span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span>
</p>
</div>
<div class=post-reward>
<input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label>
<div class=qr-code>
<label class=qr-code-image for=reward>
<img class=image src=/image/wx_reward_qrcode.png>
<span>微信打赏</span>
</label>
<label class=qr-code-image for=reward>
<img class=image src=/image/alipay_reward_qrcode.png>
<span>支付宝打赏</span>
</label>
<label class=qr-code-image for=reward>
<img class=image src=/image/bitcoin_reward_qrcode.png>
<span>比特币打赏</span>
</label>
</div>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=https://justice.bj.cn/tags/architech/>architech</a>
<a href=https://justice.bj.cn/tags/graphdb/>graphdb</a>
</div>
<nav class=post-nav>
<a class=prev href=/post/40.storage/ceph/ceph/>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg>
</i>
<span class="prev-text nav-default">Ceph基础</span>
<span class="prev-text nav-mobile">上一篇</span>
</a>
<a class=next href=/post/36.monitor/jaeger%E7%AE%80%E4%BB%8B/>
<span class="next-text nav-default">Jaeger简介</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg>
</i>
</a>
</nav>
</footer>
</article>
<div class="post bg-white">
<script src=https://utteranc.es/client.js repo=ZhuZhengyi/gh_comment issue-term=pathname theme=github-light crossorigin=anonymous async></script>
</div>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=icon-links>
<a href=mailto:justice_103@126.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a>
<a href=https://justice.bj.cn/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg>
</a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span>
<span class=copyright-year>
&copy;
2000 -
2024
<span class=heart>
<i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i>
</span><span class=author>
Justice
</span></span>
<span id=busuanzi_container>
访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg>
</i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script>
<script type=text/javascript>window.MathJax={showProcessingMessages:!1,messageStyle:'none'}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css integrity=sha384-BdGj8xC2eZkQaxoQ8nSLefg4AV4/AwB3Fj+8SUSo7pnKP6Eoy18liIKTPn9oBYNG crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.js integrity=sha384-JiKN5O8x9Hhs/UE5cT5AAJqieYlOZbGT3CHws/y97o3ty4R7/O5poG9F3JoiOYw1 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{})})</script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=/js/fuse.min.js></script>
<script src=/js/fastsearch.js></script>
</body>
</html>